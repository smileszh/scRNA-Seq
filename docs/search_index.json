[["index.html", "scRNA-Seq å‰è¨€", " scRNA-Seq è‹æ€»å 2025-04-08 å‰è¨€ å•ç»†èƒæµ‹åºåˆ†æç¬”è®°ã€‚ æˆ‘ä¸æ˜¯ä»£ç çš„åˆ›ä½œè€…ï¼Œæˆ‘åªæ˜¯ä»£ç çš„æ¬è¿å·¥ã€‚ "],["seurat-æ•™ç¨‹.html", "ç¬¬ 1 ç«  Seurat æ•™ç¨‹ 1.1 æ•°æ®å’ŒRåŒ…å‡†å¤‡ 1.2 è¯»å–æ•°æ® 1.3 è´¨æ§ 1.4 æ‰¾é«˜å˜åŸºå›  (HVG) 1.5 æ ‡å‡†åŒ–å’Œé™ç»´ 1.6 æ‰¾ marker åŸºå›  1.7 æ ¹æ®markeråŸºå› ç¡®å®šç»†èƒ", " ç¬¬ 1 ç«  Seurat æ•™ç¨‹ 1.1 æ•°æ®å’ŒRåŒ…å‡†å¤‡ ä»£ç ï¼šhttps://satijalab.org/seurat/articles/pbmc3k_tutorial æ•°æ®ï¼šhttps://cf.10xgenomics.com/samples/cell/pbmc3k/pbmc3k_filtered_gene_bc_matrices.tar.gz rm(list = ls()) library(dplyr) library(Seurat) library(patchwork) 1.2 è¯»å–æ•°æ® 10Xçš„è¾“å…¥æ•°æ®æ˜¯å›ºå®šçš„ä¸‰ä¸ªæ–‡ä»¶ï¼Œåœ¨å·¥ä½œç›®å½•ä¸‹æ–°å»º01_data/ï¼ŒæŠŠä¸‰ä¸ªæ–‡ä»¶æ”¾è¿›å»ã€‚ pbmc.data &lt;- Read10X(data.dir = &quot;01_data/&quot;) dim(pbmc.data) ## [1] 32738 2700 pbmc.data[c(&quot;CD3D&quot;, &quot;TCL1A&quot;, &quot;MS4A1&quot;), 1:30] ## 3 x 30 sparse Matrix of class &quot;dgCMatrix&quot; ## ## CD3D 4 . 10 . . 1 2 3 1 . . 2 7 1 . . 1 3 . 2 3 . . . . . 3 4 1 5 ## TCL1A . . . . . . . . 1 . . . . . . . . . . . . 1 . . . . . . . . ## MS4A1 . 6 . . . . . . 1 1 1 . . . . . . . . . 36 1 2 . . 2 . . . . range(pbmc.data) ## [1] 0 419 pbmc &lt;- CreateSeuratObject(counts = pbmc.data, project = &quot;pbmc3k&quot;, min.cells = 3, min.features = 200) pbmc ## An object of class Seurat ## 13714 features across 2700 samples within 1 assay ## Active assay: RNA (13714 features, 0 variable features) ## 1 layer present: counts ä¸€ä¸ªåŸºå› è‡³å°‘è¦åœ¨3ä¸ªç»†èƒé‡Œé¢æœ‰è¡¨è¾¾ï¼Œæ‰è¢«ä¿ç•™ï¼› ä¸€ä¸ªç»†èƒé‡Œé¢è‡³å°‘è¦è¡¨è¾¾ä¸¤ç™¾ä¸ªåŸºå› ï¼Œæ‰è¢«ä¿ç•™ã€‚ 1.3 è´¨æ§ è¿™é‡Œæ˜¯å¯¹ç»†èƒè¿›è¡Œçš„è´¨æ§ï¼ŒæŒ‡æ ‡æ˜¯ï¼š çº¿ç²’ä½“åŸºå› å«é‡ä¸èƒ½è¿‡é«˜ï¼› nFeature_RNA ä¸èƒ½è¿‡é«˜æˆ–è¿‡ä½ ä¸ºä»€ä¹ˆï¼Ÿ nFeature_RNAæ˜¯æ¯ä¸ªç»†èƒä¸­æ£€æµ‹åˆ°çš„åŸºå› æ•°é‡ã€‚nCount_RNAæ˜¯ç»†èƒå†…æ£€æµ‹åˆ°çš„åˆ†å­æ€»æ•°ã€‚nFeature_RNAè¿‡ä½ï¼Œè¡¨ç¤ºè¯¥ç»†èƒå¯èƒ½å·²æ­»/å°†æ­»æˆ–æ˜¯ç©ºæ¶²æ»´ã€‚å¤ªé«˜çš„nCount_RNAå’Œ/æˆ–nFeature_RNAè¡¨æ˜â€œç»†èƒâ€å®é™…ä¸Šå¯ä»¥æ˜¯ä¸¤ä¸ªæˆ–å¤šä¸ªç»†èƒã€‚ç»“åˆçº¿ç²’ä½“åŸºå› countæ•°é™¤å»å¼‚å¸¸å€¼ï¼Œå³å¯é™¤å»å¤§å¤šæ•°åŒå³°/æ­»ç»†èƒ/ç©ºæ¶²æ»´ï¼Œå› æ­¤å®ƒä»¬è¿‡æ»¤æ˜¯å¸¸è§çš„é¢„å¤„ç†æ­¥éª¤ã€‚ å‚è€ƒè‡ªï¼šhttps://www.biostars.org/p/407036/ 1.3.1 æŸ¥çœ‹ä¸‰ä¸ªæŒ‡æ ‡ head(pbmc@meta.data) ## orig.ident nCount_RNA nFeature_RNA ## AAACATACAACCAC-1 pbmc3k 2419 779 ## AAACATTGAGCTAC-1 pbmc3k 4903 1352 ## AAACATTGATCAGC-1 pbmc3k 3147 1129 ## AAACCGTGCTTCCG-1 pbmc3k 2639 960 ## AAACCGTGTATGCG-1 pbmc3k 980 521 ## AAACGCACTGGTAC-1 pbmc3k 2163 781 pbmc[[&quot;percent.mt&quot;]] &lt;- PercentageFeatureSet(pbmc, pattern = &quot;^MT-&quot;) head(pbmc@meta.data) ## orig.ident nCount_RNA nFeature_RNA percent.mt ## AAACATACAACCAC-1 pbmc3k 2419 779 3.0177759 ## AAACATTGAGCTAC-1 pbmc3k 4903 1352 3.7935958 ## AAACATTGATCAGC-1 pbmc3k 3147 1129 0.8897363 ## AAACCGTGCTTCCG-1 pbmc3k 2639 960 1.7430845 ## AAACCGTGTATGCG-1 pbmc3k 980 521 1.2244898 ## AAACGCACTGGTAC-1 pbmc3k 2163 781 1.6643551 VlnPlot(pbmc, features = c(&quot;nFeature_RNA&quot;, &quot;nCount_RNA&quot;, &quot;percent.mt&quot;), ncol = 3,pt.size = 0.5) æ ¹æ®è¿™ä¸ªä¸‰ä¸ªå›¾ï¼Œç¡®å®šäº†è¿™ä¸ªæ•°æ®çš„è¿‡æ»¤æ ‡å‡†ï¼š nFeature_RNAåœ¨200~2500ä¹‹é—´ï¼›çº¿ç²’ä½“åŸºå› å æ¯”åœ¨5%ä»¥ä¸‹ã€‚ 1.3.2 ä¸‰ä¸ªæŒ‡æ ‡ä¹‹é—´çš„ç›¸å…³æ€§ plot1 &lt;- FeatureScatter(pbmc, feature1 = &quot;nCount_RNA&quot;, feature2 = &quot;percent.mt&quot;) plot2 &lt;- FeatureScatter(pbmc, feature1 = &quot;nCount_RNA&quot;, feature2 = &quot;nFeature_RNA&quot;) plot1 + plot2 1.3.3 è¿‡æ»¤ dim(pbmc) ## [1] 13714 2700 pbmc &lt;- subset(pbmc, subset = nFeature_RNA &gt; 200 &amp; nFeature_RNA &lt; 2500 &amp; percent.mt &lt; 5) dim(pbmc) ## [1] 13714 2638 1.4 æ‰¾é«˜å˜åŸºå›  (HVG) pbmc &lt;- NormalizeData(pbmc) pbmc &lt;- FindVariableFeatures(pbmc) top10 &lt;- head(VariableFeatures(pbmc), 10);top10 ## [1] &quot;PPBP&quot; &quot;LYZ&quot; &quot;S100A9&quot; &quot;IGLL5&quot; &quot;GNLY&quot; &quot;FTL&quot; &quot;PF4&quot; &quot;FTH1&quot; ## [9] &quot;GNG11&quot; &quot;S100A8&quot; è¿™é‡Œé€‰äº†2000ä¸ªï¼ŒæŠŠå‰åä¸ªåœ¨å›¾ä¸Šæ ‡è®°å‡ºæ¥ã€‚ plot1 &lt;- VariableFeaturePlot(pbmc) plot2 &lt;- LabelPoints(plot = plot1, points = top10, repel = TRUE) plot2 1.5 æ ‡å‡†åŒ–å’Œé™ç»´ 1.5.1 çº¿æ€§é™ç»´PCA pbmc &lt;- ScaleData(pbmc, features = rownames(pbmc)) pbmc &lt;- RunPCA(pbmc, features = VariableFeatures(pbmc)) VizDimLoadings(pbmc, dims = 1:2, reduction = &quot;pca&quot;) #æ¯ä¸ªä¸»æˆåˆ†å¯¹åº”åŸºå› çš„çƒ­å›¾ DimHeatmap(pbmc, dims = 1:15, cells = 500) # åº”è¯¥é€‰å¤šå°‘ä¸ªä¸»æˆåˆ†è¿›è¡Œåç»­åˆ†æ ElbowPlot(pbmc) # é™é€Ÿæ­¥éª¤ f = &quot;jc.Rdata&quot; if(!file.exists(f)){ pbmc &lt;- JackStraw(pbmc, num.replicate = 100) pbmc &lt;- ScoreJackStraw(pbmc, dims = 1:20) save(pbmc,file = f) } load(f) JackStrawPlot(pbmc, dims = 1:20) #PC1å’Œ2 PCAPlot(pbmc) + NoLegend() DimPlot(pbmc, reduction = &quot;pca&quot;)+ NoLegend() # ç»“åˆJackStrawPlotå’ŒElbowPlotï¼ŒæŒ‘é€‰10ä¸ªPCï¼Œæ‰€ä»¥è¿™é‡Œdimså®šä¹‰ä¸º1:10 pbmc &lt;- FindNeighbors(pbmc, dims = 1:10) pbmc &lt;- FindClusters(pbmc, resolution = 0.5) #åˆ†è¾¨ç‡ ## Modularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck ## ## Number of nodes: 2638 ## Number of edges: 95927 ## ## Running Louvain algorithm... ## Maximum modularity in 10 random starts: 0.8728 ## Number of communities: 9 ## Elapsed time: 0 seconds # ç»“æœèšæˆå‡ ç±»ï¼Œç”¨IdentsæŸ¥çœ‹ length(levels(Idents(pbmc))) ## [1] 9 1.5.2 UMAP å’Œ t-sne PCAæ˜¯çº¿æ€§é™ç»´ï¼Œè¿™ä¸¤ä¸ªæ˜¯éçº¿æ€§é™ç»´ã€‚ pbmc &lt;- RunUMAP(pbmc, dims = 1:10) DimPlot(pbmc, reduction = &quot;umap&quot;) 1.6 æ‰¾ marker åŸºå›  å•¥å«markeråŸºå› å‘¢ã€‚å’Œå·®å¼‚åŸºå› é‡Œé¢çš„ä¸Šè°ƒåŸºå› æœ‰ç‚¹ç±»ä¼¼ï¼ŒæŸä¸ªåŸºå› åœ¨æŸä¸€ç°‡ç»†èƒé‡Œè¡¨è¾¾é‡éƒ½å¾ˆé«˜ï¼Œåœ¨å…¶ä»–ç°‡è¡¨è¾¾é‡å¾ˆä½ï¼Œé‚£ä¹ˆè¿™ä¸ªåŸºå› å°±æ˜¯è¿™ç°‡ç»†èƒçš„è±¡å¾ã€‚ æ‰¾å…¨éƒ¨clusterçš„makeråŸºå›  pbmc.markers &lt;- FindAllMarkers(pbmc, only.pos = TRUE, min.pct = 0.25) pbmc.markers %&gt;% group_by(cluster) %&gt;% top_n(n = 2, wt = avg_log2FC) ## # A tibble: 18 Ã— 7 ## # Groups: cluster [9] ## p_val avg_log2FC pct.1 pct.2 p_val_adj cluster gene ## &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt; &lt;chr&gt; ## 1 9.57e- 88 2.40 0.447 0.108 1.31e- 83 0 CCR7 ## 2 1.35e- 51 2.14 0.342 0.103 1.86e- 47 0 LEF1 ## 3 7.07e-139 7.28 0.299 0.004 9.70e-135 1 FOLR3 ## 4 3.38e-121 6.74 0.277 0.006 4.64e-117 1 S100A12 ## 5 2.97e- 58 2.09 0.42 0.111 4.07e- 54 2 AQP3 ## 6 5.03e- 34 1.87 0.263 0.07 6.90e- 30 2 CD40LG ## 7 2.40e-272 7.38 0.564 0.009 3.29e-268 3 LINC00926 ## 8 2.75e-237 7.14 0.488 0.007 3.76e-233 3 VPREB3 ## 9 7.25e-165 4.41 0.577 0.055 9.95e-161 4 GZMK ## 10 3.27e- 88 3.74 0.419 0.061 4.48e- 84 4 GZMH ## 11 1.69e-212 5.43 0.506 0.01 2.32e-208 5 CDKN1C ## 12 8.23e-168 5.88 0.37 0.005 1.13e-163 5 CKB ## 13 8.10e-179 6.22 0.471 0.013 1.11e-174 6 AKR1C3 ## 14 5.38e-112 6.07 0.29 0.007 7.38e-108 6 SH2D1B ## 15 1.48e-220 7.63 0.812 0.011 2.03e-216 7 FCER1A ## 16 1.46e-207 8.03 0.5 0.002 2.00e-203 7 SERPINF1 ## 17 0 14.4 0.615 0 0 8 LY6G6F ## 18 7.32e-222 13.9 0.385 0 1.00e-217 8 RP11-879F14.2 1.6.1 æ¯”è¾ƒæŸä¸ªåŸºå› åœ¨å‡ ä¸ªclusterä¹‹é—´çš„è¡¨è¾¾é‡ å°æç´å›¾ VlnPlot(pbmc, features = c(&quot;PPBP&quot;, &quot;S100A9&quot;)) åœ¨umapå›¾ä¸Šæ ‡è®° FeaturePlot(pbmc, features = c(&quot;MS4A1&quot;, &quot;GNLY&quot;, &quot;CD3E&quot;, &quot;CD14&quot;, &quot;FCER1A&quot;, &quot;FCGR3A&quot;, &quot;LYZ&quot;, &quot;PPBP&quot;, &quot;CD8A&quot;)) top10 &lt;- pbmc.markers %&gt;% group_by(cluster) %&gt;% top_n(n = 10, wt = avg_log2FC) 1.6.2 markeråŸºå› çš„çƒ­å›¾ library(ggplot2) DoHeatmap(pbmc, features = top10$gene) + NoLegend() DotPlot(pbmc,features = unique(top10$gene))+RotatedAxis() RidgePlot(pbmc,features = &quot;RPS12&quot;) 1.7 æ ¹æ®markeråŸºå› ç¡®å®šç»†èƒ a = read.delim(&quot;../supp/markers.txt&quot;, header = F) gt = split(a[,2],a[,1]) # unstack(a[,c(2,1)]) DotPlot(pbmc, features = gt,cols = &quot;RdYlBu&quot;) + RotatedAxis() new.cluster.ids &lt;- c(&quot;Naive CD4 T&quot;, &quot;CD14+ Mono&quot;, &quot;Memory CD4 T&quot;, &quot;B&quot;, &quot;CD8 T&quot;, &quot;FCGR3A+ Mono&quot;, &quot;NK&quot;, &quot;DC&quot;, &quot;Platelet&quot;) names(new.cluster.ids) &lt;- levels(pbmc) seu.obj &lt;- RenameIdents(pbmc, new.cluster.ids) p1 &lt;- DimPlot(seu.obj, reduction = &quot;umap&quot;, label = TRUE, pt.size = 0.5) + NoLegend() p1 "],["å•æ ·æœ¬åˆ†æ.html", "ç¬¬ 2 ç«  å•æ ·æœ¬åˆ†æ 2.1 åˆ›å»ºSeuratå¯¹è±¡ 2.2 é™ç»´èšç±»åˆ†ç¾¤ 2.3 maker åŸºå›  2.4 maker åŸºå› å¯è§†åŒ– 2.5 æ³¨é‡Šäºšç¾¤", " ç¬¬ 2 ç«  å•æ ·æœ¬åˆ†æ 2.1 åˆ›å»ºSeuratå¯¹è±¡ #https://www.ncbi.nlm.nih.gov/pmc/articles/PMC10039079/ #untar(&quot;GSE218208_RAW.tar&quot;) rm(list = ls()) a = data.table::fread(&quot;GSM6736629_10x-PBMC-1_ds0.1974_CountMatrix.tsv.gz&quot;,data.table = F) a[1:4,1:4] ## alias:gene AAACCCAAGTAGGGTC AAACCCACACCATTCC AAACCCATCTACACTT ## 1 TSPAN6:ENSG00000000003 0 0 0 ## 2 DPM1:ENSG00000000419 0 1 0 ## 3 SCYL3:ENSG00000000457 0 0 0 ## 4 C1orf112:ENSG00000000460 0 0 0 library(tidyverse) a$`alias:gene` = str_split(a$`alias:gene`,&quot;:&quot;,simplify = T)[,1] #str_split_i(a$`alias:gene`,&quot;:&quot;,i = 1) a = distinct(a,`alias:gene`,.keep_all = T) a = column_to_rownames(a,var = &quot;alias:gene&quot;) a[1:4,1:4] ## AAACCCAAGTAGGGTC AAACCCACACCATTCC AAACCCATCTACACTT AAACGAAAGCACGTCC ## TSPAN6 0 0 0 0 ## DPM1 0 1 0 0 ## SCYL3 0 0 0 0 ## C1orf112 0 0 0 0 library(Seurat) pbmc &lt;- CreateSeuratObject(counts = a, project = &quot;a&quot;, min.cells = 3, min.features = 200) 2.1.0.1 2.è´¨æ§ pbmc[[&quot;percent.mt&quot;]] &lt;- PercentageFeatureSet(pbmc, pattern = &quot;^MT-&quot;) head(pbmc@meta.data, 3) ## orig.ident nCount_RNA nFeature_RNA percent.mt ## AAACCCAAGTAGGGTC a 10768 3213 7.030089 ## AAACCCACACCATTCC a 4102 1676 5.046319 ## AAACCCATCTACACTT a 4694 1740 6.305922 VlnPlot(pbmc, features = c(&quot;nFeature_RNA&quot;, &quot;nCount_RNA&quot;, &quot;percent.mt&quot;), ncol = 3, pt.size = 0.5) pbmc = subset(pbmc,nFeature_RNA &lt; 4200 &amp; nCount_RNA &lt; 18000 &amp; percent.mt &lt; 18) 2.2 é™ç»´èšç±»åˆ†ç¾¤ f = &quot;obj.Rdata&quot; if(!file.exists(f)){ pbmc = pbmc %&gt;% NormalizeData() %&gt;% FindVariableFeatures() %&gt;% ScaleData(features = rownames(.)) %&gt;% RunPCA(features = VariableFeatures(.)) %&gt;% FindNeighbors(dims = 1:15) %&gt;% FindClusters(resolution = 0.5) %&gt;% RunUMAP(dims = 1:15) %&gt;% RunTSNE(dims = 1:15) save(pbmc,file = f) } load(f) ElbowPlot(pbmc) p1 &lt;- DimPlot(pbmc, reduction = &quot;umap&quot;,label = T)+NoLegend();p1 2.3 maker åŸºå›  library(dplyr) f = &quot;markers.Rdata&quot; if(!file.exists(f)){ pbmc.markers &lt;- FindAllMarkers(pbmc, only.pos = TRUE,min.pct = 0.25) save(pbmc.markers,file = f) } load(f) mks = pbmc.markers %&gt;% group_by(cluster) %&gt;% top_n(n = 2, wt = avg_log2FC) g = unique(mks$gene) 2.4 maker åŸºå› å¯è§†åŒ– DoHeatmap(pbmc, features = g) + NoLegend()+ scale_fill_gradientn(colors = c(&quot;#2fa1dd&quot;, &quot;white&quot;, &quot;#f87669&quot;)) DotPlot(pbmc, features = g,cols = &quot;RdYlBu&quot;) + RotatedAxis() VlnPlot(pbmc, features = g[1:3]) FeaturePlot(pbmc, features = g[1:4]) 2.5 æ³¨é‡Šäºšç¾¤ æ‰‹åŠ¨æ³¨é‡Š a = read.delim(&quot;../supp/markers.txt&quot;,header = F) gt = split(a[,2],a[,1]) DotPlot(pbmc, features = gt,cols = &quot;RdYlBu&quot;) + RotatedAxis() writeLines(paste0(0:11,&quot;,&quot;)) ## 0, ## 1, ## 2, ## 3, ## 4, ## 5, ## 6, ## 7, ## 8, ## 9, ## 10, ## 11, celltype = read.table(&quot;anno.txt&quot;,sep = &quot;,&quot;) #è‡ªå·±ç…§ç€DotPlotå›¾å¡«çš„ celltype ## V1 V2 ## 1 0 Naive CD4 T ## 2 1 CD14+ Mono ## 3 2 B ## 4 3 CD8 T ## 5 4 NK ## 6 5 Naive CD4 T ## 7 6 Naive CD4 T ## 8 7 FCGR3A+ Mono ## 9 8 CD14+ Mono ## 10 9 Platelet ## 11 10 DC ## 12 11 DC new.cluster.ids &lt;- celltype$V2 names(new.cluster.ids) &lt;- levels(pbmc) seu.obj &lt;- RenameIdents(pbmc, new.cluster.ids) save(seu.obj,file = &quot;seu.obj.Rdata&quot;) p2 &lt;- DimPlot(seu.obj, reduction = &quot;umap&quot;, label = TRUE, pt.size = 0.5) + NoLegend() p2 è‡ªåŠ¨æ³¨é‡Š library(celldex) library(SingleR) ls(&quot;package:celldex&quot;) ## [1] &quot;BlueprintEncodeData&quot; &quot;DatabaseImmuneCellExpressionData&quot; ## [3] &quot;defineTextQuery&quot; &quot;fetchLatestVersion&quot; ## [5] &quot;fetchMetadata&quot; &quot;fetchReference&quot; ## [7] &quot;HumanPrimaryCellAtlasData&quot; &quot;ImmGenData&quot; ## [9] &quot;listReferences&quot; &quot;listVersions&quot; ## [11] &quot;MonacoImmuneData&quot; &quot;MouseRNAseqData&quot; ## [13] &quot;NovershternHematopoieticData&quot; &quot;saveReference&quot; ## [15] &quot;searchReferences&quot; &quot;surveyReferences&quot; f = &quot;../supp/single_ref/ref_BlueprintEncode.RData&quot; if(!file.exists(f)){ ref &lt;- celldex::BlueprintEncodeData() save(ref,file = f) } ref &lt;- get(load(f)) library(BiocParallel) scRNA = pbmc test = scRNA@assays$RNA$data pred.scRNA &lt;- SingleR(test = test, ref = ref, labels = ref$label.main, clusters = scRNA@active.ident) pred.scRNA$pruned.labels ## [1] &quot;CD4+ T-cells&quot; &quot;Monocytes&quot; &quot;B-cells&quot; &quot;CD8+ T-cells&quot; &quot;NK cells&quot; ## [6] &quot;CD4+ T-cells&quot; &quot;CD4+ T-cells&quot; &quot;Monocytes&quot; &quot;Monocytes&quot; &quot;Monocytes&quot; ## [11] &quot;DC&quot; &quot;Monocytes&quot; #æŸ¥çœ‹æ³¨é‡Šå‡†ç¡®æ€§ plotScoreHeatmap(pred.scRNA, clusters=pred.scRNA@rownames, fontsize.row = 9,show_colnames = T) new.cluster.ids &lt;- pred.scRNA$pruned.labels names(new.cluster.ids) &lt;- levels(scRNA) levels(scRNA) ## [1] &quot;0&quot; &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; &quot;5&quot; &quot;6&quot; &quot;7&quot; &quot;8&quot; &quot;9&quot; &quot;10&quot; &quot;11&quot; scRNA &lt;- RenameIdents(scRNA,new.cluster.ids) levels(scRNA) ## [1] &quot;CD4+ T-cells&quot; &quot;Monocytes&quot; &quot;B-cells&quot; &quot;CD8+ T-cells&quot; &quot;NK cells&quot; ## [6] &quot;DC&quot; p3 &lt;- DimPlot(scRNA, reduction = &quot;umap&quot;,label = T,pt.size = 0.5) + NoLegend() p2+p3 "],["å•ç»†èƒäºŒæ¬¡åˆ†ç¾¤.html", "ç¬¬ 3 ç«  å•ç»†èƒäºŒæ¬¡åˆ†ç¾¤ 3.1 ç¤ºä¾‹æ•°æ® 3.2 äºŒæ¬¡åˆ†ç¾¤ 3.3 markeråŸºå› åŠå…¶å¯è§†åŒ– 3.4 æ”¾å›åŸæ¥çš„Seuratå¯¹è±¡é‡Œé¢", " ç¬¬ 3 ç«  å•ç»†èƒäºŒæ¬¡åˆ†ç¾¤ èƒŒæ™¯çŸ¥è¯† Seuraté‡Œçš„FindClusterså‡½æ•°è®¾ç½®çš„resolutionæ•°å€¼è¶Šå¤§ï¼Œåˆ†ç¾¤çš„æ•°é‡å°±è¶Šå¤šï¼Œä½†æ˜¯å½“å•ç»†èƒæ•°é‡å¤ªå¤šçš„æ—¶å€™ï¼Œä¼šé‡åˆ°resolutionå†å˜å¤§ï¼Œåˆ†ç¾¤çš„æ•°é‡ä¹Ÿä¸å†å¢åŠ çš„æƒ…å†µã€‚ä¸€æ¬¡åˆ†ç¾¤åˆ†ä¸å¼€æ—¶å°±ä¼šéœ€è¦äºŒæ¬¡åˆ†ç¾¤ã€‚ 3.1 ç¤ºä¾‹æ•°æ® è¿™é‡Œçš„ç¤ºä¾‹æ•°æ®seu.obj.Rdataæ˜¯GSE218208é™ç»´èšç±»åˆ†ç¾¤çš„ç»“æœï¼Œå› ä¸ºæ–‡ä»¶å¤ªå¤§ï¼Œæ²¡æœ‰ç›´æ¥æ”¾è¿›æ–‡ä»¶å¤¹é‡Œï¼Œå¦‚æœloadæŠ¥é”™å°±è‡ªå·±è¿è¡Œä¸€ä¸‹éš”å£GSE218208çš„ä»£ç å¾—åˆ°è¿™ä¸ªæ–‡ä»¶å†è·‘ã€‚ rm(list = ls()) library(Seurat) library(dplyr) load(&quot;../2.GSE218208/seu.obj.Rdata&quot;) p1 = DimPlot(seu.obj, reduction = &quot;umap&quot;,label=T)+NoLegend() p1 3.2 äºŒæ¬¡åˆ†ç¾¤ è¿™é‡Œä»¥æ ‘çªç»†èƒ(DC)ä¸ºä¾‹è¿›è¡ŒäºŒæ¬¡åˆ†ç¾¤ï¼Œæƒ³è¦åˆ‡æ¢åˆ«çš„ç»†èƒç±»å‹ç›´æ¥ä¿®æ”¹ä¸‹é¢çš„my_subå³å¯ã€‚ æ ¸å¿ƒå°±æ˜¯æå–æ„Ÿå…´è¶£çš„äºšç¾¤çš„ç»†èƒï¼Œåé¢å°±æ˜¯æ ‡å‡†æµç¨‹å’Œå¯è§†åŒ–äº†ï¼Œæ²¡æœ‰åŒºåˆ« my_sub = &quot;DC&quot; #â­ sub.cells &lt;- subset(seu.obj, idents = my_sub) f = &quot;obj.Rdata&quot; if(!file.exists(f)){ sub.cells = sub.cells %&gt;% NormalizeData() %&gt;% FindVariableFeatures() %&gt;% ScaleData(features = rownames(.)) %&gt;% RunPCA(features = VariableFeatures(.)) %&gt;% FindNeighbors(dims = 1:15) %&gt;% FindClusters(resolution = 0.5) %&gt;% RunUMAP(dims = 1:15) save(sub.cells,file = f) } ## Modularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck ## ## Number of nodes: 88 ## Number of edges: 1998 ## ## Running Louvain algorithm... ## Maximum modularity in 10 random starts: 0.7358 ## Number of communities: 2 ## Elapsed time: 0 seconds load(f) DimPlot(sub.cells, reduction = &#39;umap&#39;,label = T)+NoLegend() 3.3 markeråŸºå› åŠå…¶å¯è§†åŒ– sub.cells.markers &lt;- FindAllMarkers(sub.cells, only.pos = TRUE, min.pct = 0.25, logfc.threshold = 0.25) top10 &lt;- sub.cells.markers %&gt;% group_by(cluster) %&gt;% top_n(n = 10, wt = avg_log2FC) %&gt;% pull(gene);top10 ## [1] &quot;LYZ&quot; &quot;TIMP1&quot; &quot;GPAT3&quot; &quot;ITGAX&quot; &quot;SAMSN1&quot; &quot;OLR1&quot; &quot;FPR3&quot; ## [8] &quot;EREG&quot; &quot;FCN1&quot; &quot;AKAP12&quot; &quot;JCHAIN&quot; &quot;IGKC&quot; &quot;MZB1&quot; &quot;PACSIN1&quot; ## [15] &quot;WNT10A&quot; &quot;MAP1A&quot; &quot;VASH2&quot; &quot;NIBAN3&quot; &quot;SMPD3&quot; &quot;TNFRSF4&quot; VlnPlot(sub.cells, features = top10) RidgePlot(sub.cells, features = top10) FeaturePlot(sub.cells, features = top10) DotPlot(sub.cells,features = top10)+ RotatedAxis() DoHeatmap(sub.cells, features = top10) + NoLegend() 3.4 æ”¾å›åŸæ¥çš„Seuratå¯¹è±¡é‡Œé¢ ä¸Šé¢çš„umapå›¾æ˜¯æ„Ÿå…´è¶£çš„å•ç‹¬çš„å±•ç¤ºï¼Œä¹Ÿå¯ä»¥æŠŠå®ƒæ”¾å›åŸæ¥çš„seuratå¯¹è±¡é‡Œã€‚ sub.cells@meta.data$celltype = paste0(&quot;M&quot;,sub.cells$seurat_clusters) seu.obj$celltype = as.character(Idents(seu.obj)) seu.obj$celltype = ifelse(seu.obj$celltype==my_sub, sub.cells$celltype[match(colnames(seu.obj),colnames(sub.cells))], seu.obj$celltype) Idents(seu.obj) = seu.obj$celltype p2 = DimPlot(seu.obj,label = T)+NoLegend() p1+p2 "],["å¤šæ ·æœ¬åˆ†æ.html", "ç¬¬ 4 ç«  å¤šæ ·æœ¬åˆ†æ 4.1 æ•´ç†æ•°æ® 4.2 æ‰¹é‡è¯»å– 4.3 è´¨æ§æŒ‡æ ‡ 4.4 æ•´åˆé™ç»´èšç±»åˆ†ç¾¤ 4.5 æ³¨é‡Š 4.6 åˆ†ç»„å¯è§†åŒ–åŠç»„ä»¶ç»†èƒæ¯”ä¾‹æ¯”è¾ƒ 4.7 å·®å¼‚åˆ†æ 4.8 ä¼ªbulk è½¬å½•ç»„å·®å¼‚åˆ†æ", " ç¬¬ 4 ç«  å¤šæ ·æœ¬åˆ†æ è¿™ç¯‡æ–‡ç« ä»‹ç»çš„æ˜¯æœ‰åˆ†ç»„çš„å•ç»†èƒæ•°æ®æ€æ ·åˆ†æï¼Œæ•°æ®æ¥è‡ªGEOçš„GSE231920ï¼Œæœ‰3ä¸ªtreatï¼Œ3ä¸ªcontrolæ ·æœ¬ï¼Œä»£ç å®Œæ•´ï¼Œå¯ä»¥è‡ªè¡Œä¸‹è½½æ•°æ®è·‘ä¸€è·‘ï¼Œä½†è¯·æ³¨æ„ç»†èƒæ•°é‡æ˜¯6wï¼Œå¯¹è®¡ç®—èµ„æºè¦æ±‚è¾ƒé«˜ï¼Œè‡ªå·±çš„ç”µè„‘è·‘ä¸åŠ¨ï¼Œéœ€è¦åœ¨æœåŠ¡å™¨ä¸Šè·‘ã€‚ 4.1 æ•´ç†æ•°æ® å› ä¸ºæ•°æ®ç»„ç»‡çš„ä¸æ˜¯æ¯ä¸ªæ ·æœ¬ä¸€ä¸ªæ–‡ä»¶å¤¹çš„å½¢å¼ï¼Œæ‰€ä»¥éœ€è¦è‡ªè¡Œæ•´ç†ï¼Œå‚è€ƒä»£ç å¦‚ä¸‹ï¼Œæ³¨æ„è¿™æ®µæ”¹åçš„ä»£ç ä¸è¦åå¤è¿è¡Œï¼š GSE231920_RAW.taræ˜¯ä»GEOé¡µé¢ä¸Šä¸‹è½½çš„è¡¥å……æ–‡ä»¶ï¼Œå¤ªå¤§äº†æ²¡æ”¾è¿›æ–‡ä»¶å¤¹é‡Œï¼Œå¯ä»¥è‡ªå·±ä¸‹è½½ã€‚ #untar(&quot;GSE231920_RAW.tar&quot;,exdir = &quot;GSE231920_RAW&quot;) #unlink(&quot;GSE231920_RAW.tar&quot;) if(!require(&quot;multtest&quot;))BiocManager::install(&#39;multtest&#39;,update = F,ask = F) if(!require(&quot;metap&quot;))install.packages(&#39;metap&#39;,update = F,ask = F) library(stringr) fs = paste0(&quot;GSE231920_RAW/&quot;,dir(&quot;GSE231920_RAW/&quot;)) fs samples = dir(&quot;GSE231920_RAW/&quot;) %&gt;% str_split_i(&quot;_&quot;,2) %&gt;% unique();samples if(!dir.exists(&quot;01_data&quot;))dir.create(&quot;01_data&quot;) #ä¸ºæ¯ä¸ªæ ·æœ¬åˆ›å»ºå•ç‹¬çš„æ–‡ä»¶å¤¹ lapply(samples, function(s){ ns = paste0(&quot;01_data/&quot;,s) if(!file.exists(ns))dir.create(ns,recursive = T) }) #æ¯ä¸ªæ ·æœ¬çš„ä¸‰ä¸ªæ–‡ä»¶å¤åˆ¶åˆ°å•ç‹¬çš„æ–‡ä»¶å¤¹ lapply(fs, function(s){ #s = fs[1] for(i in 1:length(samples)){ #i = 1 if(str_detect(s,samples[[i]])){ file.copy(s,paste0(&quot;01_data/&quot;,samples[[i]])) } } }) #æ–‡ä»¶åå­—ä¿®æ”¹ on = paste0(&quot;01_data/&quot;,dir(&quot;01_data/&quot;,recursive = T));on nn = str_remove(on,&quot;GSM\\\\d+_sample\\\\d_&quot;);nn file.rename(on,nn) ä»£ç ä¸»è¦å‚è€ƒï¼š https://satijalab.org/seurat/articles/integration_introduction 4.2 æ‰¹é‡è¯»å– rm(list = ls()) library(Seurat) rf = &quot;sce.all.Rdata&quot; if(!file.exists(rf)){ f = dir(&quot;01_data/&quot;) scelist = list() for(i in 1:length(f)){ pda &lt;- Read10X(paste0(&quot;01_data/&quot;,f[[i]])) scelist[[i]] &lt;- CreateSeuratObject(counts = pda, project = f[[i]]) print(dim(scelist[[i]])) } sce.all = merge(scelist[[1]],scelist[-1]) sce.all = JoinLayers(sce.all) #â­æŠ½æ · set.seed(313) sce.all = subset(sce.all,downsample=500)#æ¯ä¸ªæ ·æœ¬æŠ½500ä¸ªç»†èƒ save(sce.all,file = rf) } load(rf) head(sce.all@meta.data) table(sce.all$orig.ident) sum(table(Idents(sce.all))) 4.3 è´¨æ§æŒ‡æ ‡ sce.all[[&quot;percent.mt&quot;]] &lt;- PercentageFeatureSet(sce.all, pattern = &quot;^MT-&quot;) sce.all[[&quot;percent.rp&quot;]] &lt;- PercentageFeatureSet(sce.all, pattern = &quot;^RP[SL]&quot;) sce.all[[&quot;percent.hb&quot;]] &lt;- PercentageFeatureSet(sce.all, pattern = &quot;^HB[^(P)]&quot;) head(sce.all@meta.data, 3) VlnPlot(sce.all, features = c(&quot;nFeature_RNA&quot;, &quot;nCount_RNA&quot;, &quot;percent.mt&quot;, &quot;percent.rp&quot;, &quot;percent.hb&quot;), ncol = 3,pt.size = 0, group.by = &quot;orig.ident&quot;) sce.all = subset(sce.all,percent.mt&lt;25) 4.4 æ•´åˆé™ç»´èšç±»åˆ†ç¾¤ f = &quot;obj.Rdata&quot; library(harmony) if(!file.exists(f)){ sce.all = sce.all %&gt;% NormalizeData() %&gt;% FindVariableFeatures() %&gt;% ScaleData(features = rownames(.)) %&gt;% RunPCA(pc.genes = VariableFeatures(.)) %&gt;% RunHarmony(&quot;orig.ident&quot;) %&gt;% FindNeighbors(dims = 1:15, reduction = &quot;harmony&quot;) %&gt;% FindClusters(resolution = 0.5) %&gt;% RunUMAP(dims = 1:15,reduction = &quot;harmony&quot;) %&gt;% RunTSNE(dims = 1:15,reduction = &quot;harmony&quot;) save(sce.all,file = f) } load(f) ElbowPlot(sce.all) UMAPPlot(sce.all,label = T) TSNEPlot(sce.all,label = T) 4.5 æ³¨é‡Š â­è¿™é‡Œç”¨äº†ä¸¤ä¸ªå‚è€ƒæ•°æ® library(celldex) library(SingleR) ls(&quot;package:celldex&quot;) f = &quot;../supp/single_ref/ref_BlueprintEncode.RData&quot; if(!file.exists(f)){ ref &lt;- celldex::ref_BlueprintEncode() save(ref,file = f) } f2 = &quot;../supp/single_ref/ref_HumanPrimaryCellAtlasData.RData&quot; if(!file.exists(f2)){ ref &lt;- celldex::HumanPrimaryCellAtlasData() save(ref,file = f2) } ref &lt;- list(get(load(f)), get(load(f2))) library(BiocParallel) scRNA = sce.all test = scRNA@assays$RNA$data pred.scRNA &lt;- SingleR(test = test, ref = ref, labels = list(ref[[1]]$label.main,ref[[2]]$label.main), clusters = scRNA@active.ident) pred.scRNA$pruned.labels #æŸ¥çœ‹æ³¨é‡Šå‡†ç¡®æ€§ #plotScoreHeatmap(pred.scRNA, clusters=pred.scRNA@rownames, fontsize.row = 9,show_colnames = T) new.cluster.ids &lt;- pred.scRNA$pruned.labels new.cluster.ids[is.na(new.cluster.ids)] = &quot;unknown&quot; names(new.cluster.ids) &lt;- levels(scRNA) levels(scRNA) scRNA &lt;- RenameIdents(scRNA,new.cluster.ids) levels(scRNA) p2 &lt;- DimPlot(scRNA, reduction = &quot;umap&quot;,label = T,pt.size = 0.5) + NoLegend() p2 4.6 åˆ†ç»„å¯è§†åŒ–åŠç»„ä»¶ç»†èƒæ¯”ä¾‹æ¯”è¾ƒ scRNA$seurat_annotations = Idents(scRNA) table(scRNA$orig.ident) library(tinyarray) pd = geo_download(&quot;GSE231920&quot;)$pd pd$title scRNA$group = ifelse(scRNA$orig.ident %in% c(&quot;sample1&quot;,&quot;sample2&quot;,&quot;sample3&quot;), &quot;treat&quot;,&quot;control&quot;) DimPlot(scRNA, reduction = &quot;umap&quot;, group.by = &quot;group&quot;) å¯ä»¥è®¡ç®—æ¯ä¸ªäºšç¾¤çš„ç»†èƒæ•°é‡å’Œå å…¨éƒ¨ç»†èƒçš„æ¯”ä¾‹ # æ¯ç§ç»†èƒçš„æ•°é‡å’Œæ¯”ä¾‹ cell_counts &lt;- table(Idents(scRNA)) cell.all &lt;- cbind(cell_counts = cell_counts, cell_Freq = round(prop.table(cell_counts)*100,2)) #å„ç»„ä¸­æ¯ç§ç»†èƒçš„æ•°é‡å’Œæ¯”ä¾‹ cell.num.group &lt;- table(Idents(scRNA), scRNA$group) cell.freq.group &lt;- round(prop.table(cell.num.group, margin = 2) *100,2) cell.all = cbind(cell.all,cell.num.group,cell.freq.group) cell.all = cell.all[,c(1,3,4,2,5,6)] colnames(cell.all) = paste(rep(c(&quot;all&quot;,&quot;control&quot;,&quot;treat&quot;),times = 2), rep(c(&quot;count&quot;,&quot;freq&quot;),each = 3),sep = &quot;_&quot;) cell.all 4.7 å·®å¼‚åˆ†æ æ‰¾æŸç§ç»†èƒåœ¨ä¸åŒç»„é—´çš„å·®å¼‚åŸºå›  table(scRNA$seurat_annotations) sub.markers &lt;- FindConservedMarkers(scRNA, ident.1 = &quot;NK cells&quot;, grouping.var = &quot;group&quot;, min.pct = 0.25, logfc.threshold = 0.25,verbose = F) head(sub.markers) ç»„é—´æ¯”è¾ƒçš„æ°”æ³¡å›¾ markers.to.plot = c(&quot;CD3D&quot;, &quot;CREM&quot;, &quot;HSPH1&quot;, &quot;SELL&quot;, &quot;GIMAP5&quot;, &quot;CACYBP&quot;, &quot;GNLY&quot;, &quot;NKG7&quot;, &quot;CCL5&quot;, &quot;CD8A&quot;, &quot;MS4A1&quot;, &quot;CD79A&quot;, &quot;MIR155HG&quot;, &quot;NME1&quot;, &quot;FCGR3A&quot;, &quot;VMO1&quot;, &quot;CCL2&quot;, &quot;S100A9&quot;, &quot;HLA-DQA1&quot;, &quot;GPR183&quot;, &quot;PPBP&quot;, &quot;GNG11&quot;, &quot;HBA2&quot;, &quot;HBB&quot;, &quot;TSPAN13&quot;, &quot;IL3RA&quot;, &quot;PRSS57&quot;) #ä¸€ç»„æ„Ÿå…´è¶£çš„åŸºå›  #å¦‚æœidentsæœ‰NAä¼šæŠ¥é”™https://github.com/satijalab/seurat/issues/8772 #scRNA &lt;- subset(scRNA, seurat_annotations %in% na.omit(scRNA$seurat_annotations)) DotPlot(scRNA, features = markers.to.plot, cols = c(&quot;blue&quot;, &quot;red&quot;), dot.scale = 8, split.by = &quot;group&quot;) + RotatedAxis() FeaturePlot(scRNA, features = c(&quot;CD3D&quot;, &quot;GNLY&quot;, &quot;IFI6&quot;), split.by = &quot;group&quot;, max.cutoff = 3, cols = c(&quot;grey&quot;, &quot;red&quot;), reduction = &quot;umap&quot;) plots &lt;- VlnPlot(scRNA, features = c(&quot;LYZ&quot;, &quot;ISG15&quot;, &quot;CXCL10&quot;), split.by = &quot;group&quot;, group.by = &quot;seurat_annotations&quot;, pt.size = 0, combine = FALSE) library(patchwork) wrap_plots(plots = plots, ncol = 1) 4.8 ä¼ªbulk è½¬å½•ç»„å·®å¼‚åˆ†æ æ¯ä¸ªç»„è¦æœ‰å¤šä¸ªæ ·æœ¬æ‰èƒ½åš https://satijalab.org/seurat/articles/parsebio_sketch_integration bulk &lt;- AggregateExpression(scRNA, return.seurat = T, slot = &quot;counts&quot;, assays = &quot;RNA&quot;, group.by = c(&quot;seurat_annotations&quot;,&quot;orig.ident&quot;, &quot;group&quot;)) sub &lt;- subset(bulk, seurat_annotations == &quot;CD8+ T-cells&quot;) Idents(sub) &lt;- &quot;group&quot; de_markers &lt;- FindMarkers(sub, ident.1 = &quot;treat&quot;, ident.2 = &quot;control&quot;, slot = &quot;counts&quot;, test.use = &quot;DESeq2&quot;, verbose = F) de_markers$gene &lt;- rownames(de_markers) k1 = de_markers$avg_log2FC&lt; -1 &amp; de_markers$p_val &lt;0.01 k2 = de_markers$avg_log2FC&gt; 1 &amp; de_markers$p_val &lt;0.01 de_markers$change &lt;- ifelse(k1,&quot;down&quot;,ifelse(k2,&quot;up&quot;,&quot;not&quot;)) library(ggplot2) library(ggrepel) ggplot(de_markers, aes(avg_log2FC, -log10(p_val),color = change)) + geom_point(size = 2, alpha = 0.5) + geom_vline(xintercept = c(1,-1),linetype = 4)+ geom_hline(yintercept = -log10(0.01),linetype = 4)+ scale_color_manual(values = c(&quot;blue&quot;,&quot;grey&quot;,&quot;red&quot;))+ theme_bw() + ylab(&quot;-log10(unadjusted p-value)&quot;) "],["å•æ ·æœ¬æ‹Ÿæ—¶åºåˆ†æ.html", "ç¬¬ 5 ç«  å•æ ·æœ¬æ‹Ÿæ—¶åºåˆ†æ 5.1 æ„å»ºç»†èƒå‘è‚²è½¨è¿¹ 5.2 ç»˜å›¾å±•ç¤º", " ç¬¬ 5 ç«  å•æ ·æœ¬æ‹Ÿæ—¶åºåˆ†æ ** èƒŒæ™¯çŸ¥è¯† ** åšæ‹Ÿæ—¶åºåˆ†ææ˜¯ä¸ºäº†æ¢ç´¢è‡ªå·±æ„Ÿå…´è¶£çš„å‡ ç§ç»†èƒä¹‹é—´çš„å‘è‚²å…³ç³»ï¼Œä¸€èˆ¬ä¸æ˜¯ç”¨å…¨éƒ¨ç±»å‹çš„ç»†èƒæ¥åšçš„ã€‚ å¦‚æœè®©aiæ¥è¯´æ‹Ÿæ—¶åºçš„ç›®çš„é‚£å°±æ¯”æˆ‘è¯´çš„å¤š: &gt; æ‹Ÿæ—¶åºåˆ†æï¼ˆPseudo-time analysisï¼‰æ˜¯ä¸€ç§ç”¨äºç†è§£ç»†èƒçŠ¶æ€å’Œç»†èƒå‘½è¿å˜åŒ–çš„è®¡ç®—ç”Ÿç‰©å­¦æ–¹æ³•ã€‚è¿™ç§åˆ†æé€šå¸¸ç”¨äºå•ç»†èƒæµ‹åºæ•°æ®ï¼Œå…¶ç›®çš„æ˜¯é‡å»ºç»†èƒå‘è‚²æˆ–ç–¾ç—…è¿›ç¨‹ä¸­çš„æ—¶é—´åºåˆ—ï¼Œå³ä½¿å®é™…çš„æ—¶é—´ä¿¡æ¯ä¸å¯ç”¨ã€‚ä»¥ä¸‹æ˜¯è¿›è¡Œæ‹Ÿæ—¶åºåˆ†æçš„å‡ ä¸ªä¸»è¦ç›®çš„ï¼š 1. ç»†èƒçŠ¶æ€æ¨æ–­ï¼šé€šè¿‡åˆ†æå•ä¸ªç»†èƒçš„åŸºå› è¡¨è¾¾æ¨¡å¼ï¼Œæ¨æ–­ç»†èƒåœ¨ç”Ÿç‰©å­¦è¿‡ç¨‹ä¸­æ‰€å¤„çš„çŠ¶æ€ã€‚ 2. ç»†èƒè½¨è¿¹è¿½è¸ªï¼šé‡å»ºç»†èƒä»ä¸€ç§çŠ¶æ€è½¬å˜åˆ°å¦ä¸€ç§çŠ¶æ€çš„è·¯å¾„ï¼Œè¿™æœ‰åŠ©äºç†è§£ç»†èƒåˆ†åŒ–ã€å‘è‚²æˆ–ç–¾ç—…è¿›å±•çš„è¿‡ç¨‹ã€‚ 3. ç»†èƒå‘½è¿é¢„æµ‹ï¼šé¢„æµ‹ç»†èƒéšæ—¶é—´å¯èƒ½é‡‡å–çš„å‘è‚²è½¨è¿¹ï¼Œå°¤å…¶æ˜¯åœ¨å¹²ç»†èƒåˆ†åŒ–æˆ–ç™Œç—‡å‘å±•çš„ç ”ç©¶ä¸­ã€‚ 4. åŠ¨æ€è¿‡ç¨‹å»ºæ¨¡ï¼šåˆ›å»ºç»†èƒçŠ¶æ€å˜åŒ–çš„åŠ¨æ€æ¨¡å‹ï¼Œè¿™æœ‰åŠ©äºæ­ç¤ºç»†èƒè¡Œä¸ºçš„å†…åœ¨è§„å¾‹å’Œè°ƒæ§æœºåˆ¶ã€‚ 5. ç»†èƒäºšç¾¤è¯†åˆ«ï¼šåœ¨å¤æ‚çš„ç»†èƒç¾¤ä½“ä¸­è¯†åˆ«ä¸åŒçš„ç»†èƒäºšç¾¤ï¼Œå¹¶ç†è§£å®ƒä»¬åœ¨ç”Ÿç‰©å­¦è¿‡ç¨‹ä¸­çš„ä½œç”¨ã€‚ 6. åŸºå› è°ƒæ§ç½‘ç»œæ¨æ–­ï¼šé€šè¿‡åˆ†æåŸºå› è¡¨è¾¾éšâ€œæ‹Ÿæ—¶é—´â€çš„å˜åŒ–ï¼Œæ¨æ–­åŸºå› è°ƒæ§ç½‘ç»œå’Œä¿¡å·ä¼ å¯¼é€”å¾„ã€‚ 7. ç–¾ç—…æœºç†æ¢ç´¢ï¼šåœ¨ç–¾ç—…ç ”ç©¶ä¸­ï¼Œæ‹Ÿæ—¶åºåˆ†ææœ‰åŠ©äºæ­ç¤ºç–¾ç—…å‘ç”Ÿå’Œå‘å±•çš„åˆ†å­æœºåˆ¶ã€‚ 8. è¯ç‰©ä½œç”¨æœºåˆ¶ç ”ç©¶ï¼šé€šè¿‡è§‚å¯Ÿè¯ç‰©å¤„ç†å‰åç»†èƒçŠ¶æ€çš„å˜åŒ–ï¼Œç ”ç©¶è¯ç‰©çš„ä½œç”¨æœºåˆ¶å’Œæ•ˆæœã€‚ æ‹Ÿæ—¶åºåˆ†ææ˜¯ä¸€ç§å¼ºå¤§çš„å·¥å…·ï¼Œå®ƒå¯ä»¥å¸®åŠ©ç ”ç©¶è€…åœ¨æ²¡æœ‰ç›´æ¥æ—¶é—´æ ‡è®°çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡åŸºå› è¡¨è¾¾æ•°æ®æ¥æ¢ç´¢ç»†èƒçŠ¶æ€çš„å˜åŒ–å’ŒåŠ¨æ€è¿‡ç¨‹ã€‚è¿™ç§æ–¹æ³•åœ¨å•ç»†èƒç”Ÿç‰©å­¦ã€å‘è‚²ç”Ÿç‰©å­¦ã€ç™Œç—‡ç”Ÿç‰©å­¦å’Œç¥ç»ç§‘å­¦ç­‰é¢†åŸŸæœ‰ç€å¹¿æ³›çš„åº”ç”¨ã€‚ æœ¬ç¯‡ä»£ç æ˜¯å¤„ç†å•æ ·æœ¬æ•°æ®çš„ï¼Œä¸‹ä¸€ç¯‡æ˜¯å¤šæ ·æœ¬çš„ã€‚ rm(list = ls()) library(Seurat) library(monocle) library(dplyr) load(&quot;../2.GSE218208/seu.obj.Rdata&quot;) DimPlot(seu.obj,label = T) table(Idents(seu.obj)) ## ## Naive CD4 T CD14+ Mono B CD8 T NK FCGR3A+ Mono ## 1675 1206 598 406 337 125 ## Platelet DC ## 48 88 è¿™é‡Œçš„ç¤ºä¾‹æ•°æ®seu.obj.Rdataæ˜¯GSE218208é™ç»´èšç±»åˆ†ç¾¤çš„ç»“æœï¼Œå› ä¸ºæ–‡ä»¶å¤ªå¤§ï¼Œæ²¡æœ‰ç›´æ¥æ”¾è¿›æ–‡ä»¶å¤¹é‡Œï¼Œå¦‚æœloadæŠ¥é”™å°±è‡ªå·±è¿è¡Œä¸€ä¸‹éš”å£GSE218208çš„ä»£ç å¾—åˆ°è¿™ä¸ªæ–‡ä»¶å†è·‘ã€‚ seu.obj$celltype = as.character(Idents(seu.obj)) ğŸ‘†å°†æ³¨é‡Šçš„ç»“æœæ·»åŠ åˆ°äº†metaè¡¨æ ¼é‡Œé¢æˆä¸ºäº†celltypeåˆ—ã€‚ ä¸ºäº†èŠ‚çœè®¡ç®—èµ„æºæˆ‘ä»¬è¿˜æ˜¯æŠ½æ ·ï¼Œå®æˆ˜æ—¶ä¸èƒ½æŠ½æ ·å“¦ã€‚ä½ è·‘å®Œæˆ‘çš„ä»£ç æ¢ä¸ªåˆ«çš„ç»†èƒç±»å‹è·‘è·‘çœ‹ã€‚æ³¨æ„å·®å¼‚åˆ†æé‚£é‡ŒåŠ ä¸Šäº†å­˜åœ¨å³è·³è¿‡çš„ä»£ç ï¼Œæ¢äº†è¾“å…¥æ•°æ®æ˜¯è¦åˆ é™¤Rdataé‡æ–°è·‘ï¼Œæˆ–è€…æ˜¯æ¢ä¸€ä¸ªå·¥ä½œç›®å½•è·‘ã€‚ scRNA = subset(seu.obj,idents = c(&quot;CD14+ Mono&quot;,&quot;FCGR3A+ Mono&quot;)) set.seed(1234) scRNA = subset(scRNA,downsample = 100)#æ¯ç§ç»†èƒæŠ½100ä¸ª æå–æƒ³è¦ç ”ç©¶çš„ä¸¤ç§ç»†èƒã€‚ å› ä¸ºmonocleå’Œseuratæ˜¯ä¸¤ä¸ªä¸åŒçš„ä½“ç³»ï¼Œæ‰€ä»¥éœ€è¦å°†seuratå¯¹è±¡è½¬æ¢ä¸ºmonocleå¯ä»¥æ¥å—çš„CellDataSetå¯¹è±¡ã€‚è™½ç„¶monocle3å·²ç»å‡ºæ¥å¾ˆä¹…äº†ï¼Œä½†å¤§å®¶éƒ½ä¸çº¦è€ŒåŒçš„é€‰æ‹©monocle2ï¼Œå¤§æ¦‚å°±æ˜¯ä¹ æƒ¯äº†å§ã€‚ã€‚ ct &lt;- scRNA@assays$RNA$counts gene_ann &lt;- data.frame( gene_short_name = row.names(ct), row.names = row.names(ct) ) pd &lt;- new(&quot;AnnotatedDataFrame&quot;, data=scRNA@meta.data) fd &lt;- new(&quot;AnnotatedDataFrame&quot;, data=gene_ann) sc_cds &lt;- newCellDataSet( ct, phenoData = pd, featureData =fd, expressionFamily = negbinomial.size(), lowerDetectionLimit=1) sc_cds ## CellDataSet (storageMode: environment) ## assayData: 25988 features, 200 samples ## element names: exprs ## protocolData: none ## phenoData ## sampleNames: AAACCCAAGTAGGGTC AAAGGTAGTCTTGAGT ... TTTGGAGAGTCCCAGC ## (200 total) ## varLabels: orig.ident nCount_RNA ... Size_Factor (8 total) ## varMetadata: labelDescription ## featureData ## featureNames: TSPAN6 DPM1 ... AL357874.3 (25988 total) ## fvarLabels: gene_short_name ## fvarMetadata: labelDescription ## experimentData: use &#39;experimentData(object)&#39; ## Annotation: 5.1 æ„å»ºç»†èƒå‘è‚²è½¨è¿¹ é€‰æ‹©åŸºå› æœ‰ä¸åŒçš„ç­–ç•¥ï¼Œæ¯”å¦‚ 1.ä½¿ç”¨seuratç»™å‡ºçš„é«˜å˜åŒ–åŸºå›  2.æŒ‰ç…§å¹³å‡è¡¨è¾¾é‡å¤§äºæŸä¸ªæ•°å­—(æ¯”å¦‚0.1ï¼Œå®˜ç½‘ç”¨çš„æ˜¯è¿™ä¸ª)çš„åŸºå›  3.ä½¿ç”¨ä¸åŒç»†èƒç±»å‹ä¹‹é—´çš„å·®å¼‚åŸºå› ï¼ŒdifferentialGeneTestè®¡ç®—ã€‚ æˆ‘ä»¬é»˜è®¤ä½¿ç”¨çš„æ˜¯æœ€åä¸€ä¸ªç­–ç•¥ã€‚ sc_cds &lt;- estimateSizeFactors(sc_cds) sc_cds &lt;- estimateDispersions(sc_cds) table(scRNA@meta.data$celltype) ## ## CD14+ Mono FCGR3A+ Mono ## 100 100 fdif = &quot;diff_test_res.Rdata&quot; if(!file.exists(fdif)){ diff_test_res &lt;- differentialGeneTest(sc_cds, fullModelFormulaStr = &quot;~celltype&quot;, cores = 4) save(diff_test_res,file = fdif) } load(fdif) ordering_genes &lt;- row.names (subset(diff_test_res, qval &lt; 0.01)) #ç„¶åæ˜¯æŸ¥çœ‹åŸºå› ï¼Œè®¾ç½®ä¸ºæ’åºè¦ä½¿ç”¨çš„åŸºå›  head(ordering_genes) ## [1] &quot;CD99&quot; &quot;CASP10&quot; &quot;SLC25A5&quot; &quot;MCUB&quot; &quot;ITGAL&quot; &quot;TNFRSF12A&quot; sc_cds &lt;- setOrderingFilter(sc_cds, ordering_genes) plot_ordering_genes(sc_cds) #é™ç»´ sc_cds &lt;- reduceDimension(sc_cds) #ç»†èƒæ’åº sc_cds &lt;- orderCells(sc_cds) 5.2 ç»˜å›¾å±•ç¤º å‘è‚²è½¨è¿¹å›¾ library(ggsci) p1 = plot_cell_trajectory(sc_cds)+ scale_color_nejm() p2 = plot_cell_trajectory(sc_cds, color_by = &#39;Pseudotime&#39;) p3 = plot_cell_trajectory(sc_cds, color_by = &#39;celltype&#39;) + scale_color_npg() library(patchwork) p2+p1/p3 è¿™ä¸‰ç§ç€è‰²æ–¹å¼æ”¾åœ¨ä¸€èµ·éå¸¸çš„å¸¦åŠ²ï¼Œå¾ˆæ¸…æ™°çš„å±•ç¤ºäº†pseudotimeã€stateå’Œcelltypeæ˜¯æ€æ ·å˜åŒ–çš„ã€‚ ç»å…¸çš„æ‹Ÿæ—¶åºçƒ­å›¾ å±•ç¤ºäº†ä¸€äº›åŸºå› æ˜¯å¦‚ä½•éšç€æ—¶é—´è½¨è¿¹çš„å˜åŒ–è€Œæ¸å˜çš„ï¼Œè¿™ä¸ªæ¸å˜ä¸åŒäºfindmarkersï¼Œæ˜¯ä½“ç°å˜åŒ–è¿‡ç¨‹çš„ï¼Œè€Œä¸æ˜¯ç›´æ¥ç»™å‡ºå·®å¼‚è¡¨è¾¾çš„åŸºå› ã€‚ gene_to_cluster = diff_test_res %&gt;% arrange(qval) %&gt;% head(50) %&gt;% pull(gene_short_name);head(gene_to_cluster) ## [1] &quot;S100A9&quot; &quot;S100A8&quot; &quot;FCGR3A&quot; &quot;VMO1&quot; &quot;TIMP1&quot; &quot;MS4A7&quot; plot_pseudotime_heatmap(sc_cds[gene_to_cluster,], num_clusters = nlevels(Idents(scRNA)), show_rownames = TRUE, cores = 4,return_heatmap = TRUE, hmcols = colorRampPalette(c(&quot;navy&quot;, &quot;white&quot;, &quot;firebrick3&quot;))(100)) ç”¨æ„Ÿå…´è¶£çš„åŸºå› ç»™è½¨è¿¹å›¾ç€è‰²ï¼Œgså¯ä»¥æ¢æˆä½ æƒ³æ¢çš„åŸºå›  gs = head(gene_to_cluster) plot_cell_trajectory(sc_cds,markers=gs, use_color_gradient=T) ä¹Ÿå¯ä»¥æ˜¯jitter plot_genes_jitter(sc_cds[gs,], grouping = &quot;celltype&quot;, color_by = &quot;celltype&quot;, nrow= 3, ncol = NULL ) "],["å¤šæ ·æœ¬æ‹Ÿæ—¶åºåˆ†æ.html", "ç¬¬ 6 ç«  å¤šæ ·æœ¬æ‹Ÿæ—¶åºåˆ†æ 6.1 æ„å»ºç»†èƒå‘è‚²è½¨è¿¹ 6.2 ç»˜å›¾å±•ç¤º", " ç¬¬ 6 ç«  å¤šæ ·æœ¬æ‹Ÿæ—¶åºåˆ†æ ** èƒŒæ™¯çŸ¥è¯†** åšæ‹Ÿæ—¶åºåˆ†ææ˜¯ä¸ºäº†æ¢ç´¢è‡ªå·±æ„Ÿå…´è¶£çš„å‡ ç§ç»†èƒä¹‹é—´çš„å‘è‚²å…³ç³»ï¼Œä¸€èˆ¬ä¸æ˜¯ç”¨å…¨éƒ¨ç±»å‹çš„ç»†èƒæ¥åšçš„ã€‚ä¾‹å¦‚æœ¬ä¾‹ä¸­é€‰æ‹©äº†CD14å’ŒCD16å•æ ¸ç»†èƒã€‚ å¦‚æœè®©aiæ¥è¯´æ‹Ÿæ—¶åºçš„ç›®çš„é‚£å°±æ¯”æˆ‘è¯´çš„å¤š: &gt; æ‹Ÿæ—¶åºåˆ†æï¼ˆPseudo-time analysisï¼‰æ˜¯ä¸€ç§ç”¨äºç†è§£ç»†èƒçŠ¶æ€å’Œç»†èƒå‘½è¿å˜åŒ–çš„è®¡ç®—ç”Ÿç‰©å­¦æ–¹æ³•ã€‚è¿™ç§åˆ†æé€šå¸¸ç”¨äºå•ç»†èƒæµ‹åºæ•°æ®ï¼Œå…¶ç›®çš„æ˜¯é‡å»ºç»†èƒå‘è‚²æˆ–ç–¾ç—…è¿›ç¨‹ä¸­çš„æ—¶é—´åºåˆ—ï¼Œå³ä½¿å®é™…çš„æ—¶é—´ä¿¡æ¯ä¸å¯ç”¨ã€‚ä»¥ä¸‹æ˜¯è¿›è¡Œæ‹Ÿæ—¶åºåˆ†æçš„å‡ ä¸ªä¸»è¦ç›®çš„ï¼š 1. ç»†èƒçŠ¶æ€æ¨æ–­ï¼šé€šè¿‡åˆ†æå•ä¸ªç»†èƒçš„åŸºå› è¡¨è¾¾æ¨¡å¼ï¼Œæ¨æ–­ç»†èƒåœ¨ç”Ÿç‰©å­¦è¿‡ç¨‹ä¸­æ‰€å¤„çš„çŠ¶æ€ã€‚ 2. ç»†èƒè½¨è¿¹è¿½è¸ªï¼šé‡å»ºç»†èƒä»ä¸€ç§çŠ¶æ€è½¬å˜åˆ°å¦ä¸€ç§çŠ¶æ€çš„è·¯å¾„ï¼Œè¿™æœ‰åŠ©äºç†è§£ç»†èƒåˆ†åŒ–ã€å‘è‚²æˆ–ç–¾ç—…è¿›å±•çš„è¿‡ç¨‹ã€‚ 3. ç»†èƒå‘½è¿é¢„æµ‹ï¼šé¢„æµ‹ç»†èƒéšæ—¶é—´å¯èƒ½é‡‡å–çš„å‘è‚²è½¨è¿¹ï¼Œå°¤å…¶æ˜¯åœ¨å¹²ç»†èƒåˆ†åŒ–æˆ–ç™Œç—‡å‘å±•çš„ç ”ç©¶ä¸­ã€‚ 4. åŠ¨æ€è¿‡ç¨‹å»ºæ¨¡ï¼šåˆ›å»ºç»†èƒçŠ¶æ€å˜åŒ–çš„åŠ¨æ€æ¨¡å‹ï¼Œè¿™æœ‰åŠ©äºæ­ç¤ºç»†èƒè¡Œä¸ºçš„å†…åœ¨è§„å¾‹å’Œè°ƒæ§æœºåˆ¶ã€‚ 5. ç»†èƒäºšç¾¤è¯†åˆ«ï¼šåœ¨å¤æ‚çš„ç»†èƒç¾¤ä½“ä¸­è¯†åˆ«ä¸åŒçš„ç»†èƒäºšç¾¤ï¼Œå¹¶ç†è§£å®ƒä»¬åœ¨ç”Ÿç‰©å­¦è¿‡ç¨‹ä¸­çš„ä½œç”¨ã€‚ 6. åŸºå› è°ƒæ§ç½‘ç»œæ¨æ–­ï¼šé€šè¿‡åˆ†æåŸºå› è¡¨è¾¾éšâ€œæ‹Ÿæ—¶é—´â€çš„å˜åŒ–ï¼Œæ¨æ–­åŸºå› è°ƒæ§ç½‘ç»œå’Œä¿¡å·ä¼ å¯¼é€”å¾„ã€‚ 7. ç–¾ç—…æœºç†æ¢ç´¢ï¼šåœ¨ç–¾ç—…ç ”ç©¶ä¸­ï¼Œæ‹Ÿæ—¶åºåˆ†ææœ‰åŠ©äºæ­ç¤ºç–¾ç—…å‘ç”Ÿå’Œå‘å±•çš„åˆ†å­æœºåˆ¶ã€‚ 8. è¯ç‰©ä½œç”¨æœºåˆ¶ç ”ç©¶ï¼šé€šè¿‡è§‚å¯Ÿè¯ç‰©å¤„ç†å‰åç»†èƒçŠ¶æ€çš„å˜åŒ–ï¼Œç ”ç©¶è¯ç‰©çš„ä½œç”¨æœºåˆ¶å’Œæ•ˆæœã€‚ æ‹Ÿæ—¶åºåˆ†ææ˜¯ä¸€ç§å¼ºå¤§çš„å·¥å…·ï¼Œå®ƒå¯ä»¥å¸®åŠ©ç ”ç©¶è€…åœ¨æ²¡æœ‰ç›´æ¥æ—¶é—´æ ‡è®°çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡åŸºå› è¡¨è¾¾æ•°æ®æ¥æ¢ç´¢ç»†èƒçŠ¶æ€çš„å˜åŒ–å’ŒåŠ¨æ€è¿‡ç¨‹ã€‚è¿™ç§æ–¹æ³•åœ¨å•ç»†èƒç”Ÿç‰©å­¦ã€å‘è‚²ç”Ÿç‰©å­¦ã€ç™Œç—‡ç”Ÿç‰©å­¦å’Œç¥ç»ç§‘å­¦ç­‰é¢†åŸŸæœ‰ç€å¹¿æ³›çš„åº”ç”¨ã€‚ ä»Šå¤©çš„ä»£ç æ˜¯å¤„ç†å¤šæ ·æœ¬æ•°æ®çš„ï¼Œå•æ ·æœ¬çš„åœ¨å‰ä¸€ç¯‡ã€‚ ä½¿ç”¨çš„æ•°æ®sce.all.Rdataæ˜¯Seuraté™ç»´èšç±»åˆ†ç¾¤æ³¨é‡Šçš„ç»“æœï¼Œæœ‰ä¸¤ä¸ªæ ·æœ¬ã€‚ rm(list = ls()) library(Seurat) library(monocle) library(dplyr) load(&quot;sce.all.Rdata&quot;) DimPlot(sce.all,label = T)+NoLegend() table(sce.all$celltype) ## ## B B Activated CD14 Mono CD16 Mono CD4 Memory T CD4 Naive T ## 100 100 100 100 100 100 ## CD8 T DC Mk NK pDC T activated ## 100 100 100 100 100 100 æœ¬æ–‡çš„è¾“å…¥æ•°æ®æ˜¯seuratåšå®Œé™ç»´èšç±»åˆ†ç¾¤æ³¨é‡Šçš„æ•°æ®ï¼Œä¸ºäº†èŠ‚çœè®¡ç®—èµ„æºï¼Œæˆ‘å·²ç»æŠ½æ ·å‡å°‘ç»†èƒæ•°é‡äº†ã€‚å¹¶å°†æ³¨é‡Šçš„ç»“æœæ·»åŠ åˆ°äº†metaè¡¨æ ¼é‡Œé¢æˆä¸ºäº†celltypeåˆ—ã€‚ æˆ‘è¿™é‡Œåªæ˜¯ä¸¾ä¾‹ï¼Œæ²¡æœ‰è€ƒè™‘èƒŒæ™¯çŸ¥è¯†ï¼Œæå–ä¸¤ç§ç»†èƒï¼š scRNA = subset(sce.all,idents = c(&quot;CD14 Mono&quot;,&quot;CD16 Mono&quot;)) table(scRNA$celltype) ## ## CD14 Mono CD16 Mono ## 100 100 table(scRNA$orig.ident) ## ## IMMUNE_CTRL IMMUNE_STIM ## 105 95 å› ä¸ºmonocleå’Œseuratæ˜¯ä¸¤ä¸ªä¸åŒçš„ä½“ç³»ï¼Œæ‰€ä»¥éœ€è¦å°†seuratå¯¹è±¡è½¬æ¢ä¸ºmonocleå¯ä»¥æ¥å—çš„CellDataSetå¯¹è±¡ã€‚è™½ç„¶monocle3å·²ç»å‡ºæ¥å¾ˆä¹…äº†ï¼Œä½†å¤§å®¶éƒ½ä¸çº¦è€ŒåŒçš„é€‰æ‹©monocle2ï¼Œå¤§æ¦‚å°±æ˜¯ä¹ æƒ¯äº†å§ã€‚ã€‚ ct &lt;- scRNA@assays$RNA$counts gene_ann &lt;- data.frame( gene_short_name = row.names(ct), row.names = row.names(ct) ) pd &lt;- new(&quot;AnnotatedDataFrame&quot;, data=scRNA@meta.data) fd &lt;- new(&quot;AnnotatedDataFrame&quot;, data=gene_ann) sc_cds &lt;- newCellDataSet( ct, phenoData = pd, featureData =fd, expressionFamily = negbinomial.size(), lowerDetectionLimit=1) sc_cds ## CellDataSet (storageMode: environment) ## assayData: 14053 features, 200 samples ## element names: exprs ## protocolData: none ## phenoData ## sampleNames: AAACGGCTTACTCT.1 AAATACTGGTTCTT.1 ... TTGGAGTGCTCGAA.11 ## (200 total) ## varLabels: orig.ident nCount_RNA ... Size_Factor (19 total) ## varMetadata: labelDescription ## featureData ## featureNames: AL627309.1 RP11-206L10.2 ... LRRC3DN (14053 total) ## fvarLabels: gene_short_name ## fvarMetadata: labelDescription ## experimentData: use &#39;experimentData(object)&#39; ## Annotation: 6.1 æ„å»ºç»†èƒå‘è‚²è½¨è¿¹ é€‰æ‹©åŸºå› æœ‰ä¸åŒçš„ç­–ç•¥ï¼Œæ¯”å¦‚ 1.ä½¿ç”¨seuratç»™å‡ºçš„é«˜å˜åŒ–åŸºå›  2.æŒ‰ç…§å¹³å‡è¡¨è¾¾é‡å¤§äºæŸä¸ªæ•°å­—(æ¯”å¦‚0.1ï¼Œå®˜ç½‘ç”¨çš„æ˜¯è¿™ä¸ª)çš„åŸºå›  3.ä½¿ç”¨ä¸åŒç»†èƒç±»å‹ä¹‹é—´çš„å·®å¼‚åŸºå› ï¼ŒdifferentialGeneTestè®¡ç®—ã€‚ æˆ‘ä»¬é»˜è®¤ä½¿ç”¨çš„æ˜¯æœ€åä¸€ä¸ªç­–ç•¥ã€‚ sc_cds &lt;- estimateSizeFactors(sc_cds) sc_cds &lt;- estimateDispersions(sc_cds) table(scRNA@meta.data$celltype) ## ## CD14 Mono CD16 Mono ## 100 100 fdif = &quot;diff_test_res.Rdata&quot; if(!file.exists(fdif)){ diff_test_res &lt;- differentialGeneTest(sc_cds, fullModelFormulaStr = &quot; ~ celltype + orig.ident&quot;, reducedModelFormulaStr = &quot; ~ orig.ident&quot;, cores = 4) save(diff_test_res,file = fdif) } load(fdif) ordering_genes &lt;- row.names (subset(diff_test_res, qval &lt; 0.01)) #ç„¶åæ˜¯æŸ¥çœ‹åŸºå› ï¼Œè®¾ç½®ä¸ºæ’åºè¦ä½¿ç”¨çš„åŸºå›  head(ordering_genes) ## [1] &quot;C1QA&quot; &quot;C1QB&quot; &quot;SH3BGRL3&quot; &quot;MARCKSL1&quot; &quot;YBX1&quot; &quot;TMEM59&quot; sc_cds &lt;- setOrderingFilter(sc_cds, ordering_genes) plot_ordering_genes(sc_cds) #é™ç»´ sc_cds &lt;- reduceDimension(sc_cds,residualModelFormulaStr = &quot;~orig.ident&quot;) #ç»†èƒæ’åº sc_cds &lt;- orderCells(sc_cds) 6.2 ç»˜å›¾å±•ç¤º å‘è‚²è½¨è¿¹å›¾ library(ggsci) p1 = plot_cell_trajectory(sc_cds)+ scale_color_nejm() p2 = plot_cell_trajectory(sc_cds, color_by = &#39;Pseudotime&#39;) p3 = plot_cell_trajectory(sc_cds, color_by = &#39;celltype&#39;) + scale_color_npg() library(patchwork) p2+p1/p3 è¿™ä¸‰ç§ç€è‰²æ–¹å¼æ”¾åœ¨ä¸€èµ·éå¸¸çš„å¸¦åŠ²ï¼Œå¾ˆæ¸…æ™°çš„å±•ç¤ºäº†pseudotimeã€stateå’Œcelltypeæ˜¯æ€æ ·å˜åŒ–çš„ã€‚ ä»¥orig.identç€è‰²å¯ä»¥çœ‹å‡ºï¼Œä¸åŒæ ·æœ¬ä¸­çš„ç»†èƒåŸºæœ¬æ˜¯å‡åŒ€åˆ†å¸ƒåœ¨è½¨è¿¹ä¸Šçš„ï¼Œè¯´æ˜å‰é¢çš„ä»£ç å¾ˆå¥½çš„å»é™¤äº†æ ·æœ¬é—´çš„æ‰¹æ¬¡æ•ˆåº” plot_cell_trajectory(sc_cds, color_by = &#39;orig.ident&#39;) ç»å…¸çš„æ‹Ÿæ—¶åºçƒ­å›¾ å±•ç¤ºäº†ä¸€äº›åŸºå› æ˜¯å¦‚ä½•éšç€æ—¶é—´è½¨è¿¹çš„å˜åŒ–è€Œæ¸å˜çš„ï¼Œè¿™ä¸ªæ¸å˜ä¸åŒäºfindmarkersï¼Œæ˜¯ä½“ç°å˜åŒ–è¿‡ç¨‹çš„ï¼Œè€Œä¸æ˜¯ç›´æ¥ç»™å‡ºå·®å¼‚è¡¨è¾¾çš„åŸºå› ã€‚ gene_to_cluster = diff_test_res %&gt;% arrange(qval) %&gt;% head(50) %&gt;% pull(gene_short_name);head(gene_to_cluster) ## [1] &quot;VMO1&quot; &quot;CCL2&quot; &quot;CCL7&quot; &quot;S100A8&quot; &quot;FCGR3A&quot; &quot;S100A9&quot; plot_pseudotime_heatmap(sc_cds[gene_to_cluster,], num_clusters = nlevels(Idents(scRNA)), show_rownames = TRUE, cores = 4,return_heatmap = TRUE, hmcols = colorRampPalette(c(&quot;navy&quot;, &quot;white&quot;, &quot;firebrick3&quot;))(100)) ç”¨æ„Ÿå…´è¶£çš„åŸºå› ç»™è½¨è¿¹å›¾ç€è‰²ï¼Œgså¯ä»¥æ¢æˆä½ æƒ³æ¢çš„åŸºå›  gs = head(gene_to_cluster) plot_cell_trajectory(sc_cds,markers=gs, use_color_gradient=T) ä¹Ÿå¯ä»¥æ˜¯jitter plot_genes_jitter(sc_cds[gs,], grouping = &quot;celltype&quot;, color_by = &quot;celltype&quot;, nrow= 3, ncol = NULL ) "],["ç»†èƒé€šè®¯åˆ†æ.html", "ç¬¬ 7 ç«  ç»†èƒé€šè®¯åˆ†æ 7.1 RåŒ…å’Œæ•°æ® 7.2 äº†è§£å‚è€ƒæ•°æ® 7.3 æ„å»ºcellchatå¯¹è±¡ 7.4 ç»†èƒé€šè®¯ç½‘ç»œåˆ†æ 7.5 ç”»å›¾å±•ç¤º 7.6 ç»†èƒé€šè®¯æ¨¡å¼å’Œä¿¡å·ç½‘ç»œ", " ç¬¬ 7 ç«  ç»†èƒé€šè®¯åˆ†æ èƒŒæ™¯çŸ¥è¯† ç»†èƒé€šè®¯æ˜¯å•ç»†èƒæ•°æ®é«˜çº§åˆ†æä¸­æ¯”è¾ƒå¸¸è§çš„ä¸€ä¸ªï¼Œæˆ‘ä»¬ä¹ æƒ¯ä½¿ç”¨çš„RåŒ…æ˜¯CellChatã€‚ è¿™ä¸ªæ˜¯CellChatçš„ä¸€æ‰‹æ•™ç¨‹ï¼š https://htmlpreview.github.io/?https://github.com/jinworks/CellChat/blob/master/tutorial/CellChat-vignette.html è®©AIæ¥å‘Šè¯‰æˆ‘ä»¬åšç»†èƒé€šè®¯åˆ†æçš„ç”¨é€”ï¼š ç»†èƒé€šè®¯åˆ†ææ˜¯ç”Ÿç‰©å­¦ç ”ç©¶ä¸­çš„ä¸€ä¸ªé‡è¦é¢†åŸŸï¼Œå®ƒæ¶‰åŠç ”ç©¶ç»†èƒä¹‹é—´å¦‚ä½•é€šè¿‡ä¿¡å·ä¼ é€’æ¥åè°ƒå®ƒä»¬çš„åŠŸèƒ½å’Œè¡Œä¸ºã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ç»†èƒé€šè®¯åˆ†æçš„ä¸»è¦ç”¨é€”ï¼š ç–¾ç—…è¯Šæ–­å’Œæ²»ç–—ï¼šäº†è§£ç»†èƒå¦‚ä½•äº¤æµå¯ä»¥å¸®åŠ©è¯Šæ–­å’Œæ²»ç–—ç–¾ç—…ï¼Œç‰¹åˆ«æ˜¯é‚£äº›ä¸ç»†èƒé€šè®¯å¤±è°ƒæœ‰å…³çš„ç–¾ç—…ï¼Œå¦‚ç™Œç—‡ã€è‡ªèº«å…ç–«ç–¾ç—…å’Œç¥ç»é€€è¡Œæ€§ç–¾ç—…ã€‚ è¯ç‰©å¼€å‘ï¼šé€šè¿‡ç ”ç©¶ç»†èƒé—´é€šè®¯çš„æœºåˆ¶ï¼Œå¯ä»¥å‘ç°æ–°çš„è¯ç‰©é¶ç‚¹ï¼Œä»è€Œå¼€å‘å‡ºæ›´æœ‰æ•ˆçš„æ²»ç–—è¯ç‰©ã€‚ å‘è‚²ç”Ÿç‰©å­¦ï¼šç»†èƒé€šè®¯åœ¨èƒšèƒå‘è‚²å’Œç»„ç»‡å½¢æˆä¸­èµ·ç€å…³é”®ä½œç”¨ã€‚ç ”ç©¶è¿™äº›è¿‡ç¨‹æœ‰åŠ©äºæˆ‘ä»¬ç†è§£æ­£å¸¸å’Œå¼‚å¸¸å‘è‚²çš„æœºåˆ¶ã€‚ ç»„ç»‡å·¥ç¨‹ï¼šåœ¨ç»„ç»‡å·¥ç¨‹ä¸­ï¼Œç»†èƒé€šè®¯å¯¹äºç»†èƒçš„å¢æ®–ã€åˆ†åŒ–å’Œç»„ç»‡ç»“æ„çš„å½¢æˆè‡³å…³é‡è¦ã€‚ ç»†èƒä¿¡å·ä¼ å¯¼ç ”ç©¶ï¼šç»†èƒé€šè®¯åˆ†ææœ‰åŠ©äºæ­ç¤ºç»†èƒå†…ä¿¡å·ä¼ å¯¼çš„å¤æ‚ç½‘ç»œï¼Œè¿™å¯¹äºç†è§£ç»†èƒå¦‚ä½•å“åº”å¤–ç•Œåˆºæ¿€éå¸¸é‡è¦ã€‚ ç”Ÿç‰©é˜²å¾¡æœºåˆ¶ï¼šç ”ç©¶ç»†èƒå¦‚ä½•é€šè¿‡é€šè®¯æ¥åè°ƒå…ç–«ååº”ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç†è§£ç”Ÿç‰©ä½“å¦‚ä½•æŠµå¾¡ç—…åŸä½“ã€‚ ç¥ç»ç§‘å­¦ï¼šåœ¨ç¥ç»ç§‘å­¦é¢†åŸŸï¼Œç»†èƒé€šè®¯åˆ†ææœ‰åŠ©äºæˆ‘ä»¬ç†è§£å¤§è„‘å¦‚ä½•é€šè¿‡ç¥ç»ç»†èƒé—´çš„ä¿¡å·ä¼ é€’æ¥å¤„ç†ä¿¡æ¯ã€‚ ç”Ÿç‰©ä¿¡æ¯å­¦å’Œç³»ç»Ÿç”Ÿç‰©å­¦ï¼šé€šè¿‡åˆ†æç»†èƒé€šè®¯ç½‘ç»œï¼Œå¯ä»¥æ„å»ºç”Ÿç‰©ç³»ç»Ÿçš„æ•°å­¦æ¨¡å‹ï¼Œå¸®åŠ©æˆ‘ä»¬ä»ç³»ç»Ÿå±‚é¢ç†è§£ç”Ÿç‰©è¿‡ç¨‹ã€‚ ç¯å¢ƒç”Ÿç‰©å­¦ï¼šç ”ç©¶ç»†èƒå¦‚ä½•å“åº”ç¯å¢ƒå˜åŒ–ï¼Œä¾‹å¦‚æ¸©åº¦ã€å…‰ç…§å’ŒåŒ–å­¦ç‰©è´¨ï¼Œå¯ä»¥æ­ç¤ºç”Ÿç‰©å¦‚ä½•é€‚åº”ç¯å¢ƒã€‚ å†œä¸šå’Œæ¤ç‰©ç§‘å­¦ï¼šåœ¨æ¤ç‰©ç§‘å­¦ä¸­ï¼Œäº†è§£æ¤ç‰©ç»†èƒå¦‚ä½•é€šè¿‡é€šè®¯æ¥åè°ƒç”Ÿé•¿ã€å‘è‚²å’Œå¯¹ç¯å¢ƒçš„å“åº”ï¼Œå¯¹äºæé«˜ä½œç‰©äº§é‡å’ŒæŠ—é€†æ€§è‡³å…³é‡è¦ã€‚ ç»†èƒé€šè®¯åˆ†ææ˜¯ä¸€ä¸ªå¤šå­¦ç§‘äº¤å‰çš„é¢†åŸŸï¼Œå®ƒç»“åˆäº†åˆ†å­ç”Ÿç‰©å­¦ã€ç»†èƒç”Ÿç‰©å­¦ã€ç”Ÿç‰©åŒ–å­¦ã€ç”Ÿç‰©ä¿¡æ¯å­¦å’Œå…¶ä»–å­¦ç§‘çš„çŸ¥è¯†å’ŒæŠ€æœ¯ã€‚é€šè¿‡è¿™ç§åˆ†æï¼Œç§‘å­¦å®¶å¯ä»¥æ›´æ·±å…¥åœ°ç†è§£ç”Ÿå‘½è¿‡ç¨‹ï¼Œå¹¶å¼€å‘å‡ºæ–°çš„ç”Ÿç‰©æŠ€æœ¯å’Œæ²»ç–—æ–¹æ³•ã€‚ 7.1 RåŒ…å’Œæ•°æ® ä½¿ç”¨çš„æ•°æ®sce.all.Rdataæ˜¯Seuraté™ç»´èšç±»åˆ†ç¾¤æ³¨é‡Šçš„ç»“æœï¼Œæœ‰ä¸¤ä¸ªæ ·æœ¬ã€‚å’Œå¤šæ ·æœ¬æ‹Ÿæ—¶åºç”¨çš„æ˜¯åŒä¸€ä¸ªæ•°æ®ã€‚ rm(list = ls()) if(!require(NMF))install.packages(&quot;NMF&quot;,update = F,ask = F) if(!require(presto))devtools::install_local(&#39;presto-master.zip&#39;,upgrade = F,dependencies = T) if(!require(CellChat))devtools::install_local(&quot;CellChat-main/&quot;,upgrade = F,dependencies = T) if(!require(ggalluvial))install.packages(&quot;ggalluvial&quot;,update = F,ask = F) library(CellChat) library(ggplot2) library(Seurat) library(ggalluvial) load(&quot;../5.monocle_mulitisample/sce.all.Rdata&quot;) table(Idents(sce.all)) ## ## CD14 Mono pDC CD4 Memory T T activated CD4 Naive T CD8 T ## 100 100 100 100 100 100 ## Mk B Activated B DC CD16 Mono NK ## 100 100 100 100 100 100 scRNA = sce.all å› ä¸ºç»†èƒé€šè®¯æ›´æ›´æ›´è´¹è®¡ç®—èµ„æºï¼Œæˆ‘ä»¬è¿˜æ˜¯æŠ½æ ·ï¼Œå®æˆ˜ä¸­ä¸èƒ½æŠ½æ ·çš„ã€‚ set.seed(112) scRNA = subset(scRNA,downsample = 100) table(Idents(scRNA)) ## ## CD14 Mono pDC CD4 Memory T T activated CD4 Naive T CD8 T ## 100 100 100 100 100 100 ## Mk B Activated B DC CD16 Mono NK ## 100 100 100 100 100 100 7.2 äº†è§£å‚è€ƒæ•°æ® CellChatDB.human,CellChatDB.mouseåˆ†åˆ«æ˜¯äººå’Œå°é¼ çš„é…å—ä½“æ•°æ®åº“ str(CellChatDB.human,max.level = 1) ## List of 4 ## $ interaction:&#39;data.frame&#39;: 1939 obs. of 11 variables: ## $ complex :&#39;data.frame&#39;: 157 obs. of 4 variables: ## $ cofactor :&#39;data.frame&#39;: 31 obs. of 16 variables: ## $ geneInfo :&#39;data.frame&#39;: 41787 obs. of 6 variables: table(CellChatDB.human$interaction$annotation) ## ## Cell-Cell Contact ECM-Receptor Secreted Signaling ## 319 421 1199 PPI.humanå’ŒPPI.mouseæ˜¯ç¨€ç–çŸ©é˜µï¼Œæ˜¯STRINGæ•°æ®åº“é‡Œé«˜ç­‰çº§è¯æ®çš„ç›¸äº’ä½œç”¨å…³ç³»ç»„æˆçš„0-1çŸ©é˜µã€‚ class(PPI.human) ## [1] &quot;dgCMatrix&quot; ## attr(,&quot;package&quot;) ## [1] &quot;Matrix&quot; dim(PPI.human) ## [1] 4815 4815 table(as.numeric(PPI.human)) ## ## 0 1 ## 23156523 27702 7.3 æ„å»ºcellchatå¯¹è±¡ seuratå¯¹è±¡å¯ä»¥ç›´æ¥è½¬æ¢ã€‚åœ¨@DBåŠ ä¸Šè¦ä½¿ç”¨çš„é…ä½“å—ä½“æ•°æ®åº“ï¼Œæ³¨æ„ç‰©ç§ cellchat &lt;- createCellChat(sce.all, group.by = &quot;ident&quot;, assay = &quot;RNA&quot;) ## [1] &quot;Create a CellChat object from a Seurat object&quot; ## The `meta.data` slot in the Seurat object is used as cell meta information ## Set cell identities for the new CellChat object ## The cell groups used for CellChat analysis are CD14 Mono pDC CD4 Memory T T activated CD4 Naive T CD8 T Mk B Activated B DC CD16 Mono NK cellchat@DB &lt;- subsetDB(CellChatDB.human, search = &quot;Secreted Signaling&quot;) #searchå¯ä»¥é€‰æ‹©çš„å€¼æ˜¯ï¼š table(CellChatDB.human$interaction$annotation) # æå–æ•°æ®åº“æ”¯æŒçš„åŸºå› çš„è¡¨è¾¾çŸ©é˜µå­é›† cellchat &lt;- subsetData(cellchat) dim(cellchat@data.signaling) ## [1] 337 1200 7.4 ç»†èƒé€šè®¯ç½‘ç»œåˆ†æ # è¯†åˆ«è¿‡è¡¨è¾¾åŸºå›  cellchat &lt;- identifyOverExpressedGenes(cellchat) # è¯†åˆ«é…ä½“-å—ä½“å¯¹ cellchat &lt;- identifyOverExpressedInteractions(cellchat) # å°†é…ä½“ã€å—ä½“æŠ•å°„åˆ°PPIç½‘ç»œ cellchat &lt;- projectData(cellchat, PPI.human)#æ…¢ ## æ¨æµ‹ç»†èƒé€šè®¯ç½‘ç»œ cellchat &lt;- computeCommunProb(cellchat) #æ…¢ ## triMean is used for calculating the average gene expression per cell group. ## [1] &quot;&gt;&gt;&gt; Run CellChat on sc/snRNA-seq data &lt;&lt;&lt; [2025-04-07 20:21:48.305586]&quot; ## [1] &quot;&gt;&gt;&gt; CellChat inference is done. Parameter values are stored in `object@options$parameter` &lt;&lt;&lt; [2025-04-07 20:22:10.138138]&quot; cellchat &lt;- computeCommunProbPathway(cellchat) cellchat &lt;- aggregateNet(cellchat) 7.5 ç”»å›¾å±•ç¤º åˆ†æå‡ºæ¥çš„é‡è¦ä¿¡å·é€šè·¯å¦‚ä¸‹ cellchat@netP$pathways ## [1] &quot;GALECTIN&quot; &quot;CCL&quot; &quot;ANNEXIN&quot; &quot;CXCL&quot; &quot;IL1&quot; æ¯ä¸ªé€šè·¯éƒ½å¯ä»¥ç”»å¤šç§å›¾å‡ºæ¥ï¼Œå›¾ä¸­çº¿çš„é¢œè‰²ä¸å‘å°„ä¿¡å·çš„ç»†èƒä¸€è‡´ï¼Œçº¿çš„ç²—ç»†ä»£è¡¨çš„æ˜¯ä¿¡å·å¼ºå¼±ï¼Œçº¿è¶Šç²—ä¿¡å·è¶Šå¼ºã€‚ç‚¹çš„å¤§å°ä¸€èˆ¬æ˜¯æŒ‰ç…§æ¯ç§ç»†èƒçš„æ•°é‡æ¥åˆ†é…ã€‚ pathways.showæ˜¯è¦ç”»çš„ä¿¡å·é€šè·¯ï¼Œå¯ä»¥æ¢æˆcellchat@netP$pathwaysæ˜¾ç¤ºçš„å…¶ä»–é€šè·¯ pathways.show &lt;- &quot;GALECTIN&quot; 7.5.0.0.1 hierarchy plot groupSize &lt;- as.numeric(table(cellchat@idents)) vertex.receiver = seq(1,nlevels(scRNA)/2);vertex.receiver ## [1] 1 2 3 4 5 6 netVisual_aggregate(cellchat, signaling = pathways.show, layout = &quot;hierarchy&quot;, vertex.receiver = vertex.receiver, vertex.weight = groupSize) è¿™ä¸ªå›¾åˆ†äº†ä¸¤å¼ å­å›¾ï¼Œå…¶å®æ˜¯åˆ†ä¸¤æ¬¡è¯´æ˜äº†æ‰€æœ‰ç»†èƒç±»å‹ä¹‹é—´çš„äº’ä½œã€‚ä¸¤å¼ å­å›¾çš„å·®åˆ«æ˜¯ä¸­é—´çš„åœ†åœˆï¼Œç¬¬ä¸€å¼ å­å›¾ä¸­ï¼Œç¬¬äºŒåˆ—çš„åœ†åœˆæ„ä¹‰åŒç¬¬ä¸€åˆ—ï¼Œç¬¬äºŒå¼ å­å›¾ä¸­ï¼Œç¬¬äºŒåˆ—çš„åœ†åœˆæ„ä¹‰åŒç¬¬ä¸‰åˆ—ï¼Œä»â€Targetâ€è¿™ä¸ªå•è¯çš„é¢œè‰²å’Œå“ªä¸ªâ€sourceâ€ä¸€è‡´å¯ä»¥çœ‹å‡ºã€‚ äº’ä½œæ–¹å‘ä¹Ÿæœ‰äº†ï¼Œæ˜¯ä»ä¸¤è¾¹çš„sourceåˆ°ä¸­é—´çš„targetã€‚ 7.5.1 circle plot circle plot åªæ˜¯æ¢äº†ä¸€ä¸ªå¸ƒå±€ï¼Œä¸€å¼ å›¾å±•ç¤ºå‡ºæ¥ã€‚ par(mfrow = c(1,1), xpd=TRUE,mar = c(2, 2, 2, 2)) netVisual_aggregate(cellchat, signaling = pathways.show, layout = &quot;circle&quot;, vertex.receiver = vertex.receiver, vertex.weight = groupSize) 7.5.2 chord plot å¼¦å›¾è¿˜æ˜¯å¾ˆæœ‰ç»†èŠ‚çš„ï¼Œå†…åœˆå°çŸ­çº¿ä»£è¡¨å‘å°„å‡ºçš„ä¿¡å·è¢«è°æ¥æ”¶ï¼Œå’Œæ¥å—è€…é¢œè‰²ä¸€è‡´ï¼Œå‘å°„ç«¯æ˜¯å¹³çš„ä¸”æœ‰å°çŸ­çº¿ï¼Œæ¥æ”¶ç«¯æ˜¯å°–çš„ã€‚ netVisual_aggregate(cellchat, signaling = pathways.show, layout = &quot;chord&quot;, vertex.receiver = vertex.receiver, vertex.weight = groupSize) 7.5.3 heatmap çƒ­å›¾ï¼Œçºµåæ ‡æ˜¯å‘å°„ç«¯ï¼Œæ¨ªåæ ‡æ˜¯æ¥æ”¶ç«¯ï¼Œæœ‰é¢œè‰²ä»£è¡¨æ¨ªçºµåæ ‡æ‰€æŒ‡çš„ä¸¤ç±»ç»†èƒä¹‹é—´æœ‰é€šè®¯ï¼Œé¢œè‰²æ·±æµ…ä»£è¡¨é€šè®¯æ¦‚ç‡ã€‚å³ä¾§å’Œä¸Šæ–¹çš„æ¡å½¢å›¾æ˜¯è¯¥è¡Œ/åˆ—é€šè®¯æ¦‚ç‡ä¹‹å’Œ netVisual_heatmap(cellchat, signaling = pathways.show, color.heatmap = &quot;Reds&quot;) è®¡ç®—é…ä½“-å—ä½“å¯¹ä¿¡å·ç½‘ç»œçš„è´¡çŒ®åº¦ netAnalysis_contribution(cellchat, signaling = pathways.show) 7.5.4 çƒ­å›¾-å±•ç¤ºæ¯ä¸€ç±»ç»†èƒæ˜¯ä»€ä¹ˆè§’è‰² åˆ†æç»†èƒåœ¨ä¿¡å·ç½‘ç»œä¸­è§’è‰²ï¼šå‘é€è€…ã€æ¥æ”¶è€…ã€è°ƒè§£è€…å’Œå½±å“è€…ã€‚ cellchat &lt;- netAnalysis_computeCentrality(cellchat, slot.name = &quot;netP&quot;) # the slot &#39;netP&#39; means the inferred intercellular communication network of signaling pathways netAnalysis_signalingRole_network(cellchat, signaling = pathways.show, width = 12, height = 5, font.size = 10) 7.5.5 æ°”æ³¡å›¾-æ˜¾ç¤ºæ‰€æœ‰çš„æ˜¾è‘—çš„é…ä½“-å—ä½“å¯¹ åªæœ‰p&lt;0.05çš„æ‰ä¼šè¢«ç”»å‡ºæ¥ï¼Œé¢œè‰²ä»ç„¶æ˜¯é€šè®¯æ¦‚ç‡ï¼Œåœˆçš„å¤§å°æ˜¯æŒ‰ç…§på€¼ï¼Œpå€¼è¶Šå°åœˆè¶Šå¤§ã€‚ #å¯ä»¥åˆ†å¼€ï¼Œä¹Ÿå¯ä»¥åˆåˆ°ä¸€èµ· netVisual_bubble(cellchat, sources.use = 1, targets.use = 1:nlevels(scRNA), remove.isolate = FALSE) #ä»ç¬¬ä¸€ç±»ç»†èƒåˆ°å…¨éƒ¨ç»†èƒ netVisual_bubble(cellchat, sources.use = 1:nlevels(scRNA), targets.use = 1:nlevels(scRNA), remove.isolate = FALSE)#ä»å…¨éƒ¨ç»†èƒåˆ°å…¨éƒ¨ç»†èƒ 7.6 ç»†èƒé€šè®¯æ¨¡å¼å’Œä¿¡å·ç½‘ç»œ ä¼ å‡ºæ¨¡å¼ï¼Œæ­ç¤ºäº†å‘å°„ç«¯ç»†èƒå¦‚ä½•ç›¸äº’åè°ƒï¼Œä»¥åŠå®ƒä»¬å¦‚ä½•ä¸æŸäº›ä¿¡å·é€šè·¯åè°ƒä»¥é©±åŠ¨é€šä¿¡ã€‚ ä¼ å…¥æ¨¡å¼ï¼Œæ˜¾ç¤ºæ¥æ”¶ç«¯ç»†èƒå¦‚ä½•ç›¸äº’åè°ƒï¼Œä»¥åŠå®ƒä»¬å¦‚ä½•ä¸æŸäº›ä¿¡å·é€šè·¯åè°ƒä»¥å“åº”è¾“å…¥ä¿¡å·ã€‚ 7.6.1 é€‰æ‹©åˆé€‚çš„parttenï¼ˆç»†èƒé€šè®¯æ¨¡å¼ï¼‰çš„æ•°é‡ library(NMF) selectK(cellchat, pattern = &quot;outgoing&quot;) selectK(cellchat, pattern = &quot;incoming&quot;) åœ¨å¸®åŠ©æ–‡æ¡£é‡Œé¢æœ‰è§£é‡Šï¼šFor a range of the number of patterns, a suitable number of patterns is the one at which Cophenetic and Silhouette values begin to drop suddenlyã€‚ è¿™ä¸¤ä¸ªæŒ‡æ ‡éƒ½æ˜¯è¯„ä¼°èšç±»ç¨³å®šæ€§çš„ï¼ŒäºŒè€…éƒ½çªç„¶ä¸‹é™çš„å€¼å¯¹åº”çš„æ¨ªåæ ‡å°±æ˜¯åˆé€‚çš„èšç±»æ•° è¿™é‡Œæ˜¯ç”¨parttern-ç»†èƒï¼Œparttern-é€šè·¯çŸ©é˜µç”»çš„çƒ­å›¾ã€‚identifyCommunicationPatternså‡½æ•°è¯†åˆ«é€šè®¯æ¨¡å¼ï¼Œå¹¶ç”»å‡ºçƒ­å›¾ #ä¼ å‡º cellchat &lt;- identifyCommunicationPatterns(cellchat, pattern = &quot;outgoing&quot;, k = 3)# kæ˜¯partternçš„æ•°é‡ï¼Œæ ¹æ®ä¸Šå›¾é€‰æ‹©çš„ï¼Œå«Œéº»çƒ¦ä¹Ÿå¯ä»¥ç”¨é»˜è®¤å€¼5 #ä¼ å…¥ cellchat &lt;- identifyCommunicationPatterns(cellchat, pattern = &quot;incoming&quot;, k = 3)# kæ˜¯partternçš„æ•°é‡ï¼Œæ ¹æ®ä¸Šå›¾é€‰æ‹©çš„ï¼Œå«Œéº»çƒ¦ä¹Ÿå¯ä»¥ç”¨é»˜è®¤å€¼5 ç”¨æ¡‘åŸºå›¾å’Œæ°”æ³¡å›¾å±•ç¤ºæ¯ç§ç»†èƒä¼ å…¥/ä¼ å‡ºçš„ä¿¡å·éƒ½æ˜¯å±äºå“ªäº›é€šè·¯çš„ # æ¡‘åŸºå›¾ netAnalysis_river(cellchat, pattern = &quot;outgoing&quot;) netAnalysis_river(cellchat, pattern = &quot;incoming&quot;) # æ°”æ³¡å›¾ netAnalysis_dot(cellchat, pattern = &quot;outgoing&quot;,dot.size = 4) netAnalysis_dot(cellchat, pattern = &quot;incoming&quot;,dot.size = 4) æ°”æ³¡å›¾çš„é¢œè‰²æ˜¯æŒ‰ç…§ç»†èƒç±»å‹æ¥åˆ†é…ï¼Œå¤§å°æŒ‰ç…§æ¯ä¸ªé€šè·¯å¯¹æ¯ä¸ªç»†èƒç±»å‹çš„è´¡çŒ®ç¨‹åº¦åˆ†é…ã€‚ "],["gsva-åˆ†æ.html", "ç¬¬ 8 ç«  GSVA åˆ†æ 8.1 åŠ è½½æ•°æ®å’ŒRåŒ… 8.2 åšGSVA 8.3 çƒ­å›¾å¯è§†åŒ–", " ç¬¬ 8 ç«  GSVA åˆ†æ å•ç»†èƒæ•°æ®çš„GSVAå’ŒèŠ¯ç‰‡ã€bulkè½¬å½•ç»„çš„GSVAæ²¡æœ‰æœ¬è´¨åŒºåˆ«ï¼Œå°±ä½¿ç”¨AverageExpressionè·å–å¹³å‡è¡¨è¾¾é‡å¾—åˆ°æ–°çš„è¡¨è¾¾çŸ©é˜µå†è®¡ç®—å³å¯ã€‚ 8.1 åŠ è½½æ•°æ®å’ŒRåŒ… è·å¾—æ¯ç§ç»†èƒçš„å¹³å‡è¡¨è¾¾é‡. è¿™é‡Œçš„ç¤ºä¾‹æ•°æ®seu.obj.Rdataæ˜¯GSE218208é™ç»´èšç±»åˆ†ç¾¤çš„ç»“æœï¼Œå› ä¸ºæ–‡ä»¶å¤ªå¤§ï¼Œæ²¡æœ‰ç›´æ¥æ”¾è¿›æ–‡ä»¶å¤¹é‡Œï¼Œå¦‚æœloadæŠ¥é”™å°±è‡ªå·±è¿è¡Œä¸€ä¸‹éš”å£GSE218208çš„ä»£ç å¾—åˆ°è¿™ä¸ªæ–‡ä»¶å†è·‘ã€‚ rm(list = ls()) library(Seurat) library(GSVA) library(clusterProfiler) load(&quot;../2.GSE218208/seu.obj.Rdata&quot;) table(Idents(seu.obj)) ## ## Naive CD4 T CD14+ Mono B CD8 T NK FCGR3A+ Mono ## 1675 1206 598 406 337 125 ## Platelet DC ## 48 88 exp = AverageExpression(seu.obj)[[1]] #exp = AggregateExpression(seu.obj)[[1]] exp = as.matrix(exp) exp = exp[rowSums(exp)&gt;0,] exp[1:4,1:4] ## Naive CD4 T CD14+ Mono B CD8 T ## TSPAN6 0.01890007 0.000000000 0.00000000 0.00446691 ## DPM1 0.50764534 0.398461857 0.52602493 0.49951298 ## SCYL3 0.10701976 0.049771894 0.10397003 0.12101561 ## C1orf112 0.02653607 0.005093801 0.05426134 0.02747031 Seurat v5 æç¤ºå»ºè®®ç”¨AggregateExpressionåšä¼ªbulkè½¬å½•ç»„åˆ†æï¼Œé‚£ä¸ªæ˜¯ç”¨æ¥æ±‚å’Œçš„ï¼Œç›®å‰æŸ¥åˆ°çš„æ–‡çŒ®å’Œæ•™ç¨‹éƒ½æ˜¯ä½¿ç”¨å¹³å‡å€¼ï¼Œè¿™é‡Œå°±æœ¨æœ‰æ”¹åŠ¨. 8.2 åšGSVA gmtæ–‡ä»¶ä¸‹è½½è‡ªGSEA-msigdbå®˜ç½‘ h_df = read.gmt(&quot;h.all.v2023.2.Hs.symbols.gmt&quot;)[,c(2,1)] h_list = unstack(h_df) # ES = gsva(exp, h_list) #â­R è¯­è¨€ç‰ˆæœ¬4.3è¿è¡Œè¿™ä¸€å¥ï¼Œä»£æ›¿ä¸‹é¢çš„ä¸¤å¥ gsvapar &lt;- gsvaParam(exp, h_list, maxDiff=TRUE) ES &lt;- gsva(gsvapar) ES[1:4,1:4] 8.3 çƒ­å›¾å¯è§†åŒ– library(pheatmap) pheatmap(ES, scale = &quot;row&quot;,angle_col = &quot;45&quot;, color = colorRampPalette(c(&quot;navy&quot;, &quot;white&quot;, &quot;firebrick3&quot;))(50)) "],["ç»†èƒå‘¨æœŸ.html", "ç¬¬ 9 ç«  ç»†èƒå‘¨æœŸ 9.1 è¯»å–æ•°æ®å¹¶åšå¥½å‰æœŸçš„è´¨æ§ 9.2 è®¡ç®—ç»†èƒå‘¨æœŸè¯„åˆ† 9.3 æ¯”è¾ƒä¸¤ä¸ªæ•°æ®çš„ç»†èƒå‘¨æœŸè¯„åˆ†å’ŒPCA 9.4 æ¯”è¾ƒå»é™¤å’Œä¸å»å¤„ç»†èƒå‘¨æœŸå½±å“çš„ä¸‹æ¸¸æ³¨é‡Š", " ç¬¬ 9 ç«  ç»†èƒå‘¨æœŸ æ€ä¹ˆçŸ¥é“æˆ‘çš„å•ç»†èƒæ•°æ®éœ€ä¸éœ€è¦å»é™¤ç»†èƒå‘¨æœŸçš„å½±å“å‘¢ èƒŒæ™¯çŸ¥è¯† å°˜å°çš„é«˜ä¸­ç”Ÿç‰©å­¦çŸ¥è¯†ï¼Œç»†èƒçš„æœ‰ä¸åˆ†è£‚ï¼Œåˆ†ä¸ºåˆ†è£‚æœŸï¼ˆMï¼‰å’Œåˆ†è£‚é—´æœŸï¼ˆG1ï¼ŒSï¼ŒG2ï¼‰ï¼Œç»†èƒå¤„äºä¸åŒçš„ç»†èƒå‘¨æœŸæ—¶ï¼Œä»£è°¢æ´»è·ƒçŠ¶æ€å’ŒæŸ“è‰²ä½“çš„çŠ¶æ€å¤§ä¸ç›¸åŒï¼Œç›´æ¥æ¯”è¾ƒè¡¨è¾¾é‡æ˜¯ä¸å…¬å¹³çš„ã€‚ åœ¨ä¸€äº›æ•°æ®ä¸­ï¼Œç»†èƒå‘¨æœŸçš„å½±å“å¾ˆå¤§ï¼Œå¤§åˆ°æ¯ä¸ªå‘¨æœŸçš„ç»†èƒå„è‡ªèšæˆä¸€ç°‡ï¼Œä¸¥é‡å½±å“ä¸‹æ¸¸çš„èšç±»å’Œåˆ†ç¾¤ã€‚æœ‰çš„æ•°æ®ä¸­ï¼Œç»†èƒå‘¨æœŸçš„å½±å“éå¸¸ä¹‹ä½ï¼Œå¯ä»¥å¿½ç•¥ä¸è®°ã€‚ Seuratæœ‰è‡ªå¸¦çš„æ–¹æ³•ï¼Œæ ¹æ®åœ¨å„ä¸ªå‘¨æœŸé«˜è¡¨è¾¾çš„åŸºå› æ¥è®¡ç®—ç»†èƒå‘¨æœŸè¯„åˆ†ï¼Œæ ¹æ®è¯„åˆ†çš„é«˜ä½æ¥æ¨æ–­ç»†èƒå±äºä»€ä¹ˆå‘¨æœŸã€‚ è®©æˆ‘ä»¬æ¥åº·ä¸€åº·å¦‚ä½•æ¢ç´¢ç»†èƒå‘¨æœŸï¼Œä»¥åŠæœ‰å½±å“å’Œæ²¡å½±å“çš„æ•°æ®å„è‡ªé•¿ä»€ä¹ˆæ ·ã€‚ 9.1 è¯»å–æ•°æ®å¹¶åšå¥½å‰æœŸçš„è´¨æ§ æ¥è‡ªSeurat Vignetteçš„ç¤ºä¾‹æ•°æ® https://satijalab.org/seurat/articles/cell_cycle_vignette 9.1.1 GSE218208 #untar(&quot;GSE218208_RAW.tar&quot;) rm(list = ls()) a = data.table::fread(&quot;GSM6736629_10x-PBMC-1_ds0.1974_CountMatrix.tsv.gz&quot;,data.table = F) a[1:4,1:4] ## alias:gene AAACCCAAGTAGGGTC AAACCCACACCATTCC AAACCCATCTACACTT ## 1 TSPAN6:ENSG00000000003 0 0 0 ## 2 DPM1:ENSG00000000419 0 1 0 ## 3 SCYL3:ENSG00000000457 0 0 0 ## 4 C1orf112:ENSG00000000460 0 0 0 library(tidyverse) a$`alias:gene` = str_split_i(a$`alias:gene`,&quot;:&quot;,i = 1) a = distinct(a,`alias:gene`,.keep_all = T) a = column_to_rownames(a,var = &quot;alias:gene&quot;) a[1:4,1:4] ## AAACCCAAGTAGGGTC AAACCCACACCATTCC AAACCCATCTACACTT AAACGAAAGCACGTCC ## TSPAN6 0 0 0 0 ## DPM1 0 1 0 0 ## SCYL3 0 0 0 0 ## C1orf112 0 0 0 0 library(Seurat) pbmc &lt;- CreateSeuratObject(counts = a, project = &quot;a&quot;, min.cells = 3, min.features = 200) pbmc[[&quot;percent.mt&quot;]] &lt;- PercentageFeatureSet(pbmc, pattern = &quot;^MT-&quot;) head(pbmc@meta.data, 3) ## orig.ident nCount_RNA nFeature_RNA percent.mt ## AAACCCAAGTAGGGTC a 10768 3213 7.030089 ## AAACCCACACCATTCC a 4102 1676 5.046319 ## AAACCCATCTACACTT a 4694 1740 6.305922 VlnPlot(pbmc, features = c(&quot;nFeature_RNA&quot;, &quot;nCount_RNA&quot;, &quot;percent.mt&quot;), ncol = 3,pt.size = 0.5) pbmc = subset(pbmc,nFeature_RNA &lt; 4200 &amp; nCount_RNA &lt; 18000 &amp; percent.mt &lt; 10) 9.1.2 marrow exp.mat &lt;- read.delim(&quot;nestorawa_forcellcycle_expressionMatrix.txt&quot;,row.names = 1) marrow &lt;- CreateSeuratObject(counts = exp.mat, project = &quot;b&quot;, min.cells = 3, min.features = 200) marrow[[&quot;percent.mt&quot;]] &lt;- PercentageFeatureSet(marrow, pattern = &quot;^MT-&quot;) head(marrow@meta.data, 3) ## orig.ident nCount_RNA nFeature_RNA percent.mt ## Prog_013 Prog 2563086 10208 5.187809 ## Prog_019 Prog 3030619 9990 5.965877 ## Prog_031 Prog 1293487 10192 5.664456 VlnPlot(marrow, features = c(&quot;nFeature_RNA&quot;, &quot;nCount_RNA&quot;, &quot;percent.mt&quot;), ncol = 3,pt.size = 0.5) #ä»å›¾ä¸Šå¯ä»¥çœ‹å‡ºè¿™ä¸ªæ•°æ®å·²ç»è¿‡æ»¤äº† 9.2 è®¡ç®—ç»†èƒå‘¨æœŸè¯„åˆ† check_cc = function(ob){ s.genes &lt;- intersect(cc.genes$s.genes,rownames(ob)) g2m.genes &lt;- intersect(cc.genes$g2m.genes,rownames(ob)) ob = ob %&gt;% NormalizeData() %&gt;% FindVariableFeatures() %&gt;% CellCycleScoring(s.features = s.genes, g2m.features = g2m.genes) %&gt;% ScaleData(features = rownames(.)) %&gt;% RunPCA(features = c(s.genes,g2m.genes)) return(ob) } ob1 = check_cc(pbmc) head(ob1@meta.data) ## orig.ident nCount_RNA nFeature_RNA percent.mt S.Score ## AAACCCAAGTAGGGTC a 10768 3213 7.030089 -0.049741327 ## AAACCCACACCATTCC a 4102 1676 5.046319 0.077834857 ## AAACCCATCTACACTT a 4694 1740 6.305922 -0.042199858 ## AAACGAAAGCACGTCC a 5584 2055 4.512894 -0.005870195 ## AAACGAAGTTCAAACC a 2917 1548 2.673980 -0.036017674 ## AAACGAAGTTGGACTT a 3755 1408 5.219707 -0.008708112 ## G2M.Score Phase ## AAACCCAAGTAGGGTC -0.078938340 G1 ## AAACCCACACCATTCC -0.036964594 S ## AAACCCATCTACACTT -0.033518345 G1 ## AAACGAAAGCACGTCC -0.026582838 G1 ## AAACGAAGTTCAAACC 0.006352434 G2M ## AAACGAAGTTGGACTT -0.060231178 G1 9.3 æ¯”è¾ƒä¸¤ä¸ªæ•°æ®çš„ç»†èƒå‘¨æœŸè¯„åˆ†å’ŒPCA å¯ä»¥çœ‹åˆ°è¿™ä¸ªå‡½æ•°å¤„ç†å®Œåï¼Œmeta.dataé‡Œé¢å¤šäº†4åˆ—ï¼Œåˆ†åˆ«æ˜¯så’Œg2mçš„è¯„åˆ†ä»¥åŠæ¨æ–­çš„ç»†èƒå‘¨æœŸã€‚ table(ob1$Phase) ## ## G1 G2M S ## 1821 1224 1294 ob2 = check_cc(marrow) table(ob2$Phase) ## ## G1 G2M S ## 279 183 312 PCAPlot(ob1,group.by = &quot;Phase&quot;)+ PCAPlot(ob2,group.by = &quot;Phase&quot;) è¿™æ ·çš„æ¯”è¾ƒä¸å¤ªç›´è§‚ï¼ŒæŠŠåæ ‡è°ƒåˆ°ç›¸åŒèŒƒå›´ library(patchwork) PCAPlot(ob1,group.by = &quot;Phase&quot;)+ PCAPlot(ob2,group.by = &quot;Phase&quot;)&amp; xlim(-10,10)&amp; ylim(-10,10) å†æ¯”è¾ƒä¸€ä¸‹S.Scoreå’ŒG2M.Score p1 = VlnPlot(ob1,&quot;S.Score&quot;,group.by = &quot;Phase&quot;) p2 = VlnPlot(ob2,&quot;S.Score&quot;,group.by = &quot;Phase&quot;) wrap_plots(p1,p2,nrow = 1) &amp; ylim(-0.6,0.6) p1 = VlnPlot(ob1,&quot;G2M.Score&quot;,group.by = &quot;Phase&quot;) p2 = VlnPlot(ob2,&quot;G2M.Score&quot;,group.by = &quot;Phase&quot;) wrap_plots(p1,p2,nrow = 1) &amp; ylim(-0.5,1) è¿™ä¸ªå‘¨æœŸçš„åˆ¤æ–­è¿˜æ˜¯æ¯”è¾ƒç²—æš´çš„ï¼Œå“ªä¸ªåˆ†é«˜å°±æ˜¯é‚£ä¸ªå‘¨æœŸï¼Œä¸¤ä¸ªåˆ†éƒ½æ˜¯è´Ÿçš„é‚£å°±G1æœŸã€‚ å› æ­¤è™½ç„¶GSE218208çš„æ•°æ®ä¹Ÿæ˜¯æœ‰å‘¨æœŸåŒºåˆ«ï¼Œä½†æ˜¯åˆ†æ•°ç›¸å·®å¾ˆå°ï¼Œå½±å“å¾ˆå°ã€‚ æ‰€ä»¥åƒè¿™æ ·çš„å¤§å¤šæ•°ç‚¹éƒ½é›†ä¸­åœ¨0ç‚¹é™„è¿‘çš„æ•°æ®ï¼Œå°±å¯ä»¥ä¸ç”¨å»é™¤ç»†èƒå‘¨æœŸçš„å½±å“ï¼ okï¼Œä½ ä¸è¸å®ã€‚é‚£æˆ‘ä»¬æ¥æ¯”è¾ƒä¸€ä¸‹å»é™¤å’Œä¸å»é™¤ç»†èƒå‘¨æœŸå½±å“çš„ä¸‹æ¸¸æ³¨é‡Šçœ‹æœ‰æ²¡æœ‰åŒºåˆ«å§ã€‚ 9.4 æ¯”è¾ƒå»é™¤å’Œä¸å»å¤„ç»†èƒå‘¨æœŸå½±å“çš„ä¸‹æ¸¸æ³¨é‡Š 9.4.1 ä¸è€ƒè™‘ç»†èƒå‘¨æœŸçš„é™ç»´èšç±»åˆ†ç¾¤ f = &quot;ob1.Rdata&quot; if(!file.exists(f)){ ob1 = pbmc %&gt;% NormalizeData() %&gt;% FindVariableFeatures() %&gt;% ScaleData(features = rownames(.)) %&gt;% RunPCA(features = VariableFeatures(.)) %&gt;% FindNeighbors(dims = 1:15) %&gt;% FindClusters(resolution = 0.5) %&gt;% RunUMAP(dims = 1:15) %&gt;% RunTSNE(dims = 1:15) save(ob1,file = f) } ## Modularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck ## ## Number of nodes: 4339 ## Number of edges: 151523 ## ## Running Louvain algorithm... ## Maximum modularity in 10 random starts: 0.8942 ## Number of communities: 12 ## Elapsed time: 0 seconds load(f) 9.4.2 è€ƒè™‘ç»†èƒå‘¨æœŸçš„é™ç»´èšç±»åˆ†ç¾¤ s.genes &lt;- intersect(cc.genes$s.genes,rownames(pbmc)) g2m.genes &lt;- intersect(cc.genes$g2m.genes,rownames(pbmc)) f = &quot;ob2.Rdata&quot; if(!file.exists(f)){ ob2 = pbmc %&gt;% NormalizeData() %&gt;% FindVariableFeatures() %&gt;% CellCycleScoring(s.features = s.genes, g2m.features = g2m.genes) %&gt;% ScaleData(vars.to.regress = c(&quot;S.Score&quot;, &quot;G2M.Score&quot;),features = rownames(.)) %&gt;% #è¿è¡Œæå…¶æ…¢ RunPCA(features = VariableFeatures(.)) %&gt;% FindNeighbors(dims = 1:15) %&gt;% FindClusters(resolution = 0.5) %&gt;% RunUMAP(dims = 1:15) %&gt;% RunTSNE(dims = 1:15) save(ob2,file = f) } ## Modularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck ## ## Number of nodes: 4339 ## Number of edges: 146175 ## ## Running Louvain algorithm... ## Maximum modularity in 10 random starts: 0.8902 ## Number of communities: 13 ## Elapsed time: 0 seconds load(f) p1 &lt;- DimPlot(ob1, reduction = &quot;umap&quot;,label = T)+NoLegend() p2 &lt;- DimPlot(ob2, reduction = &quot;umap&quot;,label = T)+NoLegend() p1+p2 ç®€å•ç‚¹ç”¨singleRæ¥æ³¨é‡Š library(celldex) library(SingleR) ls(&quot;package:celldex&quot;) ## [1] &quot;BlueprintEncodeData&quot; &quot;DatabaseImmuneCellExpressionData&quot; ## [3] &quot;defineTextQuery&quot; &quot;fetchLatestVersion&quot; ## [5] &quot;fetchMetadata&quot; &quot;fetchReference&quot; ## [7] &quot;HumanPrimaryCellAtlasData&quot; &quot;ImmGenData&quot; ## [9] &quot;listReferences&quot; &quot;listVersions&quot; ## [11] &quot;MonacoImmuneData&quot; &quot;MouseRNAseqData&quot; ## [13] &quot;NovershternHematopoieticData&quot; &quot;saveReference&quot; ## [15] &quot;searchReferences&quot; &quot;surveyReferences&quot; f = &quot;../supp/single_ref/ref_Human_all.RData&quot; if(!file.exists(f)){ ref &lt;- celldex::HumanPrimaryCellAtlasData() save(ref,file = f) } ref &lt;- get(load(f)) library(BiocParallel) scRNA = ob1 test = scRNA@assays$RNA$data pred.scRNA &lt;- SingleR(test = test, ref = ref, labels = ref$label.main, clusters = scRNA@active.ident) new.cluster.ids &lt;- pred.scRNA$pruned.labels names(new.cluster.ids) &lt;- levels(scRNA) scRNA &lt;- RenameIdents(scRNA,new.cluster.ids) p3 &lt;- DimPlot(scRNA, reduction = &quot;umap&quot;,label = T,pt.size = 0.5) + NoLegend() m = scRNA è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆä¼šæœ‰scRNA = ob1,m = scRNAè¿™æ ·çš„ä»£ç ï¼š å½“ç„¶æ˜¯ä¸ºäº†å°‘æ”¹ä»£ç çŠ¯é”™è¯¯å•¦ã€‚ä¸¤æ¬¡æ³¨é‡Šçš„ä»£ç æ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœæŠŠscRNAè¿™ä¸ªå˜é‡åæ›¿æ¢æ‰å°±éº»çƒ¦ï¼Œåˆ«è¯´å¯ä»¥å…¨éƒ¨æ›¿æ¢ï¼Œä¸‡ä¸€ä½ æ›¿æ¢çš„å˜é‡åç§°æ˜¯å‡½æ•°æˆ–è€…æ–‡ä»¶åç­‰ä¸œè¥¿çš„ä¸€éƒ¨åˆ†ï¼Œé‚£ä¸è¿˜å¾—æŠ¥é”™è¿˜å¾—æ”¹å›å»ï¼Ÿæ‰€ä»¥ç§»èŠ±æ¥æœ¨å¦è¡Œèµ‹å€¼æ˜¯ä¸ªæ›´å¥½çš„é€‰æ‹©ã€‚ scRNA = ob2 test = scRNA@assays$RNA$data pred.scRNA &lt;- SingleR(test = test, ref = ref, labels = ref$label.main, clusters = scRNA@active.ident) new.cluster.ids &lt;- pred.scRNA$pruned.labels names(new.cluster.ids) &lt;- levels(scRNA) scRNA &lt;- RenameIdents(scRNA,new.cluster.ids) p4 &lt;- DimPlot(scRNA, reduction = &quot;umap&quot;,label = T,pt.size = 0.5) + NoLegend() p3+p4 # table(Idents(m)==Idents(scRNA)) å»ä¸å»é™¤å½“ç„¶è¿˜æ˜¯æœ‰åŒºåˆ«çš„ï¼Œåªä¸è¿‡å½±å“ä¸å¤§ï¼Œå¯ä»¥å¿½ç•¥ä¸è®¡å•Šã€‚ "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
