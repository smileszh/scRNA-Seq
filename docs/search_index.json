[["index.html", "scRNA-Seq åˆ†æç¬”è®° å‰è¨€", " scRNA-Seq åˆ†æç¬”è®° è‹æ€»å 2024-11-15 å‰è¨€ å•ç»†èƒæµ‹åºåˆ†æç¬”è®°ã€‚ "],["scrna-seq-ç®€ä»‹.html", "ç¬¬ 1 ç«  scRNA-Seq ç®€ä»‹", " ç¬¬ 1 ç«  scRNA-Seq ç®€ä»‹ â€¦â€¦ "],["scrna-seq-åŸºæœ¬æ¦‚å¿µ.html", "ç¬¬ 2 ç«  scRNA-Seq åŸºæœ¬æ¦‚å¿µ å•ç»†èƒ RNA æµ‹åº é«˜å˜åŸºå› ï¼ˆHighly Variable Genes, HVGsï¼‰ Marker åŸºå› ", " ç¬¬ 2 ç«  scRNA-Seq åŸºæœ¬æ¦‚å¿µ å•ç»†èƒ RNA æµ‹åº å•ç»†èƒRNAæµ‹åºï¼ˆscRNA-Seqï¼‰æ˜¯ä¸€ç§å‰æ²¿çš„é«˜é€šé‡æµ‹åºæŠ€æœ¯ï¼Œä¸“é—¨ç”¨äºå®šé‡åˆ†æå•ä¸ªç»†èƒå†…çš„è½¬å½•æœ¬è¡¨è¾¾æƒ…å†µã€‚è¯¥æŠ€æœ¯çš„æ ¸å¿ƒåœ¨äºèƒ½å¤Ÿä»å•ä¸ªç»†èƒä¸­æå–RNAï¼Œéšåå¯¹å…¶è¿›è¡Œé€†è½¬å½•å’Œæ‰©å¢ï¼Œä»¥ç”Ÿæˆé€‚åˆæµ‹åºçš„æ–‡åº“ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒscRNA-Seqèƒ½å¤Ÿæ•æ‰åˆ°ç»†èƒå†…å„ä¸ªåŸºå› çš„è¡¨è¾¾æ°´å¹³ï¼Œæ­ç¤ºç»†èƒç¾¤ä½“å†…çš„å¼‚è´¨æ€§ã€‚ ä¸ä¼ ç»Ÿçš„RNAæµ‹åºï¼ˆRNA-Seqï¼‰ç›¸æ¯”ï¼Œåè€…é€šå¸¸æ˜¯å¯¹å¤šä¸ªç»†èƒæˆ–ç»„ç»‡æ ·æœ¬çš„æ•´ä½“RNAè¿›è¡Œåˆ†æï¼Œæä¾›çš„æ˜¯å¹³å‡è¡¨è¾¾å€¼ï¼Œå¯èƒ½æ©ç›–ç»†èƒé—´çš„å·®å¼‚ã€‚è€ŒscRNA-Seqå¯ä»¥åœ¨å•ç»†èƒå±‚é¢ä¸Šè¿›è¡Œåˆ†æï¼Œä½¿å¾—ç ”ç©¶è€…èƒ½å¤Ÿè¯†åˆ«ä¸åŒç»†èƒç±»å‹ã€çŠ¶æ€åŠå…¶åœ¨ç‰¹å®šç”Ÿç‰©è¿‡ç¨‹ä¸­ï¼ˆå¦‚å‘è‚²ã€ç–¾ç—…æˆ–ååº”ï¼‰ä¸­çš„è§’è‰²ã€‚ scRNA-Seqçš„æµç¨‹ä¸€èˆ¬åŒ…æ‹¬ç»†èƒåˆ†ç¦»ã€RNAæå–ã€é€†è½¬å½•ã€æ‰©å¢å’Œæµ‹åºã€‚å¸¸ç”¨çš„ç»†èƒåˆ†ç¦»æŠ€æœ¯åŒ…æ‹¬å¾®æµä½“æŠ€æœ¯å’Œæ¿€å…‰æ•è·æ˜¾å¾®åˆ‡å‰²ã€‚æ•°æ®åˆ†ææ¶‰åŠå¤šç§ç”Ÿç‰©ä¿¡æ¯å­¦æ–¹æ³•ï¼Œå¦‚é™ç»´ï¼ˆä¾‹å¦‚t-SNEå’ŒUMAPï¼‰ã€èšç±»åˆ†æåŠå·®å¼‚è¡¨è¾¾åˆ†æï¼Œä»¥æ­ç¤ºç»†èƒçš„äºšç¾¤ä½“å’Œç‰¹å¾ã€‚ æ€»ä¹‹ï¼ŒscRNA-Seqä¸ºç ”ç©¶ç»†èƒåŠŸèƒ½ã€å‘è‚²å’Œç–¾ç—…æœºåˆ¶æä¾›äº†å¼ºå¤§çš„å·¥å…·ï¼Œæ¨åŠ¨äº†å¯¹å¤æ‚ç”Ÿç‰©ç³»ç»Ÿç†è§£çš„æ·±åŒ–ï¼Œå¹¶åœ¨è‚¿ç˜¤ç”Ÿç‰©å­¦ã€å…ç–«å­¦å’Œç¥ç»ç§‘å­¦ç­‰é¢†åŸŸå±•ç°å‡ºå¹¿é˜”çš„åº”ç”¨å‰æ™¯ã€‚ é«˜å˜åŸºå› ï¼ˆHighly Variable Genes, HVGsï¼‰ å®šä¹‰ï¼šé«˜å˜åŸºå› æ˜¯æŒ‡åœ¨ä¸åŒç»†èƒä¹‹é—´è¡¨è¾¾å·®å¼‚æ˜¾è‘—çš„åŸºå› ã€‚è¿™äº›åŸºå› åœ¨å•ç»†èƒæ°´å¹³ä¸Šè¡¨ç°å‡ºè¾ƒå¤§çš„å˜å¼‚æ€§ï¼Œé€šå¸¸ç”¨äºæ•æ‰ç»†èƒé—´çš„å¼‚è´¨æ€§ã€‚ ç”¨é€”ï¼šHVGså¸¸ç”¨äºé™ç»´åˆ†æï¼ˆå¦‚PCAã€t-SNEã€UMAPï¼‰å’Œèšç±»åˆ†æï¼Œå› ä¸ºå®ƒä»¬èƒ½å¤Ÿåæ˜ ä¸åŒç»†èƒä¹‹é—´çš„ç”Ÿç‰©å­¦å·®å¼‚ï¼Œå¸®åŠ©è¯†åˆ«å’Œåˆ†ç¦»ä¸åŒçš„ç»†èƒç¾¤ä½“ã€‚ åœ¨å•ç»†èƒRNAæµ‹åºæ•°æ®ä¸­ï¼Œé€šå¸¸ä¼šé€‰æ‹©è¡¨è¾¾å˜å¼‚æ€§è¾ƒå¤§çš„åŸºå› è¿›è¡Œåç»­åˆ†æã€‚ Marker åŸºå›  å®šä¹‰ï¼šMarkeråŸºå› æ˜¯æŒ‡åœ¨ç‰¹å®šç»†èƒç±»å‹æˆ–ç»†èƒçŠ¶æ€ä¸­è¡¨è¾¾æ˜¾è‘—é«˜äºå…¶ä»–ç»†èƒç±»å‹çš„åŸºå› ã€‚è¿™äº›åŸºå› å¯ä»¥ç”¨æ¥æ ‡è¯†å’ŒåŒºåˆ†ä¸åŒçš„ç»†èƒç¾¤ä½“ã€‚ ç”¨é€”ï¼šMarkeråŸºå› å¸¸ç”¨äºç»†èƒåˆ†ç±»ã€è¯†åˆ«ç‰¹å®šç»†èƒç±»å‹ï¼ˆå¦‚å…ç–«ç»†èƒã€ç¥ç»å…ƒç­‰ï¼‰å’Œç ”ç©¶ç»†èƒçš„åŠŸèƒ½ã€‚é€šè¿‡æ£€æµ‹è¿™äº›åŸºå› çš„è¡¨è¾¾ï¼Œå¯ä»¥åˆ¤æ–­ç»†èƒå±äºå“ªç§ç±»å‹ã€‚ ç¤ºä¾‹ï¼šä¾‹å¦‚ï¼ŒCD4å’ŒCD8æ˜¯Tç»†èƒçš„markeråŸºå› ï¼Œç¥ç»å…ƒçš„markeråŸºå› å¯èƒ½åŒ…æ‹¬NeuNç­‰ã€‚ "],["å•ç»†èƒåŸºæœ¬åˆ†ææµç¨‹.html", "ç¬¬ 3 ç«  å•ç»†èƒåŸºæœ¬åˆ†ææµç¨‹ æ•°æ®è¯»å– è´¨é‡æ§åˆ¶æŒ‡æ ‡ æ•°æ®æ ‡å‡†åŒ– è¯†åˆ«é«˜å˜åŸºå›  ç¼©æ”¾æ•°æ® PCAçº¿æ€§é™ç»´ ç»†èƒèšç±» éçº¿æ€§é™ç»´UMAP/tSNE", " ç¬¬ 3 ç«  å•ç»†èƒåŸºæœ¬åˆ†ææµç¨‹ å•ç»†èƒåˆ†æåŸºç¡€æµç¨‹ä¸€èˆ¬åˆ†ä¸ºåæ­¥ï¼š ğŸ’¡ step1: è®¾ç½®Seuratå¯¹è±¡ ğŸ’¡ step2: è´¨é‡æ§åˆ¶ ğŸ’¡ step3: è¡¨è¾¾é‡çš„æ ‡å‡†åŒ–å’Œå½’ä¸€åŒ– ğŸ’¡ step4: å»é™¤å¹²æ‰°å› ç´ (å¤šä¸ªæ ·æœ¬æ•´åˆ) ğŸ’¡ step5: è¯†åˆ«é«˜å˜åŸºå›  ğŸ’¡ step6: å¤šç§é™ç»´ç®—æ³• ğŸ’¡ step7: å¯è§†åŒ–é™ç»´ç»“æœ ğŸ’¡ step8: å¤šç§èšç±»ç®—æ³• ğŸ’¡ step9: èšç±»åæ‰¾æ¯ä¸ªç»†èƒäºšç¾¤çš„æ ‡å¿—åŸºå› è¿›è¡Œäºšç¾¤å‘½å ğŸ’¡ step10: ç»§ç»­åˆ†ç±» æ•°æ®è¯»å– åˆ›å»ºSeuratçš„å…³é”®æ˜¯è¯»å–æ•°æ®ï¼Œåˆ›å»ºSeuratå¯¹è±¡ã€‚å•ç»†èƒæ•°æ®ä¸€èˆ¬æ˜¯ä¸€ä¸ªç¨€ç–çŸ©é˜µï¼Œè¡Œæ˜¯åŸºå› ï¼Œåˆ—æ˜¯ç»†èƒï¼Œå…ƒç´ æ˜¯åŸºå› è¡¨è¾¾é‡ã€‚æˆ‘ä»¬å¸¸è§çš„æ•°æ®æ¥æºæœ‰10X Genomicsã€Drop-seqã€CEL-seq2ç­‰ã€‚ 10X Genomics ä¸‰æ–‡ä»¶ 10x Genomics çš„ç»†èƒåŸºå› çŸ©é˜µé€šå¸¸å­˜å‚¨åœ¨ä¸‰ä¸ªå…³é”®æ–‡ä»¶ä¸­ï¼Œè¿™äº›æ–‡ä»¶å…±åŒæè¿°äº†å•ç»†èƒæµ‹åºæ•°æ®ã€‚è¿™ä¸‰ä¸ªæ–‡ä»¶åˆ†åˆ«æ˜¯ï¼š - barcodes.tsvï¼šåŒ…å«æ¯ä¸ªç»†èƒçš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚ - features.tsvï¼šåŒ…å«æ¯ä¸ªåŸºå› çš„å”¯ä¸€æ ‡è¯†ç¬¦å’Œåç§°ã€‚ - matrix.mtxï¼šåŒ…å«æ¯ä¸ªç»†èƒå’ŒåŸºå› ä¹‹é—´çš„è¡¨è¾¾é‡ã€‚ 10x Genomics ä¸‰æ–‡ä»¶è¯¦è§£ barcodes.tsv ä¸€åˆ—å¤šè¡Œï¼Œæ¯ä¸€è¡Œä»£è¡¨ä¸€ä¸ªç»†èƒã€‚ AAACCCAAGAGGATCC-1 AAACCCAAGCCGCTTG-1 AAACCCAAGGATGGCT-1 AAACCCAGTCTCGGGT-1 AAACCCAGTGCCCGTA-1 AAACCCATCCCAAGCG-1 AAACCCATCCGCGGAT-1 AAACCCATCGAATCCA-1 AAACGAAAGCCTCTGG-1 AAACGAAAGTCATCCA-1 features/genes.tsv ä¸¤åˆ—å¤šè¡Œï¼Œæ¯ä¸€è¡Œä»£è¡¨ä¸€ä¸ªåŸºå› ï¼Œæ¯è¡Œç¬¬ä¸€ä¸ªæ˜¯åŸºå› IDï¼Œç¬¬äºŒä¸ªæ˜¯å¯¹åº”çš„åŸºå› symbolåç§°ã€‚ ENSMUSG00000086053 Gm15178 ENSMUSG00000100764 Gm29155 ENSMUSG00000102095 C730036E19Rik ENSMUSG00000100635 Gm29157 ENSMUSG00000100480 Gm29156 ENSMUSG00000051285 Pcmtd1 ENSMUSG00000097797 Gm26901 ENSMUSG00000103067 Gm30414 ENSMUSG00000026312 Cdh7 ENSMUSG00000039748 Exo1 matrix.mtx ä¸‰åˆ—å¤šè¡Œï¼Œå‰ä¸¤è¡Œå¯ä»¥ç†è§£ä¸ºæ ‡é¢˜ã€‚ä»ç¬¬ä¸‰è¡Œå¼€å§‹ï¼Œç¬¬ä¸€ä¸ªæ•°C1ä»£è¡¨åŸºå› ï¼ˆå³genes/features.tsvä¸­ç¬¬C1è¡Œå¯¹åº”çš„åŸºå› ï¼‰ï¼Œç¬¬äºŒä¸ªæ•°C2ä»£è¡¨ç»†èƒï¼ˆå³barcodes.tsvä¸­ç¬¬C2è¡Œå¯¹åº”çš„ç»†èƒï¼‰ï¼Œç¬¬ä¸‰åˆ—æ˜¯è¡¨è¾¾é‡ã€‚ %%MatrixMarket matrix coordinate integer general %metadata_json: {&quot;software_version&quot;: &quot;cellranger-6.1.0&quot;, &quot;format_version&quot;: 2} 33904 6739 16639697 18 1 1 36 1 1 63 1 2 111 1 1 118 1 1 135 1 1 167 1 1 æŸ¥çœ‹ä¸‰ä¸ªæ–‡ä»¶çš„è¡Œæ•°å³å¯¹åº” ç»†èƒæ•°é‡ï¼ŒåŸºå› æ•°é‡ï¼Œä»¥åŠæœ‰è¡¨è¾¾é‡çš„å€¼çš„æ•°é‡ $ wc -l * 2700 barcodes.tsv # ç»†èƒæ•°é‡ 32738 genes.tsv # åŸºå› æ•°ç›® 2286887 matrix.mtx # æœ‰è¡¨è¾¾é‡çš„å€¼çš„æ•°ç›® è´¨é‡æ§åˆ¶æŒ‡æ ‡ å•ç»†èƒæµ‹åºä¸­ä¸»è¦çš„è´¨é‡æ§åˆ¶æŒ‡æ ‡æœ‰ï¼š ğŸ§¬ç»†èƒä¸­æ£€æµ‹åˆ°çš„åŸºå› è®¡æ•° ä½è´¨é‡çš„ç»†èƒæˆ–ç©ºæ¶²æ»´é€šå¸¸å«æœ‰å¾ˆå°‘çš„åŸºå› è®¡æ•° ç»†èƒåŒèƒä½“æˆ–å¤šèƒä½“å¯èƒ½è¡¨ç°å‡ºå¼‚å¸¸é«˜çš„åŸºå› è®¡æ•° ğŸ§¬åŸºå› çš„è¡¨è¾¾é‡ ä½è¡¨è¾¾çš„åŸºå› å¯èƒ½æ˜¯å™ªéŸ³ ğŸ§¬ç»†èƒä¸­çº¿ç²’ä½“åŸºå› çš„æ¯”ä¾‹ é«˜çº¿ç²’ä½“åŸºå› æ¯” ä¾‹çš„ç»†èƒå¯èƒ½æ˜¯æ­»ç»†èƒ/å—åˆ°åº”æ¿€çš„ç»†èƒ nCount_RNA ä¸ percent.mt ç›¸å…³å…³ç³» æ­£å¸¸æƒ…å†µä¸‹ï¼ŒnCount_RNA ä¸ percent.mt çš„ç›¸å…³å…³ç³»æ¥è¿‘äº0ï¼Œå³çº¿ç²’ä½“åŸºå› çš„çš„æ¯”ä¾‹ï¼ˆpercent.mtï¼‰åœ¨ä¸åŒçš„ç»†èƒä¸­ä¸æ€»çš„ RNA è®¡æ•°ï¼ˆnCount_RNAï¼‰ä¹‹é—´æ²¡æœ‰æ˜æ˜¾çš„ç›¸å…³æ€§ã€‚ä½†å¦‚æœè§‚å¯Ÿåˆ°æ˜¾è‘—çš„è´Ÿç›¸å…³ï¼Œå¯èƒ½æ„å‘³ç€ç»†èƒå­˜åœ¨çº¿ç²’ä½“åŸºå› çš„å¼‚å¸¸é«˜è¡¨è¾¾ï¼ˆå¦‚ç»†èƒå‡‹äº¡ï¼‰ã€‚å› æ­¤ï¼Œè¿™ä¸€æ­¥æœ‰åŠ©äºè¯†åˆ«å’Œè¿‡æ»¤æ‰å¯èƒ½æœ‰é—®é¢˜çš„ç»†èƒã€‚ nCount_RNA ä¸ nFeature_RNA çš„å…³ç³» æ­£å¸¸æƒ…å†µä¸‹ï¼ŒnCount_RNA å’Œ nFeature_RNA ä¹‹é—´æœ‰å¾ˆå¼ºçš„æ­£ç›¸å…³å…³ç³»ã€‚å› ä¸ºä¸€èˆ¬æ¥è¯´ï¼Œæ£€æµ‹åˆ°çš„åŸºå› æ•°é‡ï¼ˆnFeature_RNAï¼‰ä¸æ€»çš„RNAè®¡æ•°ï¼ˆnCount_RNAï¼‰åº”è¯¥æˆæ­£æ¯”ã€‚å¼ºæ­£ç›¸å…³å…³ç³»è¡¨æ˜æ•°æ®è´¨é‡è‰¯å¥½ï¼Œæ•°æ®æ²¡æœ‰å—åˆ°è¿‡å¤šçš„å™ªéŸ³æˆ–åŒé‡ç»†èƒçš„å¹²æ‰°ã€‚ æ•°æ®æ ‡å‡†åŒ– æ•°æ®æ ‡å‡†åŒ–æ˜¯ä¸ºäº†æ¶ˆé™¤ä¸åŒç»†èƒä¹‹é—´çš„æŠ€æœ¯å·®å¼‚ï¼Œä½¿å¾—ä¸åŒç»†èƒä¹‹é—´çš„è¡¨è¾¾é‡å¯ä»¥è¿›è¡Œæ¯”è¾ƒã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œé‡‡ç”¨å…¨å±€å°ºåº¦æ ‡å‡†åŒ–æ–¹æ³•â€œLogNormalizeâ€ï¼Œå°†æ¯ä¸ªç»†èƒçš„ç‰¹å¾è¡¨è¾¾æµ‹é‡å€¼æ ‡å‡†åŒ–ä¸ºæ€»è¡¨è¾¾ï¼Œå°†å…¶ä¹˜ä»¥æ¯”ä¾‹å› å­ï¼ˆé»˜è®¤ä¸º 10,000ï¼‰ï¼Œå¹¶å¯¹ç»“æœè¿›è¡Œå¯¹æ•°è½¬æ¢ã€‚ è¯†åˆ«é«˜å˜åŸºå›  é«˜å˜åŸºå› æ˜¯æŒ‡åœ¨ç»†èƒç¾¤ä½“ä¸­è¡¨è¾¾å˜å¼‚è¾ƒå¤§çš„åŸºå› ã€‚è¿™äº›åŸºå› å¯èƒ½æ˜¯ç»†èƒäºšç¾¤çš„æ ‡å¿—åŸºå› ï¼Œä¹Ÿå¯èƒ½æ˜¯ç»†èƒçŠ¶æ€çš„æ ‡å¿—åŸºå› ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¡ç®—åŸºå› çš„æ–¹å·®æ¥è¯†åˆ«é«˜å˜åŸºå› ã€‚ä¸‹æ¸¸åˆ†æä¸­å…³æ³¨è¿™äº›åŸºå› æœ‰åŠ©äºçªå‡ºå•ç»†èƒæ•°æ®é›†ä¸­çš„ç”Ÿç‰©ä¿¡å·ã€‚ ç¼©æ”¾æ•°æ® æ•°æ®ç¼©æ”¾æ˜¯ä¸ºäº†æ¶ˆé™¤ä¸åŒåŸºå› è¡¨è¾¾é‡çš„é‡æå·®å¼‚ã€‚ä¸åŒåŸºå› çš„è¡¨è¾¾é‡å¯èƒ½æœ‰å¾ˆå¤§çš„å·®å¼‚ã€‚ç¼©æ”¾æ­¥éª¤é€šè¿‡å°†æ¯ä¸ªåŸºå› çš„è¡¨è¾¾é‡è½¬æ¢ä¸ºæ ‡å‡†æ­£æ€åˆ†å¸ƒï¼ˆå¹³å‡å€¼ä¸º0ï¼Œæ ‡å‡†å·®ä¸º1ï¼‰ï¼Œä½¿å¾—ä¸åŒåŸºå› çš„è¡¨è¾¾é‡å¯ä»¥è¿›è¡Œæ¯”è¾ƒã€‚æ­¤æ­¥éª¤åœ¨ä¸‹æ¸¸åˆ†æä¸­ç»™äºˆåŒç­‰çš„æƒé‡ï¼Œå› æ­¤é«˜è¡¨è¾¾çš„åŸºå› ä¸ä¼šå ä¸»å¯¼åœ°ä½ PCAçº¿æ€§é™ç»´ åœ¨å•ç»†èƒæµ‹åºæ•°æ®åˆ†æä¸­ï¼ŒPCAï¼ˆä¸»æˆåˆ†åˆ†æï¼‰çš„ä¸»è¦ç›®çš„æ˜¯ï¼š é™ç»´ï¼šå‡å°‘æ•°æ®çš„ç»´åº¦ï¼Œä½¿å¾—åç»­åˆ†æå’Œå¯è§†åŒ–æ›´åŠ ç®€å•å’Œé«˜æ•ˆã€‚ å»å™ªï¼šåˆ†ç¦»å™ªå£°ï¼Œä¿ç•™ä¸»è¦çš„ä¿¡å·ï¼Œæé«˜æ•°æ®è´¨é‡ã€‚ å¯è§†åŒ–ï¼šå°†é«˜ç»´æ•°æ®æŠ•å½±åˆ°äºŒç»´æˆ–ä¸‰ç»´ç©ºé—´ï¼Œä¾¿äºè§‚å¯Ÿå’Œç†è§£ä¸åŒç»†èƒç¾¤ä½“çš„åˆ†å¸ƒã€‚ ç‰¹å¾æå–ï¼šæ­ç¤ºæ•°æ®ä¸­çš„ä¸»è¦å˜åŒ–æ–¹å‘å’Œæ¨¡å¼ï¼Œå¸®åŠ©è¯†åˆ«ä¸åŒçš„ç”Ÿç‰©å­¦è¿‡ç¨‹æˆ–ç»†èƒçŠ¶æ€ã€‚ ç»†èƒèšç±» ç»†èƒåˆ†ç±»çš„ç›®çš„æ˜¯æ ¹æ®åŸºå› è¡¨è¾¾æ¨¡å¼å°†ç»†èƒåˆ†æˆä¸åŒçš„ç¾¤ä½“æˆ–ç°‡ï¼Œè¿™äº›ç¾¤ä½“ä»£è¡¨å…·æœ‰ç›¸ä¼¼åŸºå› è¡¨è¾¾ç‰¹å¾çš„ç»†èƒç±»å‹æˆ–äºšç¾¤ã€‚Seuraté‡‡ç”¨åŸºäºå›¾çš„èšç±»æ–¹æ³•ï¼Œå—åˆ°SNN-Cliqå’ŒPhenoGraphç­‰æ–¹æ³•çš„å¯å‘ã€‚ K-è¿‘é‚»å›¾ï¼ˆKNN Graphï¼‰ï¼š é¦–å…ˆåœ¨PCAç©ºé—´ä¸­åŸºäºæ¬§å‡ é‡Œå¾—è·ç¦»æ„å»ºKNNå›¾ï¼Œå¹¶ä½¿ç”¨Jaccardç›¸ä¼¼åº¦è°ƒæ•´è¾¹æƒé‡ï¼ˆé€šè¿‡FindNeighbors()å‡½æ•°å®Œæˆï¼‰ã€‚ æ¨¡å—åŒ–ä¼˜åŒ–èšç±»ï¼š ä½¿ç”¨Louvainç®—æ³•æˆ–SLMç®—æ³•è¿›è¡Œèšç±»ï¼ˆé€šè¿‡FindClusters()å‡½æ•°å®ç°ï¼‰ï¼Œä¼˜åŒ–æ¨¡å—åŒ–å‡½æ•°ã€‚ åˆ†è¾¨ç‡å‚æ•°æ§åˆ¶èšç±»çš„ç²’åº¦ï¼Œé€šå¸¸è®¾ç½®åœ¨0.4-1.2ä¹‹é—´ï¼Œå…·ä½“å€¼è§†æ•°æ®é›†å¤§å°è€Œå®šã€‚ èšç±»ç»“æœï¼š ä½¿ç”¨Idents()å‡½æ•°å¯ä»¥æ‰¾åˆ°æœ€ç»ˆçš„èšç±»ã€‚ éçº¿æ€§é™ç»´UMAP/tSNE UMAPå’Œt-SNEç”¨äºå°†é«˜ç»´åŸºå› è¡¨è¾¾æ•°æ®æ˜ å°„åˆ°ä¸€ä¸ªä½ç»´ç©ºé—´ï¼ˆé€šå¸¸æ˜¯2Dæˆ–3Dï¼‰ï¼Œä»¥ä¾¿äºå¯è§†åŒ–ã€‚ è¿™äº›é™ç»´æŠ€æœ¯ä¿ç•™äº†åŸå§‹æ•°æ®ä¸­çš„å±€éƒ¨ç»“æ„ï¼Œä½¿å¾—åœ¨ä½ç»´ç©ºé—´ä¸­ç›¸ä¼¼çš„ç»†èƒåœ¨å›¾ä¸­ä¹Ÿä¼šé è¿‘ã€‚ é™ç»´åçš„å¯è§†åŒ–å›¾æœ‰åŠ©äºç›´è§‚åœ°å±•ç¤ºç»†èƒä¹‹é—´çš„å…³ç³»å’Œèšç±»ç»“æœï¼Œå¸®åŠ©è¯†åˆ«å’Œè§£é‡Šä¸åŒç»†èƒç¾¤ä½“çš„åˆ†å¸ƒå’Œç›¸äº’å…³ç³»ã€‚ "],["å•æ ·æœ¬åˆ†æ.html", "ç¬¬ 4 ç«  å•æ ·æœ¬åˆ†æ è®¾ç½®Seuratå¯¹è±¡ è´¨é‡æ§åˆ¶ æ•°æ®æ ‡å‡†åŒ– è¯†åˆ«é«˜å˜åŸºå›  ç¼©æ”¾æ•°æ® PCA çº¿æ€§é™ç»´ ç»†èƒèšç±» éçº¿æ€§é™ç»´UMAP/tSNE marker åŸºå›  äºšç¾¤å‘½å", " ç¬¬ 4 ç«  å•æ ·æœ¬åˆ†æ æœ¬ç« èŠ‚æ•°æ®å’Œä»£ç æ¥è‡ªSeuratå®˜ç½‘æ•°æ®ï¼Œæ˜¯10X Genomics å…è´¹æä¾›çš„å¤–å‘¨è¡€å•æ ¸ç»†èƒ (PBMC) æ•°æ®ã€‚ æ•°æ®å¯åœ¨æ­¤ä¸‹è½½ã€‚ åŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š è®¾ç½®Seuratå¯¹è±¡ é¦–å…ˆè¯»å–æ•°æ®ã€‚Read10X() å‡½æ•°è¯»å–æ¥è‡ª 10X çš„ cellranger pipline çš„è¾“å‡ºï¼Œè¿”å›ä¸€ä¸ªå”¯ä¸€åˆ†å­æ ‡è¯†ï¼ˆUMIï¼‰è®¡æ•°çŸ©é˜µã€‚è¯¥çŸ©é˜µä¸­çš„å€¼è¡¨ç¤ºåœ¨æ¯ä¸ªå•å…ƒï¼ˆå³ç»†èƒï¼›åˆ—ï¼‰ä¸­æ£€æµ‹åˆ°çš„æ¯ä¸ªç‰¹å¾ï¼ˆå³åŸºå› ï¼›è¡Œï¼‰çš„åˆ†å­æ•°é‡ã€‚ç„¶åæˆ‘ä»¬ä½¿ç”¨è®¡æ•°çŸ©é˜µæ¥åˆ›å»ºSeuratå¯¹è±¡ã€‚è¯¥å¯¹è±¡å……å½“ä¸€ä¸ªå®¹å™¨ï¼Œå…¶ä¸­åŒ…å«å•ç»†èƒæ•°æ®é›†çš„æ•°æ®ï¼ˆå¦‚è®¡æ•°çŸ©é˜µï¼‰å’Œåˆ†æï¼ˆå¦‚ PCA æˆ–èšç±»ç»“æœï¼‰ã€‚ # åŠ è½½åŒ… library(dplyr) library(Seurat) library(patchwork) # è¯»å–æ•°æ® pbmc.data &lt;- Read10X(data.dir = &quot;data/single_sample/filtered_gene_bc_matrices/hg19/&quot;) # åˆ›å»ºSeuratå¯¹è±¡ pbmc &lt;- CreateSeuratObject(counts = pbmc.data, project = &quot;pbmc3k&quot;, #è‡ªå®šä¹‰é¡¹ç›®å min.cells = 3, # æ¯ä¸ªåŸºå› è‡³å°‘åœ¨3ä¸ªç»†èƒä¸­æ£€æµ‹åˆ° min.features = 200) # æ¯ä¸ªç»†èƒè‡³å°‘æ£€æµ‹åˆ°200ä¸ªåŸºå›  pbmc ## An object of class Seurat ## 13714 features across 2700 samples within 1 assay ## Active assay: RNA (13714 features, 0 variable features) ## 1 layer present: counts è´¨é‡æ§åˆ¶ åœ¨åˆ›å»ºSeuratæ—¶ (CreateSeuratObject) å·²ç»å®Œæˆäº†åŸºæœ¬çš„è´¨é‡æ§åˆ¶ï¼Œå³æ¯ä¸ªåŸºå› è‡³å°‘åœ¨3ä¸ªç»†èƒä¸­æ£€æµ‹åˆ°ï¼Œæ¯ä¸ªç»†èƒè‡³å°‘æ£€æµ‹åˆ°200ä¸ªåŸºå› ã€‚ ä½†ä»ç„¶å¯ä»¥æ ¹æ®éœ€è¦è¿›ä¸€æ­¥è¿‡æ»¤æ•°æ®ã€‚ä¾‹å¦‚é«˜åŸºå› è®¡æ•°ã€é«˜çº¿ç²’ä½“æ¯”ä¾‹çš„ç»†èƒã€‚ è®¡ç®—æ¯ä¸ªç»†èƒçº¿ç²’ä½“åŸºå› çš„ç™¾åˆ†æ¯” pbmc[[&quot;percent.mt&quot;]] &lt;- PercentageFeatureSet(pbmc, pattern = &quot;^MT-&quot;) QCæŒ‡æ ‡å‚¨å­˜ä½ç½® Seuratå¯¹è±¡çš„meta.dataä¸­å‚¨å­˜äº†è´¨é‡æ§åˆ¶çš„æŒ‡æ ‡ï¼Œä»–æ˜¯ä¸€ä¸ªæ•°æ®æ¡†ï¼Œæ¯ä¸€è¡Œä»£è¡¨ä¸€ä¸ªç»†èƒï¼Œæ¯ä¸€åˆ—ä»£è¡¨ä¸€ä¸ªæŒ‡æ ‡ã€‚ # æŸ¥çœ‹å‰5è¡Œ head(pbmc@meta.data, 5) ## orig.ident nCount_RNA nFeature_RNA percent.mt ## AAACATACAACCAC-1 pbmc3k 2419 779 3.0177759 ## AAACATTGAGCTAC-1 pbmc3k 4903 1352 3.7935958 ## AAACATTGATCAGC-1 pbmc3k 3147 1129 0.8897363 ## AAACCGTGCTTCCG-1 pbmc3k 2639 960 1.7430845 ## AAACCGTGTATGCG-1 pbmc3k 980 521 1.2244898 # View(pbmc@meta.data) #æˆ–è€…ç›´æ¥æŸ¥çœ‹ å…¶ä¸­ï¼Œå‰ä¸‰åˆ—æŒ‡æ ‡æ˜¯æˆ‘ä»¬åœ¨åˆ›å»ºSeuratå¯¹è±¡æ—¶å€™è®¾å®šçš„ã€‚ ç¬¬ä¸€åˆ—orig.identæ˜¯åŸå§‹ç»†èƒçš„æ ‡è¯†ï¼› ç¬¬äºŒåˆ—nCount_RNAæ˜¯æ¯ä¸ªç»†èƒçš„RNAåˆ†å­æ•°ï¼› ç¬¬ä¸‰åˆ—nFeature_RNAæ˜¯æ¯ä¸ªç»†èƒæ£€æµ‹åˆ°çš„åŸºå› æ•°ã€‚ QCå¯è§†åŒ– é€šå¸¸æˆ‘ä»¬å¯¹æ¯ä¸ªç»†èƒè¿›è¡Œç»Ÿè®¡åˆ†æåï¼Œä¼šå¾—åˆ°ä¸€äº›è´¨é‡æ§åˆ¶æŒ‡æ ‡ï¼Œå¦‚ç»†èƒçš„RNAåˆ†å­æ•°ã€æ£€æµ‹åˆ°çš„åŸºå› æ•°ã€çº¿ç²’ä½“åŸºå› çš„ç™¾åˆ†æ¯”ç­‰ã€‚æˆ‘ä»¬å¯¹è¿™äº›æŒ‡æ ‡è¿›è¡Œå¯è§†åŒ–ï¼Œä»¥ä¾¿æ›´å¥½åœ°äº†è§£æ•°æ®çš„è´¨é‡ã€‚è¿™ä¹Ÿä¸ºæˆ‘ä»¬å¦‚ä½•é€‰æ‹©åˆé€‚çš„è¿‡æ»¤é˜ˆå€¼è¿›è¡Œä¸‹ä¸€æ­¥åˆ†ææä¾›äº†å‚è€ƒã€‚ # å°æç´å›¾å¯è§†åŒ–QCæŒ‡æ ‡ VlnPlot(pbmc, features = c(&quot;nFeature_RNA&quot;, &quot;nCount_RNA&quot;, &quot;percent.mt&quot;), ncol = 3) # æ•£ç‚¹å›¾å¯è§†åŒ–QCæŒ‡æ ‡ FeatureScatter(pbmc, feature1 = &quot;nCount_RNA&quot;, feature2 = &quot;nFeature_RNA&quot;) | FeatureScatter(pbmc, feature1 = &quot;nCount_RNA&quot;, feature2 = &quot;nFeature_RNA&quot;) è¿‡æ»¤ æ ¹æ®æˆ‘ä»¬çš„è¿‡æ»¤æ ‡å‡†ï¼Œæˆ‘ä»¬å¯ä»¥è¿‡æ»¤æ‰ä¸€äº›è´¨é‡è¾ƒå·®çš„ç»†èƒã€‚ è¿™é‡Œæˆ‘ä»¬è¿‡æ»¤æ‰ RNAåˆ†å­æ•°å¤§äº2500å’Œå°äº200çš„ç»†èƒã€‚ çº¿ç²’ä½“æ¯”ä¾‹å¤§äº5%çš„ç»†èƒã€‚ pbmc &lt;- subset(pbmc, subset = nFeature_RNA &gt; 200 &amp; nFeature_RNA &lt; 2500 &amp; percent.mt &lt; 5) dim(pbmc) ## [1] 13714 2638 å¯ä»¥çœ‹åˆ°è¿‡æ»¤åæˆ‘ä»¬çš„ç»†èƒæ•°ä»2700é™åˆ°2638ã€‚ æ•°æ®æ ‡å‡†åŒ– pbmc &lt;- NormalizeData(pbmc, normalization.method = &quot;LogNormalize&quot;, scale.factor = 10000) æ ‡å‡†åŒ–å€¼å‚¨å­˜ä½ç½® head(pbmc[[&quot;RNA&quot;]]$data, 5)[,1:3] # åŒæ ·æ˜¯ä¸€ä¸ªç¨€ç–çŸ©é˜µ ## 5 x 3 sparse Matrix of class &quot;dgCMatrix&quot; ## AAACATACAACCAC-1 AAACATTGAGCTAC-1 AAACATTGATCAGC-1 ## AL627309.1 . . . ## AP006222.2 . . . ## RP11-206L10.2 . . . ## RP11-206L10.9 . . . ## LINC00115 . . . æ•°æ®æ ‡å‡†åŒ–å‰ååŒºåˆ« k_c&lt;- as.matrix(pbmc[[&quot;RNA&quot;]]$counts) # åŸå§‹è®¡æ•°çŸ©é˜µ k_n&lt;- as.matrix(pbmc[[&quot;RNA&quot;]]$data) # æ ‡å‡†åŒ–åçš„è®¡æ•°çŸ©é˜µ k1&lt;- apply(k_c, 2, sum) # åŸå§‹æ¯ä¸ªç»†èƒåŸºå› è¡¨è¾¾çš„æ€»è®¡æ•° k2&lt;- apply(k_n, 2, sum) # æ ‡å‡†åŒ–åæ¯ä¸ªç»†èƒåŸºå› è¡¨è¾¾çš„æ€»è®¡æ•° hist(k1, main=&quot;Histogram of raw data&quot;) hist(k2, main=&quot;hisogram of normalized data&quot;) è¯†åˆ«é«˜å˜åŸºå›  è¯†åˆ«é«˜å˜åŸºå› é€šè¿‡FindVariableFeatureså‡½æ•°å®ç°ã€‚è¯¥å‡½æ•°è®¡ç®—æ¯ä¸ªåŸºå› çš„æ–¹å·®ï¼Œå¹¶æ ¹æ®æ–¹å·®çš„å¤§å°å¯¹åŸºå› è¿›è¡Œæ’åºã€‚æˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸€å®šæ•°é‡çš„é«˜å˜åŸºå› ç”¨äºä¸‹æ¸¸åˆ†æã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªæ•°æ®é›†ä¼šè¿”å›2000ä¸ªé«˜å˜åŸºå› ã€‚ pbmc &lt;- FindVariableFeatures(pbmc, selection.method = &quot;vst&quot;, nfeatures = 2000) # Identify the 10 most highly variable genes top10 &lt;- head(VariableFeatures(pbmc), 10) # plot variable features with and without labels plot1 &lt;- VariableFeaturePlot(pbmc) plot2 &lt;- LabelPoints(plot = plot1, points = top10, repel = TRUE) plot1 + plot2 é«˜å˜åŸºå› ä¿¡æ¯å‚¨å­˜ä½ç½® pbmc[[&quot;RNA&quot;]]@meta.data$var.features %&gt;% is.na() %&gt;% `!` %&gt;% sum() ## [1] 2000 å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„æ•°æ®é›†ä¸­è¯†åˆ«åˆ°çš„2000ä¸ªé«˜å˜åŸºå› ã€‚ ç¼©æ”¾æ•°æ® åº”ç”¨çº¿æ€§å˜æ¢ï¼ˆâ€œscalingâ€ï¼‰ç¼©æ”¾æ•°æ®ï¼Œè¿™æ˜¯PCAç­‰é™ç»´æŠ€æœ¯ä¹‹å‰çš„æ ‡å‡†é¢„å¤„ç†æ­¥éª¤ï¼Œä½¿ç”¨ScaleDataå‡½æ•°å®Œæˆè¿™ä¸€æ­¥ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œä»…ç¼©æ”¾å¯å˜åŸºå› ï¼Œä½†ä¹Ÿå¯ä»¥é€‰æ‹©ç¼©æ”¾æ‰€æœ‰åŸºå› ã€‚ all.genes &lt;- rownames(pbmc) pbmc &lt;- ScaleData(pbmc, features = all.genes) ç¼©æ”¾åæ•°æ®å‚¨å­˜ä½ç½® pbmc[[&quot;RNA&quot;]]$scale.data[1:5, 1:3] ## AAACATACAACCAC-1 AAACATTGAGCTAC-1 AAACATTGATCAGC-1 ## AL627309.1 -0.05812316 -0.05812316 -0.05812316 ## AP006222.2 -0.03357571 -0.03357571 -0.03357571 ## RP11-206L10.2 -0.04166819 -0.04166819 -0.04166819 ## RP11-206L10.9 -0.03364562 -0.03364562 -0.03364562 ## LINC00115 -0.08223981 -0.08223981 -0.08223981 å¦‚ä½•æ¶ˆé™¤ä¸éœ€è¦çš„å˜å¼‚æº åœ¨ Seurat ä¸­ï¼ŒScaleData()å‡½æ•°ä¸ä»…ç”¨äºå¯¹æ•°æ®è¿›è¡Œç¼©æ”¾ï¼ˆæ ‡å‡†åŒ–ï¼‰ï¼Œè¿˜å¯ä»¥ç”¨äºå›å½’æ‰æ•°æ®ä¸­çš„ä¸éœ€è¦çš„å˜å¼‚æ¥æºã€‚è¿™äº›ä¸éœ€è¦çš„å˜å¼‚æ¥æºå¯èƒ½åŒ…æ‹¬ç»†èƒå‘¨æœŸé˜¶æ®µã€çº¿ç²’ä½“æ±¡æŸ“ç­‰ã€‚é€šè¿‡å›å½’æ‰è¿™äº›å˜å¼‚æ¥æºï¼Œå¯ä»¥å‡å°‘å®ƒä»¬å¯¹ä¸‹æ¸¸åˆ†æï¼ˆå¦‚èšç±»ã€é™ç»´ç­‰ï¼‰çš„å½±å“ï¼Œä»è€Œæ›´å¥½åœ°æ­ç¤ºç”Ÿç‰©å­¦ä¸Šæœ‰æ„ä¹‰çš„ä¿¡å·ã€‚ â€œå›å½’æ‰â€å˜å¼‚æ¥æºæ˜¯æŒ‡é€šè¿‡çº¿æ€§å›å½’æ¨¡å‹ï¼Œå°†è¿™äº›ä¸éœ€è¦çš„å˜å¼‚ä»åŸºå› è¡¨è¾¾æ•°æ®ä¸­ç§»é™¤ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯å‡å°‘è¿™äº›å˜å¼‚å¯¹æ•°æ®çš„å½±å“ï¼Œä½¿å¾—ä¸‹æ¸¸åˆ†ææ›´åŠ å‡†ç¡®å’Œå¯é ã€‚ pbmc &lt;- ScaleData(pbmc, vars.to.regress = &quot;percent.mt&quot;) ä½†æ˜¯å¯¹äºæƒ³ä½¿ç”¨æ­¤åŠŸèƒ½çš„ï¼ŒSeuratä½œè€…å®˜ç½‘ä¸­å¼ºçƒˆå»ºè®®åœ¨æ•°æ®æ ‡å‡†åŒ–æ­¥éª¤èµ°SCTransform()æµç¨‹ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ScaleDataå‡½æ•°ã€‚ PCA çº¿æ€§é™ç»´ PCA æ˜¯ä¸€ç§å¸¸ç”¨çš„é™ç»´æŠ€æœ¯ï¼Œç”¨äºå°†é«˜ç»´æ•°æ®è½¬æ¢ä¸ºä½ç»´æ•°æ®ã€‚åœ¨å•ç»†èƒæ•°æ®ä¸­ï¼ŒPCAé€šå¸¸ç”¨äºå‘ç°æ•°æ®ä¸­çš„ä¸»è¦å˜åŒ–æ–¹å‘ï¼Œä»¥ä¾¿åœ¨åç»­åˆ†æä¸­ä½¿ç”¨ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œä»…å°†å…ˆå‰è¯†åˆ«çš„é«˜å˜åŸºå› ç”¨äº PCA è¾“å…¥ã€‚PCA å¸®åŠ©è¯†åˆ«æ•°æ®ä¸­å˜åŒ–æœ€å¤§çš„æ–¹å‘ï¼Œå¹¶å°†è¿™äº›æ–¹å‘ä½œä¸ºæ–°çš„åæ ‡è½´ï¼ˆä¸»æˆåˆ†ï¼‰ï¼Œå‡å°‘æ•°æ®çš„ç»´åº¦ã€‚ pbmc &lt;- RunPCA(pbmc, features = VariableFeatures(object = pbmc)) # Examine and visualize PCA results a few different ways print(pbmc[[&quot;pca&quot;]], dims = 1:5, nfeatures = 5) ## PC_ 1 ## Positive: CST3, TYROBP, LST1, AIF1, FTL ## Negative: MALAT1, LTB, IL32, IL7R, CD2 ## PC_ 2 ## Positive: CD79A, MS4A1, TCL1A, HLA-DQA1, HLA-DQB1 ## Negative: NKG7, PRF1, CST7, GZMB, GZMA ## PC_ 3 ## Positive: HLA-DQA1, CD79A, CD79B, HLA-DQB1, HLA-DPB1 ## Negative: PPBP, PF4, SDPR, SPARC, GNG11 ## PC_ 4 ## Positive: HLA-DQA1, CD79B, CD79A, MS4A1, HLA-DQB1 ## Negative: VIM, IL7R, S100A6, IL32, S100A8 ## PC_ 5 ## Positive: GZMB, NKG7, S100A8, FGFBP2, GNLY ## Negative: LTB, IL7R, CKB, VIM, MS4A7 ğŸŒŸå¯è§†åŒ–PCAç»“æœ VizDimLoadings å‡½æ•°å¯è§†åŒ–å‰ä¸¤ä¸ªä¸»æˆåˆ†ï¼ˆPC1å’ŒPC2ï¼‰ä¸ŠåŸºå› çš„åŠ è½½å€¼ã€‚åŠ è½½å€¼ä»£è¡¨æ¯ä¸ªåŸºå› åœ¨ä¸»æˆåˆ†ä¸Šçš„è´¡çŒ®å¤§å°ï¼Œå¸®åŠ©è¯†åˆ«å“ªäº›åŸºå› åœ¨ç‰¹å®šä¸»æˆåˆ†ä¸Šæœ‰è¾ƒå¤§çš„å½±å“ã€‚ VizDimLoadings(pbmc, dims = 1:2, reduction = &quot;pca&quot;) DimPlot(pbmc, reduction = &quot;pca&quot;) + NoLegend() DimHeatmap() å‡½æ•°ç”¨äºåœ¨ä¸»æˆåˆ†åˆ†æï¼ˆPCAï¼‰åç”Ÿæˆçƒ­å›¾ï¼Œå¸®åŠ©æ¢ç´¢æ•°æ®ä¸­çš„ä¸»è¦å¼‚è´¨æ€§æ¥æºï¼Œå¹¶å†³å®šå“ªäº›ä¸»æˆåˆ†ï¼ˆPCsï¼‰åº”åŒ…æ‹¬åœ¨åç»­åˆ†æä¸­ã€‚çƒ­å›¾ä¸­çš„ç»†èƒå’Œç‰¹å¾æ ¹æ®å®ƒä»¬çš„ PCA åˆ†æ•°æ’åºï¼Œè®¾ç½® cells å‚æ•°ä¸ºä¸€ä¸ªæ•°å­—å¯ä»¥åŠ é€Ÿå¤§æ•°æ®é›†çš„ç»˜å›¾ã€‚å°½ç®¡è¿™æ˜¯ç›‘ç£åˆ†æï¼Œä½†å®ƒæ˜¯æ¢ç´¢ç›¸å…³ç‰¹å¾é›†çš„æœ‰ä»·å€¼å·¥å…·ã€‚ DimHeatmap(pbmc, dims = 1, cells = 500, balanced = TRUE) DimHeatmap(pbmc, dims = 1:15, cells = 500, balanced = TRUE) ç¡®å®šæ•°æ®é›†çš„â€œç»´åº¦â€ å•ä¸ªç‰¹å¾çš„æŠ€æœ¯å™ªå£°åœ¨ scRNA-seq æ•°æ®ä¸­é€šå¸¸å¾ˆå¤§ã€‚ä¸ºäº†å…‹æœè¿™ä¸€é—®é¢˜ï¼ŒSeurat æ ¹æ®ç»†èƒçš„ PCA åˆ†æ•°è¿›è¡Œèšç±»ï¼Œæ¯ä¸ªä¸»æˆåˆ†ï¼ˆPCï¼‰å®é™…ä¸Šä»£è¡¨ä¸€ä¸ªâ€œå…ƒç‰¹å¾â€ï¼Œå®ƒç»“åˆäº†å¤šä¸ªç›¸å…³ç‰¹å¾çš„ä¿¡æ¯ã€‚å› æ­¤ï¼Œå‰å‡ ä¸ªä¸»æˆåˆ†ä»£è¡¨äº†æ•°æ®é›†çš„ä¸€ä¸ªç¨³å¥å‹ç¼©ã€‚ä½†æ˜¯é¢ä¸´çš„ä¸€ä¸ªé‡è¦é—®é¢˜æ˜¯åº”è¯¥é€‰æ‹©å¤šå°‘ä¸ªä¸»æˆåˆ†æ¥åŒ…æ‹¬åœ¨åˆ†æä¸­ï¼Œæ¯”å¦‚ 10 ä¸ªã€20 ä¸ªè¿˜æ˜¯ 100 ä¸ªï¼Ÿ Seurat ä½œè€…æ¨èå¯ä»¥ç”Ÿæˆä¸€ä¸ªâ€œè‚˜éƒ¨å›¾â€ï¼ˆElbow plotï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäºæ¯ä¸ªä¸»æˆåˆ†æ‰€è§£é‡Šçš„æ–¹å·®ç™¾åˆ†æ¯”çš„æ’åã€‚å›¾ä¸­é€šå¸¸ä¼šå‡ºç°ä¸€ä¸ªâ€è‚˜éƒ¨â€ï¼Œå³æ ‡å‡†å·®å¼€å§‹æ˜¾è‘—ä¸‹é™çš„ç‚¹ï¼Œé€‰æ‹©è¿™ä¸ªç‚¹ä¹‹å‰çš„ä¸»æˆåˆ†æ•°ç›®é€šå¸¸æ˜¯åˆé€‚çš„ã€‚å¹¶ä¸”å»ºè®®åœ¨é€‰æ‹©è¯¥å‚æ•°æ—¶å®å¯åé«˜ã€‚ ElbowPlot(pbmc) åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°å¤§çº¦åœ¨ç¬¬ 9-10 ä¸ªä¸»æˆåˆ†å¤„å‡ºç°ä¸€ä¸ªâ€œè‚˜éƒ¨â€ï¼Œè¿™è¡¨æ˜å‰ 10 ä¸ªä¸»æˆåˆ†æ•æ‰åˆ°äº†å¤§éƒ¨åˆ†çš„çœŸå®ä¿¡å·ã€‚ ç»†èƒèšç±» FindNeighbors()å‡½æ•°å°†å…ˆå‰å®šä¹‰çš„æ•°æ®é›†ç»´åº¦ï¼ˆå‰ 10 ä¸ª PCï¼‰ä½œä¸ºè¾“å…¥ã€‚ FindClusters()å‡½æ•°åŒ…å«ä¸€ä¸ªåˆ†è¾¨ç‡å‚æ•°ï¼Œç”¨äºè®¾ç½®ä¸‹æ¸¸èšç±»çš„â€œç²’åº¦â€ï¼Œå¢åŠ çš„å€¼ä¼šå¯¼è‡´æ›´å¤šçš„èšç±»ã€‚æ­¤å‚æ•°è®¾ç½®åœ¨ 0.4-1.2 ä¹‹é—´é€šå¸¸ä¼šä¸ºå¤§çº¦ 3K ç»†èƒçš„å•ç»†èƒæ•°æ®é›†å¸¦æ¥è‰¯å¥½çš„ç»“æœã€‚å¯¹äºè¾ƒå¤§çš„æ•°æ®é›†ï¼Œæœ€ä½³åˆ†è¾¨ç‡é€šå¸¸ä¼šå¢åŠ  pbmc &lt;- FindNeighbors(pbmc, dims = 1:10) pbmc &lt;- FindClusters(pbmc, resolution = 0.5) ## Modularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck ## ## Number of nodes: 2638 ## Number of edges: 95927 ## ## Running Louvain algorithm... ## Maximum modularity in 10 random starts: 0.8728 ## Number of communities: 9 ## Elapsed time: 0 seconds # Look at cluster IDs of the first 5 cells head(Idents(pbmc), 5) ## AAACATACAACCAC-1 AAACATTGAGCTAC-1 AAACATTGATCAGC-1 AAACCGTGCTTCCG-1 ## 2 3 2 1 ## AAACCGTGTATGCG-1 ## 6 ## Levels: 0 1 2 3 4 5 6 7 8 éçº¿æ€§é™ç»´UMAP/tSNE Seurat æä¾›äº†å‡ ç§éçº¿æ€§é™ç»´æŠ€æœ¯ï¼Œä¾‹å¦‚ tSNE å’Œ UMAPï¼Œç”¨äºå¯è§†åŒ–å’Œæ¢ç´¢è¿™äº›æ•°æ®é›†ã€‚è¿™äº›ç®—æ³•çš„ç›®æ ‡æ˜¯å­¦ä¹ æ•°æ®é›†ä¸­çš„åº•å±‚ç»“æ„ï¼Œä»¥ä¾¿åœ¨ä½ç»´ç©ºé—´ä¸­å°†ç›¸ä¼¼çš„ç»†èƒæ”¾åœ¨ä¸€èµ·ã€‚å› æ­¤ï¼Œåœ¨ä¸Šè¿°åŸºäºå›¾çš„èšç±»ä¸­è¢«åˆ†ç»„åœ¨ä¸€èµ·çš„ç»†èƒåº”è¯¥åœ¨è¿™äº›é™ç»´å›¾ä¸Šå…±å®šä½ã€‚ pbmc &lt;- RunUMAP(pbmc, dims = 1:10) pbmc &lt;- RunTSNE(pbmc, dims = 1:10) # note that you can set `label = TRUE` or use the LabelClusters function to help label # individual clusters DimPlot(pbmc, reduction = &quot;umap&quot;)| DimPlot(pbmc, reduction = &quot;tsne&quot;) saveRDS(pbmc, file = &quot;../output/pbmc_tutorial.rds&quot;) marker åŸºå›  Seurat å¯ä»¥é€šè¿‡å·®å¼‚è¡¨è¾¾ï¼ˆDEï¼‰å¸®åŠ©ä½ æ‰¾åˆ°å®šä¹‰èšç±»çš„æ ‡å¿—ç‰©ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä¼šè¯†åˆ«ä¸€ä¸ªèšç±»ï¼ˆåœ¨ ident.1ä¸­æŒ‡å®šï¼‰çš„æ­£è´Ÿæ ‡å¿—ç‰©ï¼Œå¹¶å°†å…¶ä¸æ‰€æœ‰å…¶ä»–ç»†èƒè¿›è¡Œæ¯”è¾ƒã€‚FindAllMarkers() å‡½æ•°å¯ä»¥è‡ªåŠ¨å®Œæˆæ‰€æœ‰èšç±»çš„è¿™ä¸ªè¿‡ç¨‹ï¼Œä½†ä½ ä¹Ÿå¯ä»¥æµ‹è¯•èšç±»ç»„ä¹‹é—´çš„å·®å¼‚ï¼Œæˆ–è€…å°†å…¶ä¸æ‰€æœ‰ç»†èƒè¿›è¡Œæ¯”è¾ƒã€‚ # find all markers of cluster 2 cluster2.markers &lt;- FindMarkers(pbmc, ident.1 = 2) head(cluster2.markers, n = 5) ## p_val avg_log2FC pct.1 pct.2 p_val_adj ## IL32 2.892340e-90 1.3070772 0.947 0.465 3.966555e-86 ## LTB 1.060121e-86 1.3312674 0.981 0.643 1.453850e-82 ## CD3D 8.794641e-71 1.0597620 0.922 0.432 1.206097e-66 ## IL7R 3.516098e-68 1.4377848 0.750 0.326 4.821977e-64 ## LDHB 1.642480e-67 0.9911924 0.954 0.614 2.252497e-63 # find all markers distinguishing cluster 5 from clusters 0 and 3 cluster5.markers &lt;- FindMarkers(pbmc, ident.1 = 5, ident.2 = c(0, 3)) head(cluster5.markers, n = 5) ## p_val avg_log2FC pct.1 pct.2 p_val_adj ## FCGR3A 8.246578e-205 6.794969 0.975 0.040 1.130936e-200 ## IFITM3 1.677613e-195 6.192558 0.975 0.049 2.300678e-191 ## CFD 2.401156e-193 6.015172 0.938 0.038 3.292945e-189 ## CD68 2.900384e-191 5.530330 0.926 0.035 3.977587e-187 ## RP11-290F20.3 2.513244e-186 6.297999 0.840 0.017 3.446663e-182 # find markers for every cluster compared to all remaining cells, report only the positive # ones pbmc.markers &lt;- FindAllMarkers(pbmc, only.pos = TRUE) pbmc.markers %&gt;% group_by(cluster) %&gt;% dplyr::filter(avg_log2FC &gt; 1) ## # A tibble: 7,019 Ã— 7 ## # Groups: cluster [9] ## p_val avg_log2FC pct.1 pct.2 p_val_adj cluster gene ## &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt; &lt;chr&gt; ## 1 3.75e-112 1.21 0.912 0.592 5.14e-108 0 LDHB ## 2 9.57e- 88 2.40 0.447 0.108 1.31e- 83 0 CCR7 ## 3 1.15e- 76 1.06 0.845 0.406 1.58e- 72 0 CD3D ## 4 1.12e- 54 1.04 0.731 0.4 1.54e- 50 0 CD3E ## 5 1.35e- 51 2.14 0.342 0.103 1.86e- 47 0 LEF1 ## 6 1.94e- 47 1.20 0.629 0.359 2.66e- 43 0 NOSIP ## 7 2.81e- 44 1.53 0.443 0.185 3.85e- 40 0 PIK3IP1 ## 8 6.27e- 43 1.99 0.33 0.112 8.60e- 39 0 PRKCQ-AS1 ## 9 1.16e- 40 2.70 0.2 0.04 1.59e- 36 0 FHIT ## 10 1.34e- 34 1.96 0.268 0.087 1.84e- 30 0 MAL ## # â„¹ 7,009 more rows Seurat æœ‰å‡ ç§ç”¨äºå·®å¼‚è¡¨è¾¾åˆ†æçš„æµ‹è¯•æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡ test.use å‚æ•°è¿›è¡Œè®¾ç½®ã€‚ä¾‹å¦‚ï¼ŒROCæµ‹è¯•ä¼šè¿”å›ä»»ä½•å•ä¸ªæ ‡å¿—ç‰©çš„â€œåˆ†ç±»èƒ½åŠ›â€ï¼ˆèŒƒå›´ä»0è¡¨ç¤ºéšæœºï¼Œåˆ°1è¡¨ç¤ºå®Œç¾ï¼‰ã€‚ cluster0.markers &lt;- FindMarkers(pbmc, ident.1 = 0, logfc.threshold = 0.25, test.use = &quot;roc&quot;, only.pos = TRUE) ğŸŒŸå¯è§†åŒ–markeråŸºå›  VlnPlot(pbmc, features = c(&quot;MS4A1&quot;, &quot;CD79A&quot;)) # you can plot raw counts as well VlnPlot(pbmc, features = c(&quot;NKG7&quot;, &quot;PF4&quot;), slot = &quot;counts&quot;, log = TRUE) FeaturePlot(pbmc, features = c(&quot;MS4A1&quot;, &quot;GNLY&quot;, &quot;CD3E&quot;, &quot;CD14&quot;, &quot;FCER1A&quot;, &quot;FCGR3A&quot;, &quot;LYZ&quot;, &quot;PPBP&quot;, &quot;CD8A&quot;)) DoHeatmap() å‡½æ•°ä¸ºç»™å®šçš„ç»†èƒå’Œç‰¹å¾ç”Ÿæˆä¸€ä¸ªè¡¨è¾¾çƒ­å›¾ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç»˜åˆ¶äº†æ¯ä¸ªç°‡çš„å‰10ä¸ªæ ‡å¿—ç‰©ï¼ˆå¦‚æœæ ‡å¿—ç‰©å°‘äº20ä¸ªï¼Œåˆ™ç»˜åˆ¶æ‰€æœ‰æ ‡å¿—ç‰©ï¼‰ã€‚ pbmc.markers %&gt;% group_by(cluster) %&gt;% # æŒ‰ç°‡ï¼ˆclusterï¼‰åˆ†ç»„ dplyr::filter(avg_log2FC &gt; 1) %&gt;% # ç­›é€‰å‡ºå¹³å‡å¯¹æ•°2å€å˜åŒ–ï¼ˆavg_log2FCï¼‰å¤§äº1çš„åŸºå› ã€‚ slice_head(n = 10) %&gt;% # ä¿ç•™æ¯ä¸ªç°‡çš„å‰10ä¸ªåŸºå›  ungroup() -&gt; top10 # è§£é™¤åˆ†ç»„ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åˆ°`top10`å˜é‡ä¸­ DoHeatmap(pbmc, features = top10$gene) + NoLegend() pbmc.markers %&gt;% group_by(cluster) %&gt;% # æŒ‰ç°‡ï¼ˆclusterï¼‰åˆ†ç»„ dplyr::filter(avg_log2FC &gt; 1) %&gt;% # ç­›é€‰å‡ºå¹³å‡å¯¹æ•°2å€å˜åŒ–ï¼ˆavg_log2FCï¼‰å¤§äº1çš„åŸºå› ã€‚ slice_head(n = 10) %&gt;% # ä¿ç•™æ¯ä¸ªç°‡çš„å‰10ä¸ªåŸºå›  ungroup() -&gt; top10 # è§£é™¤åˆ†ç»„ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åˆ°`top10`å˜é‡ä¸­ RidgePlot(pbmc, features = top10$gene[1:6]) äºšç¾¤å‘½å new.cluster.ids &lt;- c(&quot;Naive CD4 T&quot;, &quot;CD14+ Mono&quot;, &quot;Memory CD4 T&quot;, &quot;B&quot;, &quot;CD8 T&quot;, &quot;FCGR3A+ Mono&quot;, &quot;NK&quot;, &quot;DC&quot;, &quot;Platelet&quot;) names(new.cluster.ids) &lt;- levels(pbmc) pbmc &lt;- RenameIdents(pbmc, new.cluster.ids) DimPlot(pbmc, reduction = &quot;umap&quot;, label = TRUE, pt.size = 0.5) + NoLegend() saveRDS(pbmc, file = &quot;../output/pbmc3k_final.rds&quot;) "],["å¤šæ ·æœ¬åˆ†æ.html", "ç¬¬ 5 ç«  å¤šæ ·æœ¬åˆ†æ åŠ è½½åŒ… åˆ›å»ºå¤šæ ·æœ¬Seuratå¯¹è±¡ è´¨æ§ harmonyæµç¨‹ marker åŸºå›  äºšç¾¤å‘½å", " ç¬¬ 5 ç«  å¤šæ ·æœ¬åˆ†æ åŠ è½½åŒ… library(COSG) library(harmony) library(ggsci) library(future) library(Seurat) library(clustree) library(cowplot) library(data.table) library(patchwork) library(stringr) library(SingleR) library(tidyverse) library(tidydr) åˆ›å»ºå¤šæ ·æœ¬Seuratå¯¹è±¡ ä¸åŒäºå•æ ·æœ¬åˆ†æï¼Œå¤šæ ·æœ¬åˆ†æéœ€è¦å°†å¤šä¸ªæ ·æœ¬æ•´åˆåˆ°ä¸€ä¸ªSeuratå¯¹è±¡ä¸­ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨lapplyå‡½æ•°ï¼Œå°†å¤šä¸ªæ ·æœ¬çš„æ•°æ®è¯»å–å¹¶æ•´åˆåˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­ã€‚è¿›è€Œåˆ›å»ºSearutå¯¹è±¡ã€‚ dir=&quot;data/multi-samples/outputs&quot; samples=list.files(dir) samples ## [1] &quot;GSM4888887_CTRL1&quot; &quot;GSM4888888_CTRL2&quot; &quot;GSM4888891_AD1&quot; &quot;GSM4888892_AD2&quot; ## [5] &quot;GSM4888895_PD1&quot; &quot;GSM4888896_PD2&quot; sceList = lapply(samples,function(pro){ #pro=samples[1] print(pro) tmp = Read10X(file.path(dir, pro)) if(length(tmp)==2){ ct = tmp[[1]] }else{ct = tmp} sce =CreateSeuratObject(counts = ct , project = pro , min.cells = 5, min.features = 300 ) return(sce) }) ## [1] &quot;GSM4888887_CTRL1&quot; ## [1] &quot;GSM4888888_CTRL2&quot; ## [1] &quot;GSM4888891_AD1&quot; ## [1] &quot;GSM4888892_AD2&quot; ## [1] &quot;GSM4888895_PD1&quot; ## [1] &quot;GSM4888896_PD2&quot; sce.all=merge(x=sceList[[1]], y=sceList[ -1 ], add.cell.ids = samples) # æ¯ä¸ªç»†èƒçš„åç§°å‰éƒ½ä¼šæ·»åŠ ä¸€ä¸ªæ ·æœ¬æ ‡è¯†ç¬¦å‰ç¼€ sce.all &lt;- JoinLayers(sce.all) # æ·»åŠ åˆ†ç»„ä¿¡æ¯ phe=str_split(colnames(sce.all),&#39;[_-]&#39;,simplify = T) phe[1:5,] ## [,1] [,2] [,3] [,4] ## [1,] &quot;GSM4888887&quot; &quot;CTRL1&quot; &quot;AAACCCAAGACGTCCC&quot; &quot;1&quot; ## [2,] &quot;GSM4888887&quot; &quot;CTRL1&quot; &quot;AAACCCAAGGGCCTCT&quot; &quot;1&quot; ## [3,] &quot;GSM4888887&quot; &quot;CTRL1&quot; &quot;AAACCCACAGGTATGG&quot; &quot;1&quot; ## [4,] &quot;GSM4888887&quot; &quot;CTRL1&quot; &quot;AAACCCAGTCTTGAAC&quot; &quot;1&quot; ## [5,] &quot;GSM4888887&quot; &quot;CTRL1&quot; &quot;AAACCCATCAAGCTGT&quot; &quot;1&quot; sce.all$group = phe[,1] table(sce.all@meta.data$group) ## ## GSM4888887 GSM4888888 GSM4888891 GSM4888892 GSM4888895 GSM4888896 ## 4605 2184 2503 4167 2095 5333 table(sce.all@meta.data$orig.ident) ## ## GSM4888887_CTRL1 GSM4888888_CTRL2 GSM4888891_AD1 GSM4888892_AD2 ## 4605 2184 2503 4167 ## GSM4888895_PD1 GSM4888896_PD2 ## 2095 5333 è´¨æ§ ç¬¬ä¸€æ­¥æˆ‘ä»¬å…ˆè®¡ç®—å…³æ³¨çš„æŒ‡æ ‡ #è®¡ç®—çº¿ç²’ä½“åŸºå› æ¯”ä¾‹ mito_genes=rownames(sce.all)[grep(&quot;^MT-&quot;, rownames(sce.all),ignore.case = T)] print(mito_genes) #å¯èƒ½æ˜¯13ä¸ªçº¿ç²’ä½“åŸºå›  ## [1] &quot;MT-TF&quot; &quot;MT-RNR1&quot; &quot;MT-TV&quot; &quot;MT-RNR2&quot; &quot;MT-ND1&quot; &quot;MT-TI&quot; &quot;MT-TM&quot; ## [8] &quot;MT-ND2&quot; &quot;MT-CO1&quot; &quot;MT-CO2&quot; &quot;MT-TK&quot; &quot;MT-ATP8&quot; &quot;MT-ATP6&quot; &quot;MT-CO3&quot; ## [15] &quot;MT-ND3&quot; &quot;MT-ND4L&quot; &quot;MT-ND4&quot; &quot;MT-TH&quot; &quot;MT-ND5&quot; &quot;MT-ND6&quot; &quot;MT-CYB&quot; ## [22] &quot;MT-TP&quot; &quot;MT-TL1&quot; &quot;MT-TD&quot; &quot;MT-TG&quot; sce.all=PercentageFeatureSet(sce.all, features = mito_genes, col.name = &quot;percent_mito&quot;) fivenum(sce.all@meta.data$percent_mito) ## [1] 0.0000000 0.3938158 0.9076559 2.4844720 86.9161677 #è®¡ç®—æ ¸ç³–ä½“åŸºå› æ¯”ä¾‹ ribo_genes=rownames(sce.all)[grep(&quot;^Rp[sl]&quot;, rownames(sce.all),ignore.case = T)] print(ribo_genes[1:10]) ## [1] &quot;RPL22&quot; &quot;RPL11&quot; &quot;RPS6KA1&quot; &quot;RPS8&quot; &quot;RPS15AP11&quot; &quot;RPS13P2&quot; ## [7] &quot;RPL21P23&quot; &quot;RPL31P12&quot; &quot;RPL5&quot; &quot;RPL7P9&quot; sce.all=PercentageFeatureSet(sce.all, features = ribo_genes, col.name = &quot;percent_ribo&quot;) fivenum(sce.all@meta.data$percent_ribo) ## [1] 0.0000000 0.3896445 0.6633781 1.3927122 14.5989305 #è®¡ç®—çº¢è¡€ç»†èƒåŸºå› æ¯”ä¾‹ Hb_genes=rownames(sce.all)[grep(&quot;^Hb[^(p)]&quot;, rownames(sce.all),ignore.case = T)] print(Hb_genes) ## [1] &quot;HBEGF&quot; &quot;HBS1L&quot; &quot;HBB&quot; &quot;HBG2&quot; &quot;HBM&quot; &quot;HBA2&quot; &quot;HBA1&quot; &quot;HBQ1&quot; sce.all=PercentageFeatureSet(sce.all, features = Hb_genes,col.name = &quot;percent_hb&quot;) fivenum(sce.all@meta.data$percent_hb) ## [1] 0.00000000 0.00000000 0.00000000 0.01954031 28.35028077 è¿‡æ»¤å‰å¯è§†åŒ– #å¯è§†åŒ–ç»†èƒçš„ä¸Šè¿°æ¯”ä¾‹æƒ…å†µ feats &lt;- c(&quot;nFeature_RNA&quot;, &quot;nCount_RNA&quot;) p1=VlnPlot(sce.all, group.by = &quot;orig.ident&quot;, features = feats, pt.size = 0, ncol = 2) + NoLegend() p1 feats &lt;- c(&quot;percent_mito&quot;, &quot;percent_ribo&quot;, &quot;percent_hb&quot;) p2=VlnPlot(sce.all, group.by = &quot;orig.ident&quot;, features = feats, pt.size = 0, ncol = 3, same.y.lims=T) + scale_y_continuous(breaks=seq(0, 100, 5)) + NoLegend() p2 p3=FeatureScatter(sce.all, &quot;nCount_RNA&quot;, &quot;nFeature_RNA&quot;, group.by = &quot;orig.ident&quot;, pt.size = 0.5) p3 å¼€å§‹è¿‡æ»¤ # æ ¹æ®ä¸Šè¿°æŒ‡æ ‡ï¼Œè¿‡æ»¤ä½è´¨é‡ç»†èƒ/åŸºå›  # è¿‡æ»¤æŒ‡æ ‡1:æœ€å°‘è¡¨è¾¾åŸºå› æ•°çš„ç»†èƒ&amp;æœ€å°‘è¡¨è¾¾ç»†èƒæ•°çš„åŸºå›  # ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨`CreateSeuratObject`çš„æ—¶å€™å·²ç»æ˜¯è¿›è¡Œäº†è¿™ä¸ªè¿‡æ»¤æ“ä½œ # å¦‚æœåæœŸçœ‹åˆ°äº†è‡ªå·±çš„å•ç»†èƒé™ç»´èšç±»åˆ†ç¾¤ç»“æœå¾ˆè¯¡å¼‚ï¼Œå°±å¯ä»¥å›è¿‡å¤´æ¥çœ‹è´¨é‡æ§åˆ¶ç¯èŠ‚ # å…ˆèµ°é»˜è®¤æµç¨‹å³å¯ if(F){ selected_c &lt;- WhichCells(sce.all, expression = nFeature_RNA &gt; 500) selected_f &lt;- rownames(sce.all)[Matrix::rowSums(sce.all@assays$RNA$counts &gt; 0 ) &gt; 3] sce.all &lt;- subset(sce.all, features = selected_f, cells = selected_c) } #è¿‡æ»¤æŒ‡æ ‡2:çº¿ç²’ä½“/æ ¸ç³–ä½“åŸºå› æ¯”ä¾‹(æ ¹æ®ä¸Šé¢çš„violinå›¾) selected_mito &lt;- WhichCells(sce.all, expression = percent_mito &lt; 25);length(selected_mito) ## [1] 20269 selected_ribo &lt;- WhichCells(sce.all, expression = percent_ribo &gt; 3);length(selected_ribo) ## [1] 1386 selected_hb &lt;- WhichCells(sce.all, expression = percent_hb &lt; 1 );length(selected_hb) ## [1] 20876 sce.all &lt;- subset(sce.all, cells = selected_mito) # sce.all.filt &lt;- subset(sce.all.filt, cells = selected_ribo) # sce.all.filt &lt;- subset(sce.all.filt, cells = selected_hb) dim(sce.all) ## [1] 28985 20269 è¿‡æ»¤åå¯è§†åŒ– #å¯è§†åŒ–è¿‡æ»¤åçš„æƒ…å†µ feats &lt;- c(&quot;nFeature_RNA&quot;, &quot;nCount_RNA&quot;) p1_filtered=VlnPlot(sce.all, group.by = &quot;orig.ident&quot;, features = feats, pt.size = 0, ncol = 2) + NoLegend() p1_filtered feats &lt;- c(&quot;percent_mito&quot;, &quot;percent_ribo&quot;, &quot;percent_hb&quot;) p2_filtered=VlnPlot(sce.all, group.by = &quot;orig.ident&quot;, features = feats, pt.size = 0, ncol = 3) + NoLegend() p2_filtered harmonyæµç¨‹ sce.all &lt;- NormalizeData(sce.all, normalization.method = &quot;LogNormalize&quot;, scale.factor = 1e4) sce.all &lt;- FindVariableFeatures(sce.all) sce.all &lt;- ScaleData(sce.all) sce.all &lt;- RunPCA(sce.all, features = VariableFeatures(object = sce.all)) sce.all &lt;- RunHarmony(sce.all, &quot;orig.ident&quot;) sce.all &lt;- RunUMAP(sce.all, dims = 1:15, reduction = &quot;harmony&quot;) # sce.all &lt;- RunTSNE(sce.all, dims = 1:15, # reduction = &quot;harmony&quot;) names(sce.all@reductions) ## [1] &quot;pca&quot; &quot;harmony&quot; &quot;umap&quot; harmonyä½¿ç”¨å‰ååŒºåˆ« seuratObj &lt;- RunUMAP(sce.all, dims = 1:15, reduction = &quot;pca&quot;) DimPlot(seuratObj, reduction = &quot;umap&quot;, group.by = &quot;orig.ident&quot;) + ggtitle(&quot;harmony_before&quot;)| # æœªä½¿ç”¨harmony DimPlot(sce.all, reduction = &quot;umap&quot;, group.by = &quot;orig.ident&quot;) + ggtitle(&quot;harmony_later&quot;) # ä½¿ç”¨harmony sce.all &lt;- FindNeighbors(sce.all, reduction = &quot;harmony&quot;, dims = 1:15) è®¾ç½®ä¸åŒçš„åˆ†è¾¨ç‡ï¼Œè§‚å¯Ÿåˆ†ç¾¤æ•ˆæœï¼Œè¿›è€Œé€‰æ‹©æœ€ä½³åˆ†è¾¨ç‡ apply(sce.all@meta.data[,grep(&quot;RNA_snn&quot;,colnames(sce.all@meta.data))],2,table) ## $RNA_snn_res.0.01 ## ## 0 1 2 3 4 5 6 ## 6970 6138 3145 1294 1154 833 735 ## ## $RNA_snn_res.0.05 ## ## 0 1 2 3 4 5 6 7 8 9 ## 6834 5722 3145 1293 1154 834 735 358 137 57 ## ## $RNA_snn_res.0.1 ## ## 0 1 10 2 3 4 5 6 7 8 9 ## 6832 4922 57 3145 1295 1154 834 800 735 358 137 ## ## $RNA_snn_res.0.2 ## ## 0 1 10 11 2 3 4 5 6 7 8 9 ## 6550 4791 57 22 3121 1294 1216 1154 834 735 358 137 ## ## $RNA_snn_res.0.3 ## ## 0 1 10 11 12 2 3 4 5 6 7 8 9 ## 6548 4768 137 83 22 2533 1293 1153 928 877 834 735 358 ## ## $RNA_snn_res.0.5 ## ## 0 1 10 11 12 13 14 15 16 17 18 2 3 4 5 6 ## 6057 4427 522 358 259 236 166 135 67 57 22 2536 1225 1128 740 599 ## 7 8 9 ## 582 580 573 ## ## $RNA_snn_res.0.8 ## ## 0 1 10 11 12 13 14 15 16 17 18 19 2 20 21 22 ## 3590 2144 569 553 522 397 285 266 265 254 225 213 2122 183 158 135 ## 23 24 25 26 3 4 5 6 7 8 9 ## 123 92 83 67 2062 2006 1225 801 740 605 584 ## ## $RNA_snn_res.1 ## ## 0 1 10 11 12 13 14 15 16 17 18 19 2 20 21 22 ## 3325 2170 584 574 569 513 386 266 256 236 213 185 2114 163 136 135 ## 23 24 25 3 4 5 6 7 8 9 ## 114 92 83 2043 1962 1179 827 797 735 612 p1_dim=plot_grid(ncol = 3, DimPlot(sce.all, reduction = &quot;umap&quot;, group.by = &quot;RNA_snn_res.0.01&quot;) + ggtitle(&quot;louvain_0.01&quot;), DimPlot(sce.all, reduction = &quot;umap&quot;, group.by = &quot;RNA_snn_res.0.5&quot;) + ggtitle(&quot;louvain_0.05&quot;), DimPlot(sce.all, reduction = &quot;umap&quot;, group.by = &quot;RNA_snn_res.0.1&quot;) + ggtitle(&quot;louvain_0.1&quot;), DimPlot(sce.all, reduction = &quot;umap&quot;, group.by = &quot;RNA_snn_res.0.2&quot;) + ggtitle(&quot;louvain_0.2&quot;), DimPlot(sce.all, reduction = &quot;umap&quot;, group.by = &quot;RNA_snn_res.0.3&quot;) + ggtitle(&quot;louvain_0.3&quot;), DimPlot(sce.all, reduction = &quot;umap&quot;, group.by = &quot;RNA_snn_res.0.5&quot;) + ggtitle(&quot;louvain_0.5&quot;), DimPlot(sce.all, reduction = &quot;umap&quot;, group.by = &quot;RNA_snn_res.0.8&quot;) + ggtitle(&quot;louvain_0.8&quot;), DimPlot(sce.all, reduction = &quot;umap&quot;, group.by = &quot;RNA_snn_res.1&quot;) + ggtitle(&quot;louvain_1&quot;));p1_dim p2_tree=clustree(sce.all@meta.data, prefix = &quot;RNA_snn_res.&quot;);p2_tree marker åŸºå›  é€‰æ‹©éœ€è¦çš„é˜ˆå€¼ï¼Œå¯è§†åŒ–ä¸€äº›markeråŸºå› è¾…åŠ©åç»­çš„å•ç»†èƒäºšç¾¤å®šä¹‰ è¿™é‡Œç›´æ¥é€‰0.8 sel.clust = &quot;RNA_snn_res.0.8&quot; sce.all &lt;- SetIdent(sce.all, value = sel.clust) table(sce.all@active.ident) ## ## 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 ## 3590 2144 2122 2062 2006 1225 801 740 605 584 569 553 522 397 285 266 ## 16 17 18 19 20 21 22 23 24 25 26 ## 265 254 225 213 183 158 135 123 92 83 67 å¯ä»¥æ ¹æ®ç»éªŒæ„å»ºè‡ªå·±çš„æ³¨é‡Šé›†åˆï¼ˆå¯é€‰ï¼‰ gastric_cancer_markers = c(&#39;PTPRC&#39;, &#39;MUC2&#39; , &#39;ITLN1&#39;, &#39;FABP1&#39; , &#39;APOA1&#39;, &#39;CEACAM5&#39; , &#39;CEACAM6&#39;, &#39;EPCAM&#39;, &#39;KRT18&#39;, &#39;MUC1&#39;, &#39;MUC6&#39; , &#39;TFF2&#39;, &#39;PGA4&#39; , &#39;PGA3&#39;, &#39;MUC5AC&#39; , &#39;TFF1&#39;,&#39;CHGA&#39; , &#39;CHGB&#39;) Myo=c(&quot;Krt17&quot;, &quot;Krt14&quot;, &quot;Krt5&quot;, &quot;Acta2&quot;, &quot;Myl9&quot;, &quot;Mylk&quot;, &quot;Myh11&quot;) Lum=c(&quot;Krt19&quot;, &quot;Krt18&quot;, &quot;Krt8&quot;) Hs=c(&quot;Prlr&quot;, &quot;Cited1&quot;, &quot;Pgr&quot;, &quot;Prom1&quot;, &quot;Esr1&quot;) AV=c(&quot;Mfge8&quot;, &quot;Trf&quot;, &quot;Csn3&quot;, &quot;Wfdc18&quot;, &quot;Elf5&quot;, &quot;Ltf&quot;) Lp=c(&quot;Kit&quot;, &quot;Aldh1a3&quot;, &quot;Cd14&quot;) Fib=c(&quot;Col1a1&quot;, &quot;Col1a2&quot;, &quot;Col3a1&quot;, &quot;Fn1&quot;) GSE150580_breast_cancer_markers_list =list( Myo=Myo, Lum=Lum, Hs=Hs, AV=AV, Lp=Lp, Fib=Fib ) macrophages=c(&#39;Adgre1&#39;, &#39;Cd14&#39;, &#39;Fcgr3&#39;) cDCs=c(&#39;Xcr1&#39;, &#39;Flt3&#39;, &#39;Ccr7&#39;) pDCs=c(&#39;Siglech&#39;, &#39;Clec10a&#39;, &#39;Clec12a&#39;) monocytes=c(&#39;Ly6c2&#39; , &#39;Spn&#39;) neutrophils=c(&#39;Csf3r&#39;, &#39;S100a8&#39;, &#39;Cxcl3&#39;) SCP1661_meyloids_markers_list =list( macrophages=macrophages, cDCs=cDCs, pDCs=pDCs, monocytes=monocytes, neutrophils=neutrophils ) lung_epi_markers = c(&#39;TPPP3&#39;,&quot;SPRR3&quot;,&quot;GDPD3&quot;,&quot;SPRR1A&quot;,&quot;SPRR2A&quot;,&quot;RARRES2&quot;,&quot;TMPRSS11E&quot;, &quot;ASCL3&quot;,&quot;CFTR&quot;,&quot;FOXI2&quot;,&quot;1SG20&quot;,&quot;FOXI1&quot;, &quot;SAA4&quot;,&quot;SAA2&quot;,&quot;EFHC1&quot;,&quot;CCDC153&quot;,&quot;CCDC113&quot;,&quot;SAA1&quot;,&quot;CDC20B&quot;,&quot;FOXJ1&quot;, &quot;MYCL&quot;,&quot;FOXN4&quot;,&quot;CCNO&quot;, &quot;PIGR&quot;,&quot;BP1&quot;,&quot;MUC5A&quot;,&quot;VMO1&quot;,&quot;SCGB3A1&quot;,&quot;CYP2A13&quot;,&quot;CYP2B6&quot;,&quot;SCGB1A1&quot;, &quot;BCAM&quot;,&quot;KRT15&quot;,&quot;KRT5&quot;,&quot;TP63&quot;) myeloids_markers_list1 =list( CM=c(&quot;TTN&quot;,&quot;MYH7&quot;,&quot;MYH6&quot;,&quot;TNNT2&quot;) , EC=c(&quot;VWF&quot;, &quot;IFI27&quot;, &quot;PECAM1&quot;,&quot;MGP&quot;), FB=c(&quot;DCN&quot;, &quot;C7&quot; ,&quot;LUM&quot;,&quot;FBLN1&quot;,&quot;COL1A2&quot;), MP=c(&quot;CD163&quot;, &quot;CCL4&quot;, &quot;CXCL8&quot;,&quot;PTPRC&quot;), SMC=c(&quot;ACTA2&quot;, &quot;CALD1&quot;, &quot;MYH11&quot;), Tc=c(&quot;CD3D&quot;,&quot;CD3E&quot;), DC1 = c( &#39;Clec9a&#39;, &#39;Xcr1&#39;, &#39;Wdfy4&#39;), DC2 = c(&#39;Itgax&#39;, &#39;Sirpa&#39;, &#39;Cd209a&#39;), mregDCs= c(&#39;Ccr7&#39;, &#39;Cd80&#39;, &#39;Cd200&#39;, &#39;Cd247&#39;) , hypoxia=c(&#39;Hif1a&#39;, &#39;Slc2a1&#39;, &#39;Vegfa&#39;, &#39;Hmox1&#39;, &#39;Bnip3&#39;, &#39;Nos2&#39;, &#39;Mmp2&#39;, &#39;Sod3&#39;, &#39;Cited2&#39;, &#39;Ldha&#39;), peric=c(&quot;ABCC9&quot;,&quot;PDGFRB&quot;,&quot;RGS5&quot;) ) myeloids_markers_list2 = list(pDC = c(&quot;CLEC4C&quot;,&quot;IRF7&quot;,&quot;TCF4&quot;,&quot;GZMB&quot;), cDC1 = c(&quot;XCR1&quot;,&quot;CLNK&quot;,&quot;CLEC9A&quot;), cDC2 = c(&quot;FCER1A&quot;,&quot;HLA-DPB1&quot;,&quot;HLA-DQB1&quot;,&quot;CD1E&quot;,&quot;CD1C&quot;,&quot;CLEC10A&quot;,&quot;HLA-DQA2&quot;), DC3 = c(&quot;CCL19&quot;,&quot;LAMP3&quot;,&quot;IDO1&quot;,&quot;IDO2&quot;,&quot;LAD1&quot;,&quot;FSCN1&quot;,&quot;CCR7&quot;,&quot;LY75&quot;,&quot;CCL22&quot;,&quot;CD40&quot;,&quot;BIRC3&quot;,&quot;NFKB2&quot;), Macrophages = c(&quot;APOC1&quot;,&quot;HLA-DRB5&quot;,&quot;C1QA&quot;,&quot;C1QB&quot;), RTMs = c(&quot;THBS1&quot;),#Resident tissue macrophages Lam = c(&quot;APOE&quot;),#Lipid associated macrophages Monocytes = c(&quot;LYZ&quot;,&quot;HLA-DRB1&quot;,&quot;TIMP1&quot;,&quot;S100A11&quot;,&quot;CXCL8&quot;,&quot;IL1B&quot;,&quot;PTGS2&quot;,&quot;S100A9&quot;,&quot;S100A8&quot;,&quot;MMP19&quot;), Mono_C = c(&#39;CD14&#39;),#Mono_CD14 Mono_F = c(&#39;FCGR3A&#39;),#Mono_FCGR3A Mast = c(&#39;TPSAB1&#39; , &#39;TPSB2&#39;)) Tcells_markers = c(&#39;PTPRC&#39;, &#39;CD3D&#39;, &#39;CD3E&#39;, &#39;CD4&#39;,&#39;CD8A&#39;, &#39;CCR7&#39;, &#39;SELL&#39; , &#39;TCF7&#39;,&#39;CXCR6&#39; , &#39;ITGA1&#39;, &#39;FOXP3&#39;, &#39;IL2RA&#39;, &#39;CTLA4&#39;,&#39;GZMB&#39;, &#39;GZMK&#39;,&#39;CCL5&#39;, &#39;IFNG&#39;, &#39;CCL4&#39;, &#39;CCL3&#39; , &#39;PRF1&#39; , &#39;NKG7&#39;) # CD4T CD4_markers_list =list( Tc=c(&quot;CD3D&quot;,&quot;CD3E&quot;), CD4=c(&quot;CD4&quot; ), Treg=c(&quot;TNFRSF4&quot;,&quot;BATF&quot;,&quot;TNFRSF18&quot;,&quot;FOXP3&quot;,&quot;IL2RA&quot;,&quot;IKZF2&quot;), naive=c(&quot;CCR7&quot;,&quot;SELL&quot;,&quot;CD5&quot;), Tfh=c(&quot;CXCR5&quot;,&quot;BCL6&quot;,&quot;ICA1&quot;,&quot;TOX&quot;,&quot;TOX2&quot;,&quot;IL6ST&quot;),#æ»¤æ³¡è¾…åŠ©æ€§Tç»†èƒ ILC=c(&quot;TNFRSF25&quot;,&quot;KRT81&quot;,&quot;LST1&quot;,&quot;AREG&quot;,&quot;LTB&quot;,&quot;CD69&quot;) ) # CD8T CD8_markers_list1 =list( CD8=c(&quot;CD8A&quot;,&quot;CD8B&quot;), TN_TCM=c(&quot;CCR7&quot;,&quot;SELL&quot;,&quot;TCF7&quot;,&quot;LEF1&quot;), TEM=c(&quot;GZMK&quot; ), TEFF=c(&quot;TBX21&quot;,&quot;FCGR3A&quot;,&quot;FGFBP2&quot;), TRM=c(&quot;XCL1&quot;,&quot;XCL2&quot;,&quot;ITGAE&quot;,&quot;CD69&quot;), IEL_T = c(&quot;TMIGD2&quot;), yT1c=c(&quot;GNLY&quot;,&quot;PTGDS&quot;,&quot;GZMB&quot;,&quot;TRDC&quot;), yT2c=c(&quot;TMN1&quot;,&quot;HMGB2&quot;,&quot;TYMS&quot;), MAIT_T = c(&quot;SLC4A10&quot;) ) CD8_markers_list2 =list( CD8T=c(&quot;CD8A&quot;,&quot;CD8B&quot;), MAIT=c(&quot;ZBTB16&quot;,&quot;NCR3&quot;,&quot;RORA&quot;), ExhaustedCD8T=c(&quot;LAG3&quot;,&quot;TIGIT&quot;,&quot;PDCD1&quot;,&quot;HAVCR2&quot;,&quot;CTLA4&quot;), EffMemoryCD8=c(&quot;EOMES&quot;,&quot;ITM2C&quot;), Resting_NK=c(&quot;XCL1&quot;,&quot;XCL2&quot;,&quot;KLRC1&quot;), Cytotoxic_NK=c(&quot;CX3CR1&quot;,&quot;FGFBP2&quot;,&quot;FCGR3A&quot;,&quot;KLRD1&quot;), Pre_exhausted=c(&quot;IFNG&quot;,&quot;PRF1&quot;,&quot;GNLY&quot;,&quot;GZMA&quot;,&quot;NKG7&quot;,&quot;GZMK&quot;) ) cd4_and_cd8T_markers_list =list( naive=c(&quot;CCR7&quot;,&quot;SELL&quot;,&quot;TCF7&quot;,&quot;IL7R&quot;,&quot;CD27&quot;,&quot;CD28&quot;,&quot;LEF1&quot;,&quot;S1PR1&quot;), CD8Trm=c(&quot;XCL1&quot;,&quot;XCL2&quot;,&quot;MYADM&quot;), NKTc=c(&quot;GNLY&quot;,&quot;GZMA&quot;), Tfh=c(&quot;CXCR5&quot;,&quot;BCL6&quot;,&quot;ICA1&quot;,&quot;TOX&quot;,&quot;TOX2&quot;,&quot;IL6ST&quot;), th17=c(&quot;IL17A&quot;,&quot;KLRB1&quot;,&quot;CCL20&quot;,&quot;ANKRD28&quot;,&quot;IL23R&quot;,&quot;RORC&quot;,&quot;FURIN&quot;,&quot;CCR6&quot;,&quot;CAPG&quot;,&quot;IL22&quot;), CD8Tem=c(&quot;CXCR4&quot;,&quot;GZMH&quot;,&quot;CD44&quot;,&quot;GZMK&quot;), Treg=c(&quot;FOXP3&quot;,&quot;IL2RA&quot;,&quot;TNFRSF18&quot;,&quot;IKZF2&quot;), naive=c(&quot;CCR7&quot;,&quot;SELL&quot;,&quot;TCF7&quot;,&quot;IL7R&quot;,&quot;CD27&quot;,&quot;CD28&quot;), CD8Trm=c(&quot;XCL1&quot;,&quot;XCL2&quot;,&quot;MYADM&quot;), MAIT=c(&quot;KLRB1&quot;,&quot;ZBTB16&quot;,&quot;NCR3&quot;,&quot;RORA&quot;), yT1c=c(&quot;GNLY&quot;,&quot;PTGDS&quot;,&quot;GZMB&quot;,&quot;TRDC&quot;), yT2c=c(&quot;TMN1&quot;,&quot;HMGB2&quot;,&quot;TYMS&quot;), yt=c(&quot;TRGV9&quot;,&quot;TRDV2&quot;) ) # CD20 (MS4A1)è¡¨è¾¾äºé™¤plasma B ä¹‹å¤–çš„æ‰€æœ‰Bï¼Œå¾ˆå…³é”®çš„åŒºåˆ†naive å’Œplasmaçš„marker # SDC1 = CD138 plasma B ï¼ˆæ¥å—æŠ—åŸï¼Œå¯è¡¨è¾¾æŠ—ä½“ï¼‰ Bcels_markers_list = list( All = c(&#39;MS4A1&#39;,&#39;SDC1&#39;,&#39;CD27&#39;,&#39;CD38&#39;,&#39;CD19&#39;, &#39;CD79A&#39;), GC_B = c(&#39;IL4R&#39;,&#39;TCL1A&#39;,&#39;LRMP&#39;,&#39;SUGCT&#39;), IGA_plasm_B= c ( &#39;IGHA1&#39;), IGG_plasm_B= c ( &#39;IGHG1&#39;) ) Hepatic_stellate_markers_list =list( qHSC=c(&quot;Lrat&quot;,&quot;Ecm1&quot;,&quot;Angptl6&quot;,&quot;Vipr1&quot; ), S1=c(&quot;Ccl2&quot; ,&quot;Cxcl10&quot; ,&quot;Cxcl1&quot; ,&quot;Ccl7&quot; ), S2=c(&quot;Acta2&quot; ,&quot;Tpm1&quot; ,&quot;Vim&quot; ,&quot;Tagln&quot;,&quot;Tnc&quot;,&quot;Tpm2&quot;), S3=c(&quot;Col1a1&quot;,&quot;Col1a2&quot;,&quot;Col3a1&quot; ,&quot;Lox&quot;,&quot;Lum&quot; ) ) # arteries (HEY1, IGFBP3), capillaries (CD36, CA4), veins (ACKR1) and # lymphatic ECs (LECs; CCL21, PROX1). stromal_markers = c(&#39;TEK&#39;,&quot;PTPRC&quot;,&quot;EPCAM&quot;,&quot;PDPN&quot;, &quot;PECAM1&quot;,&#39;PDGFRB&#39;,&quot;PLVAP&quot;,&#39;PROX1&#39;,&#39;ACKR1&#39;,&#39;CA4&#39;,&#39;HEY1&#39;, &#39;CSPG4&#39;,&#39;GJB2&#39;, &#39;RGS5&#39;,&#39;ITGA7&#39;, &#39;ACTA2&#39;,&#39;RBP1&#39;,&#39;CD36&#39;, &#39;ADGRE5&#39;,&#39;COL11A1&#39;,&#39;FGF7&#39;, &#39;MME&#39;) last_markers = c(&#39;PTPRC&#39;, &#39;CD3D&#39;, &#39;CD3E&#39;, &#39;CD4&#39;,&#39;CD8A&#39;, &#39;CD19&#39;, &#39;CD79A&#39;, &#39;MS4A1&#39; , &#39;IGHG1&#39;, &#39;MZB1&#39;, &#39;SDC1&#39;, &#39;CD68&#39;, &#39;CD163&#39;, &#39;CD14&#39;, &#39;TPSAB1&#39; , &#39;TPSB2&#39;, # mast cells, &#39;RCVRN&#39;,&#39;FPR1&#39; , &#39;ITGAM&#39; , &#39;C1QA&#39;, &#39;C1QB&#39;, # mac &#39;S100A9&#39;, &#39;S100A8&#39;, &#39;MMP19&#39;,# monocyte &#39;FCGR3A&#39;, &#39;LAMP3&#39;, &#39;IDO1&#39;,&#39;IDO2&#39;,## DC3 &#39;CD1E&#39;,&#39;CD1C&#39;, # DC2 &#39;KLRB1&#39;,&#39;NCR1&#39;, # NK &#39;FGF7&#39;,&#39;MME&#39;, &#39;ACTA2&#39;, ## human fibo &#39;GJB2&#39;, &#39;RGS5&#39;, &#39;DCN&#39;, &#39;LUM&#39;, &#39;GSN&#39; , ## mouse PDAC fibo &#39;MKI67&#39; , &#39;TOP2A&#39;, &#39;PECAM1&#39;, &#39;VWF&#39;, ## endo &quot;PLVAP&quot;,&#39;PROX1&#39;,&#39;ACKR1&#39;,&#39;CA4&#39;,&#39;HEY1&#39;, &#39;EPCAM&#39; , &#39;KRT19&#39;,&#39;KRT7&#39;, # epi &#39;FYXD2&#39;, &#39;TM4SF4&#39;, &#39;ANXA4&#39;,# cholangiocytes &#39;APOC3&#39;, &#39;FABP1&#39;, &#39;APOA1&#39;, # hepatocytes &#39;Serpina1c&#39;, &#39;PROM1&#39;, &#39;ALDH1A1&#39; ) markers = c(&#39;gastric_cancer_markers&#39;,&#39;lung_epi_markers&#39;, &#39;Tcells_markers&#39;, &#39;stromal_markers&#39;, &#39;last_markers&#39; ) markers_list &lt;- c( &#39;GSE150580_breast_cancer_markers_list&#39; , &#39;SCP1661_meyloids_markers_list&#39; , &#39;myeloids_markers_list1&#39; , &#39;myeloids_markers_list2&#39; , &#39;CD4_markers_list&#39; , &#39;CD8_markers_list1&#39; , &#39;CD8_markers_list2&#39; , &#39;cd4_and_cd8T_markers_list&#39; , &#39;Bcels_markers_list&#39; , &#39;Hepatic_stellate_markers_list&#39; ) è®¾ç½®ç‰©ç§ sp=&#39;human&#39; # human/mouse if(sp == &#39;human&#39;) { # åˆ›å»ºä¸€ä¸ªåˆ—è¡¨æ¥å­˜å‚¨æ‰€æœ‰çš„DotPlotå›¾ plot_list1 &lt;- lapply(markers, function(x) { genes_to_check &lt;- str_to_upper(get(x)) plot1 &lt;- DotPlot(sce.all, features = genes_to_check) + coord_flip() + theme(axis.text.x = element_text(angle = 45, hjust = 1)) # å¦‚æœéœ€è¦ä¿å­˜å›¾å½¢ï¼Œå¯ä»¥å–æ¶ˆæ³¨é‡Šä»¥ä¸‹è¡Œ # h = length(genes_to_check) / 6 + 4 # ggsave(paste(&#39;check_for_&#39;, x, &#39;.pdf&#39;), height = h) return(plot1) # è¿”å›å›¾å½¢å¯¹è±¡ }) plot_list2 &lt;- lapply(markers_list, function(x) { genes_to_check &lt;- lapply(get(x), str_to_upper) dup &lt;- names(table(unlist(genes_to_check)))[table(unlist(genes_to_check)) &gt; 1] genes_to_check &lt;- lapply(genes_to_check, function(x) x[!x %in% dup]) plot2 &lt;- DotPlot(sce.all, features = genes_to_check) + theme(axis.text.x = element_text(angle = 45, hjust = 1)) # å¦‚æœéœ€è¦ä¿å­˜å›¾å½¢ï¼Œå¯ä»¥å–æ¶ˆæ³¨é‡Šä»¥ä¸‹è¡Œ # w = length(unique(unlist(genes_to_check))) / 5 + 7 # ggsave(paste(&#39;check_for_&#39;, x, &#39;.pdf&#39;), width = w) return(plot2) # è¿”å›å›¾å½¢å¯¹è±¡ }) last_markers_to_check &lt;&lt;- str_to_upper(last_markers) # æ‰“å°æ‰€æœ‰çš„å›¾å½¢ plot_grid(plotlist = c(plot_list1, plot_list2), ncol = 3) } else if(sp == &#39;mouse&#39;) { # åˆ›å»ºä¸€ä¸ªåˆ—è¡¨æ¥å­˜å‚¨æ‰€æœ‰çš„DotPlotå›¾ plot_list1 &lt;- lapply(markers, function(x) { genes_to_check &lt;- str_to_title(get(x)) plot1 &lt;- DotPlot(sce.all, features = genes_to_check) + coord_flip() + theme(axis.text.x = element_text(angle = 45, hjust = 1)) # å¦‚æœéœ€è¦ä¿å­˜å›¾å½¢ï¼Œå¯ä»¥å–æ¶ˆæ³¨é‡Šä»¥ä¸‹è¡Œ # h = length(genes_to_check) / 6 + 4 # ggsave(paste(&#39;check_for_&#39;, x, &#39;.pdf&#39;), height = h) return(plot1) # è¿”å›å›¾å½¢å¯¹è±¡ }) plot_list2 &lt;- lapply(markers_list, function(x) { genes_to_check &lt;- lapply(get(x), str_to_title) dup &lt;- names(table(unlist(genes_to_check)))[table(unlist(genes_to_check)) &gt; 1] genes_to_check &lt;- lapply(genes_to_check, function(x) x[!x %in% dup]) plot2 &lt;- DotPlot(sce.all, features = genes_to_check) + theme(axis.text.x = element_text(angle = 45, hjust = 1)) # å¦‚æœéœ€è¦ä¿å­˜å›¾å½¢ï¼Œå¯ä»¥å–æ¶ˆæ³¨é‡Šä»¥ä¸‹è¡Œ # w = length(unique(unlist(genes_to_check))) / 5 + 6 # ggsave(paste(&#39;check_for_&#39;, x, &#39;.pdf&#39;), width = w) return(plot2) # è¿”å›å›¾å½¢å¯¹è±¡ }) last_markers_to_check &lt;&lt;- str_to_title(last_markers) # æ‰“å°æ‰€æœ‰çš„å›¾å½¢ plot_grid(plotlist = c(plot_list1, plot_list2), ncol = 3) } else { print(&#39;we only accept human or mouse&#39;) } DotPlot(sce.all , features = last_markers_to_check ) + coord_flip() + theme(axis.text.x=element_text(angle=45,hjust = 1))| DimPlot(sce.all, reduction = &quot;umap&quot;,raster = F, label = T,repel = T) äºšç¾¤å‘½å æˆ‘ä»¬æ‰¾åˆ°åˆé€‚çš„ marker åŸºå› åå°±å¯ä»¥è¿›ä¸€æ­¥å»å¯è§†åŒ–ï¼ˆæˆ‘çš„ç†è§£æ˜¯æ‹¿è¿™äº›å›¾åœ¨æ–‡ç« ä¸­å±•ç¤ºï¼‰ï¼Œ åˆ¤æ–­å•ç»†èƒäºšç¾¤çš„ç”Ÿç‰©å­¦åå­—ã€‚è¿™é‡Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨å·²ç»å®šä¹‰å¥½çš„åå­—ã€‚ # è¿™é‡Œåªæ˜¯ä¸ºäº†å±•ç¤ºä»£ç ï¼Œå°±æ‹¿0.1åˆ†è¾¨ç‡çš„ç»“æœæ¥å±•ç¤º colnames(sce.all@meta.data) ## [1] &quot;orig.ident&quot; &quot;nCount_RNA&quot; &quot;nFeature_RNA&quot; &quot;group&quot; ## [5] &quot;percent_mito&quot; &quot;percent_ribo&quot; &quot;percent_hb&quot; &quot;RNA_snn_res.0.01&quot; ## [9] &quot;seurat_clusters&quot; &quot;RNA_snn_res.0.05&quot; &quot;RNA_snn_res.0.1&quot; &quot;RNA_snn_res.0.2&quot; ## [13] &quot;RNA_snn_res.0.3&quot; &quot;RNA_snn_res.0.5&quot; &quot;RNA_snn_res.0.8&quot; &quot;RNA_snn_res.1&quot; DimPlot(sce.all, group.by = &quot;RNA_snn_res.0.1&quot;) astrocytes = c(&quot;AQP4&quot;, &quot;ADGRV1&quot;, &quot;GPC5&quot;, &quot;RYR3&quot;) endothelial = c(&quot;CLDN5&quot;, &quot;ABCB1&quot;, &quot;EBF1&quot;) excitatory = c(&quot;CAMK2A&quot;, &quot;CBLN2&quot;, &quot;LDB2&quot;) inhibitory = c(&quot;GAD1&quot;, &quot;LHFPL3&quot;, &quot;PCDH15&quot;) microglia = c(&quot;C3&quot;, &quot;LRMDA&quot;, &quot;DOCK8&quot;) oligodendrocytes = c(&quot;MBP&quot;, &quot;PLP1&quot;, &quot;ST18&quot;) OPC=&#39;Tnr,Igsf21,Neu4,Gpr17&#39; Ependymal=&#39;Cfap126,Fam183b,Tmem212,pifo,Tekt1,Dnah12&#39; pericyte=c( &#39;DCN&#39;, &#39;LUM&#39;, &#39;GSN&#39; ,&#39;FGF7&#39;,&#39;MME&#39;, &#39;ACTA2&#39;,&#39;RGS5&#39;) Neurons= c(&quot;RBFOX1&quot;, &quot;RBFOX3&quot;, &quot;SYT1&quot;) gene_list = list( Astro = astrocytes, Endo = endothelial, Excit = excitatory, Inhib = inhibitory, Mic = microglia, Oligo = oligodendrocytes, OPC= str_to_upper(trimws(strsplit(OPC,&#39;,&#39;)[[1]])), Ependymal= str_to_upper(trimws(strsplit(Ependymal,&#39;,&#39;)[[1]])) , peri = pericyte , Neur = Neurons ) gene_list = lapply(gene_list, function(x){ unique(c(str_to_title(x), str_to_upper(x))) }) gene_list ## $Astro ## [1] &quot;Aqp4&quot; &quot;Adgrv1&quot; &quot;Gpc5&quot; &quot;Ryr3&quot; &quot;AQP4&quot; &quot;ADGRV1&quot; &quot;GPC5&quot; &quot;RYR3&quot; ## ## $Endo ## [1] &quot;Cldn5&quot; &quot;Abcb1&quot; &quot;Ebf1&quot; &quot;CLDN5&quot; &quot;ABCB1&quot; &quot;EBF1&quot; ## ## $Excit ## [1] &quot;Camk2a&quot; &quot;Cbln2&quot; &quot;Ldb2&quot; &quot;CAMK2A&quot; &quot;CBLN2&quot; &quot;LDB2&quot; ## ## $Inhib ## [1] &quot;Gad1&quot; &quot;Lhfpl3&quot; &quot;Pcdh15&quot; &quot;GAD1&quot; &quot;LHFPL3&quot; &quot;PCDH15&quot; ## ## $Mic ## [1] &quot;C3&quot; &quot;Lrmda&quot; &quot;Dock8&quot; &quot;LRMDA&quot; &quot;DOCK8&quot; ## ## $Oligo ## [1] &quot;Mbp&quot; &quot;Plp1&quot; &quot;St18&quot; &quot;MBP&quot; &quot;PLP1&quot; &quot;ST18&quot; ## ## $OPC ## [1] &quot;Tnr&quot; &quot;Igsf21&quot; &quot;Neu4&quot; &quot;Gpr17&quot; &quot;TNR&quot; &quot;IGSF21&quot; &quot;NEU4&quot; &quot;GPR17&quot; ## ## $Ependymal ## [1] &quot;Cfap126&quot; &quot;Fam183b&quot; &quot;Tmem212&quot; &quot;Pifo&quot; &quot;Tekt1&quot; &quot;Dnah12&quot; &quot;CFAP126&quot; ## [8] &quot;FAM183B&quot; &quot;TMEM212&quot; &quot;PIFO&quot; &quot;TEKT1&quot; &quot;DNAH12&quot; ## ## $peri ## [1] &quot;Dcn&quot; &quot;Lum&quot; &quot;Gsn&quot; &quot;Fgf7&quot; &quot;Mme&quot; &quot;Acta2&quot; &quot;Rgs5&quot; &quot;DCN&quot; &quot;LUM&quot; ## [10] &quot;GSN&quot; &quot;FGF7&quot; &quot;MME&quot; &quot;ACTA2&quot; &quot;RGS5&quot; ## ## $Neur ## [1] &quot;Rbfox1&quot; &quot;Rbfox3&quot; &quot;Syt1&quot; &quot;RBFOX1&quot; &quot;RBFOX3&quot; &quot;SYT1&quot; p1=DotPlot(sce.all, assay = &quot;RNA&quot;, features = gene_list, group.by = &#39;RNA_snn_res.0.1&#39;) + theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=0.5));p1 æ ¹æ®æœ€ç»ˆçš„å¯è§†åŒ–å›¾ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‰‹åŠ¨çš„ç»™äºšç¾¤å‘½åäº†ã€‚ sce.all ## An object of class Seurat ## 28985 features across 20269 samples within 1 assay ## Active assay: RNA (28985 features, 2000 variable features) ## 3 layers present: counts, data, scale.data ## 3 dimensional reductions calculated: pca, harmony, umap dim(sce.all) ## [1] 28985 20269 sel.clust = &quot;RNA_snn_res.0.1&quot; sce.all &lt;- SetIdent(sce.all, value = sel.clust) res_len &lt;- table(sce.all@active.ident) %&gt;% length();res_len ## [1] 11 celltype=data.frame(ClusterID=(0:(res_len-1)), celltype= (0:(res_len-1))) # è‡ªå®šä¹‰ç»†èƒäºšç¾¤ celltype[celltype$ClusterID %in% c(2),2]=&#39;astrocytes&#39; celltype[celltype$ClusterID %in% c(4),2]=&#39;endothelial&#39; celltype[celltype$ClusterID %in% c(3),2]=&#39;microglia&#39; celltype[celltype$ClusterID %in% c(0),2]=&#39;oligodendrocytes&#39; celltype[celltype$ClusterID %in% c( 7 ),2]=&#39;OPC&#39; celltype[celltype$ClusterID %in% c( 1,5,6,8,10 ),2]=&#39;Neurons&#39; celltype[celltype$ClusterID %in% c( 9 ),2]=&#39;Ependymal&#39; head(celltype) ## ClusterID celltype ## 1 0 oligodendrocytes ## 2 1 Neurons ## 3 2 astrocytes ## 4 3 microglia ## 5 4 endothelial ## 6 5 Neurons table(celltype$celltype) ## ## astrocytes endothelial Ependymal microglia ## 1 1 1 1 ## Neurons oligodendrocytes OPC ## 5 1 1 sce.all@meta.data$celltype = &quot;NA&quot; for(i in 1:nrow(celltype)){ sce.all@meta.data[which(sce.all@meta.data[[sel.clust]] == celltype$ClusterID[i]),&#39;celltype&#39;] &lt;- celltype$celltype[i]} Idents(sce.all)=sce.all$celltype table(sce.all@active.ident) ## ## oligodendrocytes Neurons astrocytes OPC ## 6832 6971 3145 735 ## microglia endothelial Ependymal ## 1295 1154 137 æœ€åæˆ‘ä»¬å°±å¯ä»¥å¯è§†åŒ–æˆ‘ä»¬çš„å‘½åæ•ˆæœäº†ã€‚ DimPlot(sce.all, reduction = &quot;umap&quot;,raster = F, label = T,repel = T) + theme_dr(xlength = 0.22, ylength = 0.22, arrow = grid::arrow(length = unit(0.15, &quot;inches&quot;), type = &quot;closed&quot;))+ theme(panel.grid = element_blank()) ä¿å­˜Seuratå¯¹è±¡ä»¥ä¾¿åç»­åˆ†æ saveRDS(sce.all, file = &quot;./sce.all_final.rds&quot;) "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
