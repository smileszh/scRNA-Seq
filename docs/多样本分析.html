<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>第 4 章 多样本分析 | scRNA-Seq 分析笔记</title>
  <meta name="description" content="This is an online note of the scRNA-Seq analysis." />
  <meta name="generator" content="bookdown 0.41 and GitBook 2.6.7" />

  <meta property="og:title" content="第 4 章 多样本分析 | scRNA-Seq 分析笔记" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is an online note of the scRNA-Seq analysis." />
  <meta name="github-repo" content="smileszh/scRNA-Seq" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="第 4 章 多样本分析 | scRNA-Seq 分析笔记" />
  
  <meta name="twitter:description" content="This is an online note of the scRNA-Seq analysis." />
  

<meta name="author" content="苏总华" />


<meta name="date" content="2024-11-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="单样本分析.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">scRNA-Seq 笔记</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>前言</a></li>
<li class="part"><span><b>I 初识 scRNA-Seq</b></span></li>
<li class="chapter" data-level="1" data-path="scrna-seq-简介.html"><a href="scrna-seq-简介.html"><i class="fa fa-check"></i><b>1</b> scRNA-Seq 简介</a></li>
<li class="part"><span><b>II scRNA-Seq 基础知识</b></span></li>
<li class="chapter" data-level="2" data-path="单细胞基本分析流程.html"><a href="单细胞基本分析流程.html"><i class="fa fa-check"></i><b>2</b> 单细胞基本分析流程</a>
<ul>
<li class="chapter" data-level="" data-path="单细胞基本分析流程.html"><a href="单细胞基本分析流程.html#数据读取"><i class="fa fa-check"></i>数据读取</a>
<ul>
<li class="chapter" data-level="" data-path="单细胞基本分析流程.html"><a href="单细胞基本分析流程.html#x-genomics-三文件"><i class="fa fa-check"></i>10X Genomics 三文件</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="单细胞基本分析流程.html"><a href="单细胞基本分析流程.html#质量控制指标"><i class="fa fa-check"></i>质量控制指标</a></li>
<li class="chapter" data-level="" data-path="单细胞基本分析流程.html"><a href="单细胞基本分析流程.html#数据标准化"><i class="fa fa-check"></i>数据标准化</a></li>
<li class="chapter" data-level="" data-path="单细胞基本分析流程.html"><a href="单细胞基本分析流程.html#识别高变基因"><i class="fa fa-check"></i>识别高变基因</a></li>
<li class="chapter" data-level="" data-path="单细胞基本分析流程.html"><a href="单细胞基本分析流程.html#缩放数据"><i class="fa fa-check"></i>缩放数据</a></li>
<li class="chapter" data-level="" data-path="单细胞基本分析流程.html"><a href="单细胞基本分析流程.html#pca线性降维"><i class="fa fa-check"></i>PCA线性降维</a></li>
<li class="chapter" data-level="" data-path="单细胞基本分析流程.html"><a href="单细胞基本分析流程.html#细胞聚类"><i class="fa fa-check"></i>细胞聚类</a></li>
<li class="chapter" data-level="" data-path="单细胞基本分析流程.html"><a href="单细胞基本分析流程.html#非线性降维umaptsne"><i class="fa fa-check"></i>非线性降维UMAP/tSNE</a></li>
</ul></li>
<li class="part"><span><b>III scRNA-Seq 入门</b></span></li>
<li class="chapter" data-level="3" data-path="单样本分析.html"><a href="单样本分析.html"><i class="fa fa-check"></i><b>3</b> 单样本分析</a>
<ul>
<li class="chapter" data-level="" data-path="单样本分析.html"><a href="单样本分析.html#设置seurat对象"><i class="fa fa-check"></i>设置Seurat对象</a></li>
<li class="chapter" data-level="" data-path="单样本分析.html"><a href="单样本分析.html#质量控制"><i class="fa fa-check"></i>质量控制</a>
<ul>
<li class="chapter" data-level="" data-path="单样本分析.html"><a href="单样本分析.html#计算每个细胞线粒体基因的百分比"><i class="fa fa-check"></i>计算每个细胞线粒体基因的百分比</a></li>
<li class="chapter" data-level="" data-path="单样本分析.html"><a href="单样本分析.html#过滤"><i class="fa fa-check"></i>过滤</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="单样本分析.html"><a href="单样本分析.html#数据标准化-1"><i class="fa fa-check"></i>数据标准化</a></li>
<li class="chapter" data-level="" data-path="单样本分析.html"><a href="单样本分析.html#识别高变基因-1"><i class="fa fa-check"></i>识别高变基因</a></li>
<li class="chapter" data-level="" data-path="单样本分析.html"><a href="单样本分析.html#缩放数据-1"><i class="fa fa-check"></i>缩放数据</a></li>
<li class="chapter" data-level="" data-path="单样本分析.html"><a href="单样本分析.html#pca线性降维-1"><i class="fa fa-check"></i>PCA线性降维</a>
<ul>
<li class="chapter" data-level="" data-path="单样本分析.html"><a href="单样本分析.html#确定数据集的维度"><i class="fa fa-check"></i>确定数据集的“维度”</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="单样本分析.html"><a href="单样本分析.html#细胞聚类-1"><i class="fa fa-check"></i>细胞聚类</a></li>
<li class="chapter" data-level="" data-path="单样本分析.html"><a href="单样本分析.html#非线性降维umaptsne-1"><i class="fa fa-check"></i>非线性降维UMAP/tSNE</a></li>
<li class="chapter" data-level="" data-path="单样本分析.html"><a href="单样本分析.html#寻找亚群标志基因"><i class="fa fa-check"></i>寻找亚群标志基因</a></li>
<li class="chapter" data-level="" data-path="单样本分析.html"><a href="单样本分析.html#亚群命名"><i class="fa fa-check"></i>亚群命名</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="多样本分析.html"><a href="多样本分析.html"><i class="fa fa-check"></i><b>4</b> 多样本分析</a>
<ul>
<li class="chapter" data-level="" data-path="多样本分析.html"><a href="多样本分析.html#加载包"><i class="fa fa-check"></i>加载包</a></li>
<li class="chapter" data-level="" data-path="多样本分析.html"><a href="多样本分析.html#创建多样本seurat对象"><i class="fa fa-check"></i>创建多样本Seurat对象</a></li>
<li class="chapter" data-level="" data-path="多样本分析.html"><a href="多样本分析.html#质控"><i class="fa fa-check"></i>质控</a></li>
<li class="chapter" data-level="" data-path="多样本分析.html"><a href="多样本分析.html#harmony流程"><i class="fa fa-check"></i>harmony流程</a></li>
<li class="chapter" data-level="" data-path="多样本分析.html"><a href="多样本分析.html#检查marker基因"><i class="fa fa-check"></i>检查marker基因</a></li>
<li class="chapter" data-level="" data-path="多样本分析.html"><a href="多样本分析.html#亚群命名-1"><i class="fa fa-check"></i>亚群命名</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://space.bilibili.com/338686099" target="blank">本笔记来自 生信技能书</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">scRNA-Seq 分析笔记</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="多样本分析" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">第 4 章</span> 多样本分析<a href="多样本分析.html#多样本分析" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="加载包" class="section level2 unnumbered hasAnchor">
<h2>加载包<a href="多样本分析.html#加载包" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="多样本分析.html#cb43-1" tabindex="-1"></a><span class="fu">library</span>(COSG)</span>
<span id="cb43-2"><a href="多样本分析.html#cb43-2" tabindex="-1"></a><span class="fu">library</span>(harmony)</span>
<span id="cb43-3"><a href="多样本分析.html#cb43-3" tabindex="-1"></a><span class="fu">library</span>(ggsci)</span>
<span id="cb43-4"><a href="多样本分析.html#cb43-4" tabindex="-1"></a><span class="fu">library</span>(future)</span>
<span id="cb43-5"><a href="多样本分析.html#cb43-5" tabindex="-1"></a><span class="fu">library</span>(Seurat)</span>
<span id="cb43-6"><a href="多样本分析.html#cb43-6" tabindex="-1"></a><span class="fu">library</span>(clustree)</span>
<span id="cb43-7"><a href="多样本分析.html#cb43-7" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb43-8"><a href="多样本分析.html#cb43-8" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb43-9"><a href="多样本分析.html#cb43-9" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb43-10"><a href="多样本分析.html#cb43-10" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb43-11"><a href="多样本分析.html#cb43-11" tabindex="-1"></a><span class="fu">library</span>(SingleR)</span>
<span id="cb43-12"><a href="多样本分析.html#cb43-12" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb43-13"><a href="多样本分析.html#cb43-13" tabindex="-1"></a><span class="fu">library</span>(tidydr)</span></code></pre></div>
</div>
<div id="创建多样本seurat对象" class="section level2 unnumbered hasAnchor">
<h2>创建多样本Seurat对象<a href="多样本分析.html#创建多样本seurat对象" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>不同于单样本分析，多样本分析需要将多个样本整合到一个Seurat对象中。这里我们使用<code>lapply</code>函数，将多个样本的数据读取并整合到一个列表中。进而创建Searut对象。</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="多样本分析.html#cb44-1" tabindex="-1"></a>dir<span class="ot">=</span><span class="st">&quot;./data/multi-samples/outputs&quot;</span></span>
<span id="cb44-2"><a href="多样本分析.html#cb44-2" tabindex="-1"></a>samples<span class="ot">=</span><span class="fu">list.files</span>(dir)</span>
<span id="cb44-3"><a href="多样本分析.html#cb44-3" tabindex="-1"></a>samples </span>
<span id="cb44-4"><a href="多样本分析.html#cb44-4" tabindex="-1"></a><span class="do">## [1] &quot;GSM4888887_CTRL1&quot; &quot;GSM4888888_CTRL2&quot; &quot;GSM4888891_AD1&quot;   &quot;GSM4888892_AD2&quot;  </span></span>
<span id="cb44-5"><a href="多样本分析.html#cb44-5" tabindex="-1"></a><span class="do">## [5] &quot;GSM4888895_PD1&quot;   &quot;GSM4888896_PD2&quot;</span></span>
<span id="cb44-6"><a href="多样本分析.html#cb44-6" tabindex="-1"></a></span>
<span id="cb44-7"><a href="多样本分析.html#cb44-7" tabindex="-1"></a>sceList <span class="ot">=</span> <span class="fu">lapply</span>(samples,<span class="cf">function</span>(pro){ </span>
<span id="cb44-8"><a href="多样本分析.html#cb44-8" tabindex="-1"></a>  <span class="co">#pro=samples[1] </span></span>
<span id="cb44-9"><a href="多样本分析.html#cb44-9" tabindex="-1"></a>  <span class="fu">print</span>(pro)  </span>
<span id="cb44-10"><a href="多样本分析.html#cb44-10" tabindex="-1"></a>  tmp <span class="ot">=</span> <span class="fu">Read10X</span>(<span class="fu">file.path</span>(dir, pro)) </span>
<span id="cb44-11"><a href="多样本分析.html#cb44-11" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(tmp)<span class="sc">==</span><span class="dv">2</span>){</span>
<span id="cb44-12"><a href="多样本分析.html#cb44-12" tabindex="-1"></a>    ct <span class="ot">=</span> tmp[[<span class="dv">1</span>]] </span>
<span id="cb44-13"><a href="多样本分析.html#cb44-13" tabindex="-1"></a>  }<span class="cf">else</span>{ct <span class="ot">=</span> tmp}</span>
<span id="cb44-14"><a href="多样本分析.html#cb44-14" tabindex="-1"></a>  sce <span class="ot">=</span><span class="fu">CreateSeuratObject</span>(<span class="at">counts =</span>  ct ,</span>
<span id="cb44-15"><a href="多样本分析.html#cb44-15" tabindex="-1"></a>                          <span class="at">project =</span>  pro  ,</span>
<span id="cb44-16"><a href="多样本分析.html#cb44-16" tabindex="-1"></a>                          <span class="at">min.cells =</span> <span class="dv">5</span>,</span>
<span id="cb44-17"><a href="多样本分析.html#cb44-17" tabindex="-1"></a>                          <span class="at">min.features =</span> <span class="dv">300</span> )</span>
<span id="cb44-18"><a href="多样本分析.html#cb44-18" tabindex="-1"></a>  <span class="fu">return</span>(sce)</span>
<span id="cb44-19"><a href="多样本分析.html#cb44-19" tabindex="-1"></a>})</span>
<span id="cb44-20"><a href="多样本分析.html#cb44-20" tabindex="-1"></a><span class="do">## [1] &quot;GSM4888887_CTRL1&quot;</span></span>
<span id="cb44-21"><a href="多样本分析.html#cb44-21" tabindex="-1"></a><span class="do">## [1] &quot;GSM4888888_CTRL2&quot;</span></span>
<span id="cb44-22"><a href="多样本分析.html#cb44-22" tabindex="-1"></a><span class="do">## [1] &quot;GSM4888891_AD1&quot;</span></span>
<span id="cb44-23"><a href="多样本分析.html#cb44-23" tabindex="-1"></a><span class="do">## [1] &quot;GSM4888892_AD2&quot;</span></span>
<span id="cb44-24"><a href="多样本分析.html#cb44-24" tabindex="-1"></a><span class="do">## [1] &quot;GSM4888895_PD1&quot;</span></span>
<span id="cb44-25"><a href="多样本分析.html#cb44-25" tabindex="-1"></a><span class="do">## [1] &quot;GSM4888896_PD2&quot;</span></span>
<span id="cb44-26"><a href="多样本分析.html#cb44-26" tabindex="-1"></a></span>
<span id="cb44-27"><a href="多样本分析.html#cb44-27" tabindex="-1"></a>sce.all<span class="ot">=</span><span class="fu">merge</span>(<span class="at">x=</span>sceList[[<span class="dv">1</span>]],</span>
<span id="cb44-28"><a href="多样本分析.html#cb44-28" tabindex="-1"></a>              <span class="at">y=</span>sceList[ <span class="sc">-</span><span class="dv">1</span> ],</span>
<span id="cb44-29"><a href="多样本分析.html#cb44-29" tabindex="-1"></a>              <span class="at">add.cell.ids =</span> samples) <span class="co"># 每个细胞的名称前都会添加一个样本标识符前缀</span></span>
<span id="cb44-30"><a href="多样本分析.html#cb44-30" tabindex="-1"></a></span>
<span id="cb44-31"><a href="多样本分析.html#cb44-31" tabindex="-1"></a>sce.all <span class="ot">&lt;-</span> <span class="fu">JoinLayers</span>(sce.all)</span>
<span id="cb44-32"><a href="多样本分析.html#cb44-32" tabindex="-1"></a></span>
<span id="cb44-33"><a href="多样本分析.html#cb44-33" tabindex="-1"></a></span>
<span id="cb44-34"><a href="多样本分析.html#cb44-34" tabindex="-1"></a><span class="co"># 添加分组信息</span></span>
<span id="cb44-35"><a href="多样本分析.html#cb44-35" tabindex="-1"></a>phe<span class="ot">=</span><span class="fu">str_split</span>(<span class="fu">colnames</span>(sce.all),<span class="st">&#39;[_-]&#39;</span>,<span class="at">simplify =</span> T)</span>
<span id="cb44-36"><a href="多样本分析.html#cb44-36" tabindex="-1"></a>phe[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span>
<span id="cb44-37"><a href="多样本分析.html#cb44-37" tabindex="-1"></a><span class="do">##      [,1]         [,2]    [,3]               [,4]</span></span>
<span id="cb44-38"><a href="多样本分析.html#cb44-38" tabindex="-1"></a><span class="do">## [1,] &quot;GSM4888887&quot; &quot;CTRL1&quot; &quot;AAACCCAAGACGTCCC&quot; &quot;1&quot; </span></span>
<span id="cb44-39"><a href="多样本分析.html#cb44-39" tabindex="-1"></a><span class="do">## [2,] &quot;GSM4888887&quot; &quot;CTRL1&quot; &quot;AAACCCAAGGGCCTCT&quot; &quot;1&quot; </span></span>
<span id="cb44-40"><a href="多样本分析.html#cb44-40" tabindex="-1"></a><span class="do">## [3,] &quot;GSM4888887&quot; &quot;CTRL1&quot; &quot;AAACCCACAGGTATGG&quot; &quot;1&quot; </span></span>
<span id="cb44-41"><a href="多样本分析.html#cb44-41" tabindex="-1"></a><span class="do">## [4,] &quot;GSM4888887&quot; &quot;CTRL1&quot; &quot;AAACCCAGTCTTGAAC&quot; &quot;1&quot; </span></span>
<span id="cb44-42"><a href="多样本分析.html#cb44-42" tabindex="-1"></a><span class="do">## [5,] &quot;GSM4888887&quot; &quot;CTRL1&quot; &quot;AAACCCATCAAGCTGT&quot; &quot;1&quot;</span></span>
<span id="cb44-43"><a href="多样本分析.html#cb44-43" tabindex="-1"></a>sce.all<span class="sc">$</span>group <span class="ot">=</span> phe[,<span class="dv">1</span>]</span>
<span id="cb44-44"><a href="多样本分析.html#cb44-44" tabindex="-1"></a></span>
<span id="cb44-45"><a href="多样本分析.html#cb44-45" tabindex="-1"></a><span class="fu">table</span>(sce.all<span class="sc">@</span>meta.data<span class="sc">$</span>group)</span>
<span id="cb44-46"><a href="多样本分析.html#cb44-46" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb44-47"><a href="多样本分析.html#cb44-47" tabindex="-1"></a><span class="do">## GSM4888887 GSM4888888 GSM4888891 GSM4888892 GSM4888895 GSM4888896 </span></span>
<span id="cb44-48"><a href="多样本分析.html#cb44-48" tabindex="-1"></a><span class="do">##       4605       2184       2503       4167       2095       5333</span></span>
<span id="cb44-49"><a href="多样本分析.html#cb44-49" tabindex="-1"></a><span class="fu">table</span>(sce.all<span class="sc">@</span>meta.data<span class="sc">$</span>orig.ident)</span>
<span id="cb44-50"><a href="多样本分析.html#cb44-50" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb44-51"><a href="多样本分析.html#cb44-51" tabindex="-1"></a><span class="do">## GSM4888887_CTRL1 GSM4888888_CTRL2   GSM4888891_AD1   GSM4888892_AD2 </span></span>
<span id="cb44-52"><a href="多样本分析.html#cb44-52" tabindex="-1"></a><span class="do">##             4605             2184             2503             4167 </span></span>
<span id="cb44-53"><a href="多样本分析.html#cb44-53" tabindex="-1"></a><span class="do">##   GSM4888895_PD1   GSM4888896_PD2 </span></span>
<span id="cb44-54"><a href="多样本分析.html#cb44-54" tabindex="-1"></a><span class="do">##             2095             5333</span></span></code></pre></div>
</div>
<div id="质控" class="section level2 unnumbered hasAnchor">
<h2>质控<a href="多样本分析.html#质控" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>第一步我们先计算关注的指标</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="多样本分析.html#cb45-1" tabindex="-1"></a><span class="co">#计算线粒体基因比例</span></span>
<span id="cb45-2"><a href="多样本分析.html#cb45-2" tabindex="-1"></a>mito_genes<span class="ot">=</span><span class="fu">rownames</span>(sce.all)[<span class="fu">grep</span>(<span class="st">&quot;^MT-&quot;</span>, <span class="fu">rownames</span>(sce.all),<span class="at">ignore.case =</span> T)] </span>
<span id="cb45-3"><a href="多样本分析.html#cb45-3" tabindex="-1"></a><span class="fu">print</span>(mito_genes) <span class="co">#可能是13个线粒体基因</span></span>
<span id="cb45-4"><a href="多样本分析.html#cb45-4" tabindex="-1"></a><span class="do">##  [1] &quot;MT-TF&quot;   &quot;MT-RNR1&quot; &quot;MT-TV&quot;   &quot;MT-RNR2&quot; &quot;MT-ND1&quot;  &quot;MT-TI&quot;   &quot;MT-TM&quot;  </span></span>
<span id="cb45-5"><a href="多样本分析.html#cb45-5" tabindex="-1"></a><span class="do">##  [8] &quot;MT-ND2&quot;  &quot;MT-CO1&quot;  &quot;MT-CO2&quot;  &quot;MT-TK&quot;   &quot;MT-ATP8&quot; &quot;MT-ATP6&quot; &quot;MT-CO3&quot; </span></span>
<span id="cb45-6"><a href="多样本分析.html#cb45-6" tabindex="-1"></a><span class="do">## [15] &quot;MT-ND3&quot;  &quot;MT-ND4L&quot; &quot;MT-ND4&quot;  &quot;MT-TH&quot;   &quot;MT-ND5&quot;  &quot;MT-ND6&quot;  &quot;MT-CYB&quot; </span></span>
<span id="cb45-7"><a href="多样本分析.html#cb45-7" tabindex="-1"></a><span class="do">## [22] &quot;MT-TP&quot;   &quot;MT-TL1&quot;  &quot;MT-TD&quot;   &quot;MT-TG&quot;</span></span>
<span id="cb45-8"><a href="多样本分析.html#cb45-8" tabindex="-1"></a>sce.all<span class="ot">=</span><span class="fu">PercentageFeatureSet</span>(sce.all, <span class="at">features =</span> mito_genes, <span class="at">col.name =</span> <span class="st">&quot;percent_mito&quot;</span>)</span>
<span id="cb45-9"><a href="多样本分析.html#cb45-9" tabindex="-1"></a><span class="fu">fivenum</span>(sce.all<span class="sc">@</span>meta.data<span class="sc">$</span>percent_mito)</span>
<span id="cb45-10"><a href="多样本分析.html#cb45-10" tabindex="-1"></a><span class="do">## [1]  0.0000000  0.3938158  0.9076559  2.4844720 86.9161677</span></span>
<span id="cb45-11"><a href="多样本分析.html#cb45-11" tabindex="-1"></a>  </span>
<span id="cb45-12"><a href="多样本分析.html#cb45-12" tabindex="-1"></a><span class="co">#计算核糖体基因比例</span></span>
<span id="cb45-13"><a href="多样本分析.html#cb45-13" tabindex="-1"></a>ribo_genes<span class="ot">=</span><span class="fu">rownames</span>(sce.all)[<span class="fu">grep</span>(<span class="st">&quot;^Rp[sl]&quot;</span>, <span class="fu">rownames</span>(sce.all),<span class="at">ignore.case =</span> T)]</span>
<span id="cb45-14"><a href="多样本分析.html#cb45-14" tabindex="-1"></a><span class="fu">print</span>(ribo_genes[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>])</span>
<span id="cb45-15"><a href="多样本分析.html#cb45-15" tabindex="-1"></a><span class="do">##  [1] &quot;RPL22&quot;     &quot;RPL11&quot;     &quot;RPS6KA1&quot;   &quot;RPS8&quot;      &quot;RPS15AP11&quot; &quot;RPS13P2&quot;  </span></span>
<span id="cb45-16"><a href="多样本分析.html#cb45-16" tabindex="-1"></a><span class="do">##  [7] &quot;RPL21P23&quot;  &quot;RPL31P12&quot;  &quot;RPL5&quot;      &quot;RPL7P9&quot;</span></span>
<span id="cb45-17"><a href="多样本分析.html#cb45-17" tabindex="-1"></a>sce.all<span class="ot">=</span><span class="fu">PercentageFeatureSet</span>(sce.all,  <span class="at">features =</span> ribo_genes, <span class="at">col.name =</span> <span class="st">&quot;percent_ribo&quot;</span>)</span>
<span id="cb45-18"><a href="多样本分析.html#cb45-18" tabindex="-1"></a><span class="fu">fivenum</span>(sce.all<span class="sc">@</span>meta.data<span class="sc">$</span>percent_ribo)</span>
<span id="cb45-19"><a href="多样本分析.html#cb45-19" tabindex="-1"></a><span class="do">## [1]  0.0000000  0.3896445  0.6633781  1.3927122 14.5989305</span></span>
<span id="cb45-20"><a href="多样本分析.html#cb45-20" tabindex="-1"></a>  </span>
<span id="cb45-21"><a href="多样本分析.html#cb45-21" tabindex="-1"></a><span class="co">#计算红血细胞基因比例</span></span>
<span id="cb45-22"><a href="多样本分析.html#cb45-22" tabindex="-1"></a>Hb_genes<span class="ot">=</span><span class="fu">rownames</span>(sce.all)[<span class="fu">grep</span>(<span class="st">&quot;^Hb[^(p)]&quot;</span>, <span class="fu">rownames</span>(sce.all),<span class="at">ignore.case =</span> T)]</span>
<span id="cb45-23"><a href="多样本分析.html#cb45-23" tabindex="-1"></a><span class="fu">print</span>(Hb_genes)</span>
<span id="cb45-24"><a href="多样本分析.html#cb45-24" tabindex="-1"></a><span class="do">## [1] &quot;HBEGF&quot; &quot;HBS1L&quot; &quot;HBB&quot;   &quot;HBG2&quot;  &quot;HBM&quot;   &quot;HBA2&quot;  &quot;HBA1&quot;  &quot;HBQ1&quot;</span></span>
<span id="cb45-25"><a href="多样本分析.html#cb45-25" tabindex="-1"></a>sce.all<span class="ot">=</span><span class="fu">PercentageFeatureSet</span>(sce.all,  <span class="at">features =</span> Hb_genes,<span class="at">col.name =</span> <span class="st">&quot;percent_hb&quot;</span>)</span>
<span id="cb45-26"><a href="多样本分析.html#cb45-26" tabindex="-1"></a><span class="fu">fivenum</span>(sce.all<span class="sc">@</span>meta.data<span class="sc">$</span>percent_hb)</span>
<span id="cb45-27"><a href="多样本分析.html#cb45-27" tabindex="-1"></a><span class="do">## [1]  0.00000000  0.00000000  0.00000000  0.01954031 28.35028077</span></span></code></pre></div>
<p>过滤前可视化</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="多样本分析.html#cb46-1" tabindex="-1"></a><span class="co">#可视化细胞的上述比例情况</span></span>
<span id="cb46-2"><a href="多样本分析.html#cb46-2" tabindex="-1"></a>feats <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;nFeature_RNA&quot;</span>, <span class="st">&quot;nCount_RNA&quot;</span>)</span>
<span id="cb46-3"><a href="多样本分析.html#cb46-3" tabindex="-1"></a>p1<span class="ot">=</span><span class="fu">VlnPlot</span>(sce.all, <span class="at">group.by =</span> <span class="st">&quot;orig.ident&quot;</span>, <span class="at">features =</span> feats, <span class="at">pt.size =</span> <span class="dv">0</span>, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb46-4"><a href="多样本分析.html#cb46-4" tabindex="-1"></a>    <span class="fu">NoLegend</span>()</span>
<span id="cb46-5"><a href="多样本分析.html#cb46-5" tabindex="-1"></a>p1 </span></code></pre></div>
<p><img src="04-multi_files/figure-html/unnamed-chunk-3-1.png" width="1152" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="多样本分析.html#cb47-1" tabindex="-1"></a></span>
<span id="cb47-2"><a href="多样本分析.html#cb47-2" tabindex="-1"></a>feats <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;percent_mito&quot;</span>, <span class="st">&quot;percent_ribo&quot;</span>, <span class="st">&quot;percent_hb&quot;</span>)</span>
<span id="cb47-3"><a href="多样本分析.html#cb47-3" tabindex="-1"></a>p2<span class="ot">=</span><span class="fu">VlnPlot</span>(sce.all, <span class="at">group.by =</span> <span class="st">&quot;orig.ident&quot;</span>, <span class="at">features =</span> feats, <span class="at">pt.size =</span> <span class="dv">0</span>, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">same.y.lims=</span>T) <span class="sc">+</span> </span>
<span id="cb47-4"><a href="多样本分析.html#cb47-4" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">5</span>)) <span class="sc">+</span> </span>
<span id="cb47-5"><a href="多样本分析.html#cb47-5" tabindex="-1"></a>  <span class="fu">NoLegend</span>()</span>
<span id="cb47-6"><a href="多样本分析.html#cb47-6" tabindex="-1"></a>p2</span></code></pre></div>
<p><img src="04-multi_files/figure-html/unnamed-chunk-3-2.png" width="1152" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="多样本分析.html#cb48-1" tabindex="-1"></a></span>
<span id="cb48-2"><a href="多样本分析.html#cb48-2" tabindex="-1"></a>p3<span class="ot">=</span><span class="fu">FeatureScatter</span>(sce.all, <span class="st">&quot;nCount_RNA&quot;</span>, <span class="st">&quot;nFeature_RNA&quot;</span>, <span class="at">group.by =</span> <span class="st">&quot;orig.ident&quot;</span>, <span class="at">pt.size =</span> <span class="fl">0.5</span>)</span>
<span id="cb48-3"><a href="多样本分析.html#cb48-3" tabindex="-1"></a>p3</span></code></pre></div>
<p><img src="04-multi_files/figure-html/unnamed-chunk-3-3.png" width="1152" style="display: block; margin: auto;" /></p>
<p>开始过滤</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="多样本分析.html#cb49-1" tabindex="-1"></a><span class="co"># 根据上述指标，过滤低质量细胞/基因</span></span>
<span id="cb49-2"><a href="多样本分析.html#cb49-2" tabindex="-1"></a><span class="co"># 过滤指标1:最少表达基因数的细胞&amp;最少表达细胞数的基因</span></span>
<span id="cb49-3"><a href="多样本分析.html#cb49-3" tabindex="-1"></a><span class="co"># 一般来说，在`CreateSeuratObject`的时候已经是进行了这个过滤操作</span></span>
<span id="cb49-4"><a href="多样本分析.html#cb49-4" tabindex="-1"></a><span class="co"># 如果后期看到了自己的单细胞降维聚类分群结果很诡异，就可以回过头来看质量控制环节</span></span>
<span id="cb49-5"><a href="多样本分析.html#cb49-5" tabindex="-1"></a><span class="co"># 先走默认流程即可</span></span>
<span id="cb49-6"><a href="多样本分析.html#cb49-6" tabindex="-1"></a><span class="cf">if</span>(F){</span>
<span id="cb49-7"><a href="多样本分析.html#cb49-7" tabindex="-1"></a>    selected_c <span class="ot">&lt;-</span> <span class="fu">WhichCells</span>(sce.all, <span class="at">expression =</span> nFeature_RNA <span class="sc">&gt;</span> <span class="dv">500</span>)</span>
<span id="cb49-8"><a href="多样本分析.html#cb49-8" tabindex="-1"></a>    selected_f <span class="ot">&lt;-</span> <span class="fu">rownames</span>(sce.all)[Matrix<span class="sc">::</span><span class="fu">rowSums</span>(sce.all<span class="sc">@</span>assays<span class="sc">$</span>RNA<span class="sc">$</span>counts <span class="sc">&gt;</span> <span class="dv">0</span> ) <span class="sc">&gt;</span> <span class="dv">3</span>]</span>
<span id="cb49-9"><a href="多样本分析.html#cb49-9" tabindex="-1"></a>    sce.all <span class="ot">&lt;-</span> <span class="fu">subset</span>(sce.all, <span class="at">features =</span> selected_f, <span class="at">cells =</span> selected_c)</span>
<span id="cb49-10"><a href="多样本分析.html#cb49-10" tabindex="-1"></a>  }</span></code></pre></div>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="多样本分析.html#cb50-1" tabindex="-1"></a> <span class="co">#过滤指标2:线粒体/核糖体基因比例(根据上面的violin图)</span></span>
<span id="cb50-2"><a href="多样本分析.html#cb50-2" tabindex="-1"></a>selected_mito <span class="ot">&lt;-</span> <span class="fu">WhichCells</span>(sce.all, <span class="at">expression =</span> percent_mito <span class="sc">&lt;</span> <span class="dv">25</span>);<span class="fu">length</span>(selected_mito)</span>
<span id="cb50-3"><a href="多样本分析.html#cb50-3" tabindex="-1"></a><span class="do">## [1] 20269</span></span>
<span id="cb50-4"><a href="多样本分析.html#cb50-4" tabindex="-1"></a>selected_ribo <span class="ot">&lt;-</span> <span class="fu">WhichCells</span>(sce.all, <span class="at">expression =</span> percent_ribo <span class="sc">&gt;</span> <span class="dv">3</span>);<span class="fu">length</span>(selected_ribo)</span>
<span id="cb50-5"><a href="多样本分析.html#cb50-5" tabindex="-1"></a><span class="do">## [1] 1386</span></span>
<span id="cb50-6"><a href="多样本分析.html#cb50-6" tabindex="-1"></a>selected_hb <span class="ot">&lt;-</span> <span class="fu">WhichCells</span>(sce.all, <span class="at">expression =</span> percent_hb <span class="sc">&lt;</span> <span class="dv">1</span> );<span class="fu">length</span>(selected_hb)</span>
<span id="cb50-7"><a href="多样本分析.html#cb50-7" tabindex="-1"></a><span class="do">## [1] 20876</span></span>
<span id="cb50-8"><a href="多样本分析.html#cb50-8" tabindex="-1"></a></span>
<span id="cb50-9"><a href="多样本分析.html#cb50-9" tabindex="-1"></a>sce.all <span class="ot">&lt;-</span> <span class="fu">subset</span>(sce.all, <span class="at">cells =</span> selected_mito)</span>
<span id="cb50-10"><a href="多样本分析.html#cb50-10" tabindex="-1"></a><span class="co"># sce.all.filt &lt;- subset(sce.all.filt, cells = selected_ribo)</span></span>
<span id="cb50-11"><a href="多样本分析.html#cb50-11" tabindex="-1"></a><span class="co"># sce.all.filt &lt;- subset(sce.all.filt, cells = selected_hb)</span></span>
<span id="cb50-12"><a href="多样本分析.html#cb50-12" tabindex="-1"></a><span class="fu">dim</span>(sce.all)</span>
<span id="cb50-13"><a href="多样本分析.html#cb50-13" tabindex="-1"></a><span class="do">## [1] 28985 20269</span></span></code></pre></div>
<p>过滤后可视化</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="多样本分析.html#cb51-1" tabindex="-1"></a><span class="co">#可视化过滤后的情况</span></span>
<span id="cb51-2"><a href="多样本分析.html#cb51-2" tabindex="-1"></a>feats <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;nFeature_RNA&quot;</span>, <span class="st">&quot;nCount_RNA&quot;</span>)</span>
<span id="cb51-3"><a href="多样本分析.html#cb51-3" tabindex="-1"></a>p1_filtered<span class="ot">=</span><span class="fu">VlnPlot</span>(sce.all, <span class="at">group.by =</span> <span class="st">&quot;orig.ident&quot;</span>, <span class="at">features =</span> feats, <span class="at">pt.size =</span> <span class="dv">0</span>,</span>
<span id="cb51-4"><a href="多样本分析.html#cb51-4" tabindex="-1"></a>                    <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb51-5"><a href="多样本分析.html#cb51-5" tabindex="-1"></a>  <span class="fu">NoLegend</span>()</span>
<span id="cb51-6"><a href="多样本分析.html#cb51-6" tabindex="-1"></a>p1_filtered</span></code></pre></div>
<p><img src="04-multi_files/figure-html/unnamed-chunk-6-1.png" width="1152" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="多样本分析.html#cb52-1" tabindex="-1"></a>  </span>
<span id="cb52-2"><a href="多样本分析.html#cb52-2" tabindex="-1"></a>feats <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;percent_mito&quot;</span>, <span class="st">&quot;percent_ribo&quot;</span>, <span class="st">&quot;percent_hb&quot;</span>)</span>
<span id="cb52-3"><a href="多样本分析.html#cb52-3" tabindex="-1"></a>p2_filtered<span class="ot">=</span><span class="fu">VlnPlot</span>(sce.all, <span class="at">group.by =</span> <span class="st">&quot;orig.ident&quot;</span>, <span class="at">features =</span> feats, <span class="at">pt.size =</span> <span class="dv">0</span>, <span class="at">ncol =</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb52-4"><a href="多样本分析.html#cb52-4" tabindex="-1"></a>    <span class="fu">NoLegend</span>()</span>
<span id="cb52-5"><a href="多样本分析.html#cb52-5" tabindex="-1"></a>p2_filtered</span></code></pre></div>
<p><img src="04-multi_files/figure-html/unnamed-chunk-6-2.png" width="1152" style="display: block; margin: auto;" /></p>
</div>
<div id="harmony流程" class="section level2 unnumbered hasAnchor">
<h2>harmony流程<a href="多样本分析.html#harmony流程" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="多样本分析.html#cb53-1" tabindex="-1"></a>sce.all <span class="ot">&lt;-</span> <span class="fu">NormalizeData</span>(sce.all, </span>
<span id="cb53-2"><a href="多样本分析.html#cb53-2" tabindex="-1"></a>                             <span class="at">normalization.method =</span> <span class="st">&quot;LogNormalize&quot;</span>,</span>
<span id="cb53-3"><a href="多样本分析.html#cb53-3" tabindex="-1"></a>                             <span class="at">scale.factor =</span> <span class="fl">1e4</span>)</span>
<span id="cb53-4"><a href="多样本分析.html#cb53-4" tabindex="-1"></a>sce.all <span class="ot">&lt;-</span> <span class="fu">FindVariableFeatures</span>(sce.all)</span>
<span id="cb53-5"><a href="多样本分析.html#cb53-5" tabindex="-1"></a>sce.all <span class="ot">&lt;-</span> <span class="fu">ScaleData</span>(sce.all)</span>
<span id="cb53-6"><a href="多样本分析.html#cb53-6" tabindex="-1"></a>sce.all <span class="ot">&lt;-</span> <span class="fu">RunPCA</span>(sce.all, <span class="at">features =</span> <span class="fu">VariableFeatures</span>(<span class="at">object =</span> sce.all))</span>
<span id="cb53-7"><a href="多样本分析.html#cb53-7" tabindex="-1"></a>sce.all <span class="ot">&lt;-</span> <span class="fu">RunHarmony</span>(sce.all, <span class="st">&quot;orig.ident&quot;</span>)</span>
<span id="cb53-8"><a href="多样本分析.html#cb53-8" tabindex="-1"></a>sce.all <span class="ot">&lt;-</span> <span class="fu">RunUMAP</span>(sce.all,  <span class="at">dims =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>, </span>
<span id="cb53-9"><a href="多样本分析.html#cb53-9" tabindex="-1"></a>                       <span class="at">reduction =</span> <span class="st">&quot;harmony&quot;</span>)</span>
<span id="cb53-10"><a href="多样本分析.html#cb53-10" tabindex="-1"></a><span class="co"># sce.all &lt;- RunTSNE(sce.all,  dims = 1:15, </span></span>
<span id="cb53-11"><a href="多样本分析.html#cb53-11" tabindex="-1"></a><span class="co">#                        reduction = &quot;harmony&quot;)</span></span>
<span id="cb53-12"><a href="多样本分析.html#cb53-12" tabindex="-1"></a><span class="fu">names</span>(sce.all<span class="sc">@</span>reductions)</span>
<span id="cb53-13"><a href="多样本分析.html#cb53-13" tabindex="-1"></a><span class="do">## [1] &quot;pca&quot;     &quot;harmony&quot; &quot;umap&quot;</span></span></code></pre></div>
<p>harmony使用前后区别</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="多样本分析.html#cb54-1" tabindex="-1"></a>seuratObj <span class="ot">&lt;-</span> <span class="fu">RunUMAP</span>(sce.all,  <span class="at">dims =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>,</span>
<span id="cb54-2"><a href="多样本分析.html#cb54-2" tabindex="-1"></a>                     <span class="at">reduction =</span> <span class="st">&quot;pca&quot;</span>)</span>
<span id="cb54-3"><a href="多样本分析.html#cb54-3" tabindex="-1"></a></span>
<span id="cb54-4"><a href="多样本分析.html#cb54-4" tabindex="-1"></a><span class="fu">DimPlot</span>(seuratObj, <span class="at">reduction =</span> <span class="st">&quot;umap&quot;</span>, <span class="at">group.by =</span> <span class="st">&quot;orig.ident&quot;</span>) <span class="sc">+</span>  </span>
<span id="cb54-5"><a href="多样本分析.html#cb54-5" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;harmony_before&quot;</span>)<span class="sc">|</span> <span class="co"># 未使用harmony</span></span>
<span id="cb54-6"><a href="多样本分析.html#cb54-6" tabindex="-1"></a><span class="fu">DimPlot</span>(sce.all, <span class="at">reduction =</span> <span class="st">&quot;umap&quot;</span>, <span class="at">group.by =</span> <span class="st">&quot;orig.ident&quot;</span>) <span class="sc">+</span></span>
<span id="cb54-7"><a href="多样本分析.html#cb54-7" tabindex="-1"></a>   <span class="fu">ggtitle</span>(<span class="st">&quot;harmony_later&quot;</span>) <span class="co"># 使用harmony</span></span></code></pre></div>
<p><img src="04-multi_files/figure-html/unnamed-chunk-8-1.png" width="1152" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="多样本分析.html#cb55-1" tabindex="-1"></a>sce.all <span class="ot">&lt;-</span> <span class="fu">FindNeighbors</span>(sce.all, <span class="at">reduction =</span> <span class="st">&quot;harmony&quot;</span>,</span>
<span id="cb55-2"><a href="多样本分析.html#cb55-2" tabindex="-1"></a>                             <span class="at">dims =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>) </span></code></pre></div>
<p>设置不同的分辨率，观察分群效果，进而选择最佳分辨率</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="多样本分析.html#cb56-1" tabindex="-1"></a><span class="fu">apply</span>(sce.all<span class="sc">@</span>meta.data[,<span class="fu">grep</span>(<span class="st">&quot;RNA_snn&quot;</span>,<span class="fu">colnames</span>(sce.all<span class="sc">@</span>meta.data))],<span class="dv">2</span>,table)</span>
<span id="cb56-2"><a href="多样本分析.html#cb56-2" tabindex="-1"></a><span class="do">## $RNA_snn_res.0.01</span></span>
<span id="cb56-3"><a href="多样本分析.html#cb56-3" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb56-4"><a href="多样本分析.html#cb56-4" tabindex="-1"></a><span class="do">##    0    1    2    3    4    5    6 </span></span>
<span id="cb56-5"><a href="多样本分析.html#cb56-5" tabindex="-1"></a><span class="do">## 6970 6138 3145 1294 1154  833  735 </span></span>
<span id="cb56-6"><a href="多样本分析.html#cb56-6" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb56-7"><a href="多样本分析.html#cb56-7" tabindex="-1"></a><span class="do">## $RNA_snn_res.0.05</span></span>
<span id="cb56-8"><a href="多样本分析.html#cb56-8" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb56-9"><a href="多样本分析.html#cb56-9" tabindex="-1"></a><span class="do">##    0    1    2    3    4    5    6    7    8    9 </span></span>
<span id="cb56-10"><a href="多样本分析.html#cb56-10" tabindex="-1"></a><span class="do">## 6834 5722 3145 1293 1154  834  735  358  137   57 </span></span>
<span id="cb56-11"><a href="多样本分析.html#cb56-11" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb56-12"><a href="多样本分析.html#cb56-12" tabindex="-1"></a><span class="do">## $RNA_snn_res.0.1</span></span>
<span id="cb56-13"><a href="多样本分析.html#cb56-13" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb56-14"><a href="多样本分析.html#cb56-14" tabindex="-1"></a><span class="do">##    0    1   10    2    3    4    5    6    7    8    9 </span></span>
<span id="cb56-15"><a href="多样本分析.html#cb56-15" tabindex="-1"></a><span class="do">## 6832 4922   57 3145 1295 1154  834  800  735  358  137 </span></span>
<span id="cb56-16"><a href="多样本分析.html#cb56-16" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb56-17"><a href="多样本分析.html#cb56-17" tabindex="-1"></a><span class="do">## $RNA_snn_res.0.2</span></span>
<span id="cb56-18"><a href="多样本分析.html#cb56-18" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb56-19"><a href="多样本分析.html#cb56-19" tabindex="-1"></a><span class="do">##    0    1   10   11    2    3    4    5    6    7    8    9 </span></span>
<span id="cb56-20"><a href="多样本分析.html#cb56-20" tabindex="-1"></a><span class="do">## 6550 4791   57   22 3121 1294 1216 1154  834  735  358  137 </span></span>
<span id="cb56-21"><a href="多样本分析.html#cb56-21" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb56-22"><a href="多样本分析.html#cb56-22" tabindex="-1"></a><span class="do">## $RNA_snn_res.0.3</span></span>
<span id="cb56-23"><a href="多样本分析.html#cb56-23" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb56-24"><a href="多样本分析.html#cb56-24" tabindex="-1"></a><span class="do">##    0    1   10   11   12    2    3    4    5    6    7    8    9 </span></span>
<span id="cb56-25"><a href="多样本分析.html#cb56-25" tabindex="-1"></a><span class="do">## 6548 4768  137   83   22 2533 1293 1153  928  877  834  735  358 </span></span>
<span id="cb56-26"><a href="多样本分析.html#cb56-26" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb56-27"><a href="多样本分析.html#cb56-27" tabindex="-1"></a><span class="do">## $RNA_snn_res.0.5</span></span>
<span id="cb56-28"><a href="多样本分析.html#cb56-28" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb56-29"><a href="多样本分析.html#cb56-29" tabindex="-1"></a><span class="do">##    0    1   10   11   12   13   14   15   16   17   18    2    3    4    5    6 </span></span>
<span id="cb56-30"><a href="多样本分析.html#cb56-30" tabindex="-1"></a><span class="do">## 6057 4427  522  358  259  236  166  135   67   57   22 2536 1225 1128  740  599 </span></span>
<span id="cb56-31"><a href="多样本分析.html#cb56-31" tabindex="-1"></a><span class="do">##    7    8    9 </span></span>
<span id="cb56-32"><a href="多样本分析.html#cb56-32" tabindex="-1"></a><span class="do">##  582  580  573 </span></span>
<span id="cb56-33"><a href="多样本分析.html#cb56-33" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb56-34"><a href="多样本分析.html#cb56-34" tabindex="-1"></a><span class="do">## $RNA_snn_res.0.8</span></span>
<span id="cb56-35"><a href="多样本分析.html#cb56-35" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb56-36"><a href="多样本分析.html#cb56-36" tabindex="-1"></a><span class="do">##    0    1   10   11   12   13   14   15   16   17   18   19    2   20   21   22 </span></span>
<span id="cb56-37"><a href="多样本分析.html#cb56-37" tabindex="-1"></a><span class="do">## 3590 2144  569  553  522  397  285  266  265  254  225  213 2122  183  158  135 </span></span>
<span id="cb56-38"><a href="多样本分析.html#cb56-38" tabindex="-1"></a><span class="do">##   23   24   25   26    3    4    5    6    7    8    9 </span></span>
<span id="cb56-39"><a href="多样本分析.html#cb56-39" tabindex="-1"></a><span class="do">##  123   92   83   67 2062 2006 1225  801  740  605  584 </span></span>
<span id="cb56-40"><a href="多样本分析.html#cb56-40" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb56-41"><a href="多样本分析.html#cb56-41" tabindex="-1"></a><span class="do">## $RNA_snn_res.1</span></span>
<span id="cb56-42"><a href="多样本分析.html#cb56-42" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb56-43"><a href="多样本分析.html#cb56-43" tabindex="-1"></a><span class="do">##    0    1   10   11   12   13   14   15   16   17   18   19    2   20   21   22 </span></span>
<span id="cb56-44"><a href="多样本分析.html#cb56-44" tabindex="-1"></a><span class="do">## 3325 2170  584  574  569  513  386  266  256  236  213  185 2114  163  136  135 </span></span>
<span id="cb56-45"><a href="多样本分析.html#cb56-45" tabindex="-1"></a><span class="do">##   23   24   25    3    4    5    6    7    8    9 </span></span>
<span id="cb56-46"><a href="多样本分析.html#cb56-46" tabindex="-1"></a><span class="do">##  114   92   83 2043 1962 1179  827  797  735  612</span></span></code></pre></div>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="多样本分析.html#cb57-1" tabindex="-1"></a>p1_dim<span class="ot">=</span><span class="fu">plot_grid</span>(<span class="at">ncol =</span> <span class="dv">3</span>, </span>
<span id="cb57-2"><a href="多样本分析.html#cb57-2" tabindex="-1"></a>                 <span class="fu">DimPlot</span>(sce.all, <span class="at">reduction =</span> <span class="st">&quot;umap&quot;</span>, <span class="at">group.by =</span> <span class="st">&quot;RNA_snn_res.0.01&quot;</span>) <span class="sc">+</span></span>
<span id="cb57-3"><a href="多样本分析.html#cb57-3" tabindex="-1"></a>                   <span class="fu">ggtitle</span>(<span class="st">&quot;louvain_0.01&quot;</span>), </span>
<span id="cb57-4"><a href="多样本分析.html#cb57-4" tabindex="-1"></a>                 <span class="fu">DimPlot</span>(sce.all, <span class="at">reduction =</span> <span class="st">&quot;umap&quot;</span>, <span class="at">group.by =</span> <span class="st">&quot;RNA_snn_res.0.5&quot;</span>) <span class="sc">+</span></span>
<span id="cb57-5"><a href="多样本分析.html#cb57-5" tabindex="-1"></a>                   <span class="fu">ggtitle</span>(<span class="st">&quot;louvain_0.05&quot;</span>),</span>
<span id="cb57-6"><a href="多样本分析.html#cb57-6" tabindex="-1"></a>                 <span class="fu">DimPlot</span>(sce.all, <span class="at">reduction =</span> <span class="st">&quot;umap&quot;</span>, <span class="at">group.by =</span> <span class="st">&quot;RNA_snn_res.0.1&quot;</span>) <span class="sc">+</span></span>
<span id="cb57-7"><a href="多样本分析.html#cb57-7" tabindex="-1"></a>                   <span class="fu">ggtitle</span>(<span class="st">&quot;louvain_0.1&quot;</span>),</span>
<span id="cb57-8"><a href="多样本分析.html#cb57-8" tabindex="-1"></a>                 <span class="fu">DimPlot</span>(sce.all, <span class="at">reduction =</span> <span class="st">&quot;umap&quot;</span>, <span class="at">group.by =</span> <span class="st">&quot;RNA_snn_res.0.2&quot;</span>) <span class="sc">+</span></span>
<span id="cb57-9"><a href="多样本分析.html#cb57-9" tabindex="-1"></a>                   <span class="fu">ggtitle</span>(<span class="st">&quot;louvain_0.2&quot;</span>),</span>
<span id="cb57-10"><a href="多样本分析.html#cb57-10" tabindex="-1"></a>                  <span class="fu">DimPlot</span>(sce.all, <span class="at">reduction =</span> <span class="st">&quot;umap&quot;</span>, <span class="at">group.by =</span> <span class="st">&quot;RNA_snn_res.0.3&quot;</span>) <span class="sc">+</span></span>
<span id="cb57-11"><a href="多样本分析.html#cb57-11" tabindex="-1"></a>                   <span class="fu">ggtitle</span>(<span class="st">&quot;louvain_0.3&quot;</span>),</span>
<span id="cb57-12"><a href="多样本分析.html#cb57-12" tabindex="-1"></a>                  <span class="fu">DimPlot</span>(sce.all, <span class="at">reduction =</span> <span class="st">&quot;umap&quot;</span>, <span class="at">group.by =</span> <span class="st">&quot;RNA_snn_res.0.5&quot;</span>) <span class="sc">+</span></span>
<span id="cb57-13"><a href="多样本分析.html#cb57-13" tabindex="-1"></a>                   <span class="fu">ggtitle</span>(<span class="st">&quot;louvain_0.5&quot;</span>),</span>
<span id="cb57-14"><a href="多样本分析.html#cb57-14" tabindex="-1"></a>                  <span class="fu">DimPlot</span>(sce.all, <span class="at">reduction =</span> <span class="st">&quot;umap&quot;</span>, <span class="at">group.by =</span> <span class="st">&quot;RNA_snn_res.0.8&quot;</span>) <span class="sc">+</span></span>
<span id="cb57-15"><a href="多样本分析.html#cb57-15" tabindex="-1"></a>                   <span class="fu">ggtitle</span>(<span class="st">&quot;louvain_0.8&quot;</span>),</span>
<span id="cb57-16"><a href="多样本分析.html#cb57-16" tabindex="-1"></a>                  <span class="fu">DimPlot</span>(sce.all, <span class="at">reduction =</span> <span class="st">&quot;umap&quot;</span>, <span class="at">group.by =</span> <span class="st">&quot;RNA_snn_res.1&quot;</span>) <span class="sc">+</span></span>
<span id="cb57-17"><a href="多样本分析.html#cb57-17" tabindex="-1"></a>                   <span class="fu">ggtitle</span>(<span class="st">&quot;louvain_1&quot;</span>));p1_dim</span></code></pre></div>
<p><img src="04-multi_files/figure-html/unnamed-chunk-12-1.png" width="1152" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="多样本分析.html#cb58-1" tabindex="-1"></a>p2_tree<span class="ot">=</span><span class="fu">clustree</span>(sce.all<span class="sc">@</span>meta.data, <span class="at">prefix =</span> <span class="st">&quot;RNA_snn_res.&quot;</span>);p2_tree</span></code></pre></div>
<p><img src="04-multi_files/figure-html/unnamed-chunk-13-1.png" width="1152" style="display: block; margin: auto;" /></p>
</div>
<div id="检查marker基因" class="section level2 unnumbered hasAnchor">
<h2>检查marker基因<a href="多样本分析.html#检查marker基因" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>选择需要的阈值，可视化一些marker基因辅助后续的单细胞亚群定义
这里直接选0.8</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="多样本分析.html#cb59-1" tabindex="-1"></a>sel.clust <span class="ot">=</span> <span class="st">&quot;RNA_snn_res.0.8&quot;</span></span>
<span id="cb59-2"><a href="多样本分析.html#cb59-2" tabindex="-1"></a>sce.all <span class="ot">&lt;-</span> <span class="fu">SetIdent</span>(sce.all, <span class="at">value =</span> sel.clust)</span>
<span id="cb59-3"><a href="多样本分析.html#cb59-3" tabindex="-1"></a><span class="fu">table</span>(sce.all<span class="sc">@</span>active.ident) </span>
<span id="cb59-4"><a href="多样本分析.html#cb59-4" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb59-5"><a href="多样本分析.html#cb59-5" tabindex="-1"></a><span class="do">##    0    1    2    3    4    5    6    7    8    9   10   11   12   13   14   15 </span></span>
<span id="cb59-6"><a href="多样本分析.html#cb59-6" tabindex="-1"></a><span class="do">## 3590 2144 2122 2062 2006 1225  801  740  605  584  569  553  522  397  285  266 </span></span>
<span id="cb59-7"><a href="多样本分析.html#cb59-7" tabindex="-1"></a><span class="do">##   16   17   18   19   20   21   22   23   24   25   26 </span></span>
<span id="cb59-8"><a href="多样本分析.html#cb59-8" tabindex="-1"></a><span class="do">##  265  254  225  213  183  158  135  123   92   83   67</span></span></code></pre></div>
<p>可以根据经验构建自己的注释集合（可选）</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="多样本分析.html#cb60-1" tabindex="-1"></a>gastric_cancer_markers <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;PTPRC&#39;</span>, </span>
<span id="cb60-2"><a href="多样本分析.html#cb60-2" tabindex="-1"></a>                           <span class="st">&#39;MUC2&#39;</span> , <span class="st">&#39;ITLN1&#39;</span>,</span>
<span id="cb60-3"><a href="多样本分析.html#cb60-3" tabindex="-1"></a>                           <span class="st">&#39;FABP1&#39;</span> , <span class="st">&#39;APOA1&#39;</span>,</span>
<span id="cb60-4"><a href="多样本分析.html#cb60-4" tabindex="-1"></a>                           <span class="st">&#39;CEACAM5&#39;</span> , <span class="st">&#39;CEACAM6&#39;</span>,</span>
<span id="cb60-5"><a href="多样本分析.html#cb60-5" tabindex="-1"></a>                           <span class="st">&#39;EPCAM&#39;</span>, <span class="st">&#39;KRT18&#39;</span>, <span class="st">&#39;MUC1&#39;</span>,</span>
<span id="cb60-6"><a href="多样本分析.html#cb60-6" tabindex="-1"></a>                           <span class="st">&#39;MUC6&#39;</span> , <span class="st">&#39;TFF2&#39;</span>,</span>
<span id="cb60-7"><a href="多样本分析.html#cb60-7" tabindex="-1"></a>                           <span class="st">&#39;PGA4&#39;</span> , <span class="st">&#39;PGA3&#39;</span>,</span>
<span id="cb60-8"><a href="多样本分析.html#cb60-8" tabindex="-1"></a>                           <span class="st">&#39;MUC5AC&#39;</span> , <span class="st">&#39;TFF1&#39;</span>,<span class="st">&#39;CHGA&#39;</span> , <span class="st">&#39;CHGB&#39;</span>) </span>
<span id="cb60-9"><a href="多样本分析.html#cb60-9" tabindex="-1"></a></span>
<span id="cb60-10"><a href="多样本分析.html#cb60-10" tabindex="-1"></a>Myo<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;Krt17&quot;</span>, <span class="st">&quot;Krt14&quot;</span>, <span class="st">&quot;Krt5&quot;</span>, <span class="st">&quot;Acta2&quot;</span>, <span class="st">&quot;Myl9&quot;</span>, <span class="st">&quot;Mylk&quot;</span>, <span class="st">&quot;Myh11&quot;</span>)</span>
<span id="cb60-11"><a href="多样本分析.html#cb60-11" tabindex="-1"></a>Lum<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;Krt19&quot;</span>, <span class="st">&quot;Krt18&quot;</span>, <span class="st">&quot;Krt8&quot;</span>)</span>
<span id="cb60-12"><a href="多样本分析.html#cb60-12" tabindex="-1"></a>Hs<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;Prlr&quot;</span>, <span class="st">&quot;Cited1&quot;</span>, <span class="st">&quot;Pgr&quot;</span>, <span class="st">&quot;Prom1&quot;</span>, <span class="st">&quot;Esr1&quot;</span>)  </span>
<span id="cb60-13"><a href="多样本分析.html#cb60-13" tabindex="-1"></a>AV<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;Mfge8&quot;</span>, <span class="st">&quot;Trf&quot;</span>, <span class="st">&quot;Csn3&quot;</span>, <span class="st">&quot;Wfdc18&quot;</span>, <span class="st">&quot;Elf5&quot;</span>, <span class="st">&quot;Ltf&quot;</span>)</span>
<span id="cb60-14"><a href="多样本分析.html#cb60-14" tabindex="-1"></a>Lp<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;Kit&quot;</span>, <span class="st">&quot;Aldh1a3&quot;</span>, <span class="st">&quot;Cd14&quot;</span>)</span>
<span id="cb60-15"><a href="多样本分析.html#cb60-15" tabindex="-1"></a>Fib<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;Col1a1&quot;</span>, <span class="st">&quot;Col1a2&quot;</span>, <span class="st">&quot;Col3a1&quot;</span>, <span class="st">&quot;Fn1&quot;</span>)</span>
<span id="cb60-16"><a href="多样本分析.html#cb60-16" tabindex="-1"></a>GSE150580_breast_cancer_markers_list <span class="ot">=</span><span class="fu">list</span>(</span>
<span id="cb60-17"><a href="多样本分析.html#cb60-17" tabindex="-1"></a>  <span class="at">Myo=</span>Myo,</span>
<span id="cb60-18"><a href="多样本分析.html#cb60-18" tabindex="-1"></a>  <span class="at">Lum=</span>Lum,</span>
<span id="cb60-19"><a href="多样本分析.html#cb60-19" tabindex="-1"></a>  <span class="at">Hs=</span>Hs, </span>
<span id="cb60-20"><a href="多样本分析.html#cb60-20" tabindex="-1"></a>  <span class="at">AV=</span>AV,</span>
<span id="cb60-21"><a href="多样本分析.html#cb60-21" tabindex="-1"></a>  <span class="at">Lp=</span>Lp,  </span>
<span id="cb60-22"><a href="多样本分析.html#cb60-22" tabindex="-1"></a>  <span class="at">Fib=</span>Fib</span>
<span id="cb60-23"><a href="多样本分析.html#cb60-23" tabindex="-1"></a>) </span>
<span id="cb60-24"><a href="多样本分析.html#cb60-24" tabindex="-1"></a></span>
<span id="cb60-25"><a href="多样本分析.html#cb60-25" tabindex="-1"></a>macrophages<span class="ot">=</span><span class="fu">c</span>(<span class="st">&#39;Adgre1&#39;</span>, <span class="st">&#39;Cd14&#39;</span>,  <span class="st">&#39;Fcgr3&#39;</span>)</span>
<span id="cb60-26"><a href="多样本分析.html#cb60-26" tabindex="-1"></a>cDCs<span class="ot">=</span><span class="fu">c</span>(<span class="st">&#39;Xcr1&#39;</span>, <span class="st">&#39;Flt3&#39;</span>,  <span class="st">&#39;Ccr7&#39;</span>)</span>
<span id="cb60-27"><a href="多样本分析.html#cb60-27" tabindex="-1"></a>pDCs<span class="ot">=</span><span class="fu">c</span>(<span class="st">&#39;Siglech&#39;</span>, <span class="st">&#39;Clec10a&#39;</span>,  <span class="st">&#39;Clec12a&#39;</span>)  </span>
<span id="cb60-28"><a href="多样本分析.html#cb60-28" tabindex="-1"></a>monocytes<span class="ot">=</span><span class="fu">c</span>(<span class="st">&#39;Ly6c2&#39;</span> , <span class="st">&#39;Spn&#39;</span>)</span>
<span id="cb60-29"><a href="多样本分析.html#cb60-29" tabindex="-1"></a>neutrophils<span class="ot">=</span><span class="fu">c</span>(<span class="st">&#39;Csf3r&#39;</span>, <span class="st">&#39;S100a8&#39;</span>,  <span class="st">&#39;Cxcl3&#39;</span>) </span>
<span id="cb60-30"><a href="多样本分析.html#cb60-30" tabindex="-1"></a>SCP1661_meyloids_markers_list <span class="ot">=</span><span class="fu">list</span>(</span>
<span id="cb60-31"><a href="多样本分析.html#cb60-31" tabindex="-1"></a>  <span class="at">macrophages=</span>macrophages,</span>
<span id="cb60-32"><a href="多样本分析.html#cb60-32" tabindex="-1"></a>  <span class="at">cDCs=</span>cDCs,</span>
<span id="cb60-33"><a href="多样本分析.html#cb60-33" tabindex="-1"></a>  <span class="at">pDCs=</span>pDCs, </span>
<span id="cb60-34"><a href="多样本分析.html#cb60-34" tabindex="-1"></a>  <span class="at">monocytes=</span>monocytes,</span>
<span id="cb60-35"><a href="多样本分析.html#cb60-35" tabindex="-1"></a>  <span class="at">neutrophils=</span>neutrophils  </span>
<span id="cb60-36"><a href="多样本分析.html#cb60-36" tabindex="-1"></a>) </span>
<span id="cb60-37"><a href="多样本分析.html#cb60-37" tabindex="-1"></a></span>
<span id="cb60-38"><a href="多样本分析.html#cb60-38" tabindex="-1"></a>lung_epi_markers <span class="ot">=</span>  <span class="fu">c</span>(<span class="st">&#39;TPPP3&#39;</span>,<span class="st">&quot;SPRR3&quot;</span>,<span class="st">&quot;GDPD3&quot;</span>,<span class="st">&quot;SPRR1A&quot;</span>,<span class="st">&quot;SPRR2A&quot;</span>,<span class="st">&quot;RARRES2&quot;</span>,<span class="st">&quot;TMPRSS11E&quot;</span>,</span>
<span id="cb60-39"><a href="多样本分析.html#cb60-39" tabindex="-1"></a>                      <span class="st">&quot;ASCL3&quot;</span>,<span class="st">&quot;CFTR&quot;</span>,<span class="st">&quot;FOXI2&quot;</span>,<span class="st">&quot;1SG20&quot;</span>,<span class="st">&quot;FOXI1&quot;</span>,</span>
<span id="cb60-40"><a href="多样本分析.html#cb60-40" tabindex="-1"></a>                      <span class="st">&quot;SAA4&quot;</span>,<span class="st">&quot;SAA2&quot;</span>,<span class="st">&quot;EFHC1&quot;</span>,<span class="st">&quot;CCDC153&quot;</span>,<span class="st">&quot;CCDC113&quot;</span>,<span class="st">&quot;SAA1&quot;</span>,<span class="st">&quot;CDC20B&quot;</span>,<span class="st">&quot;FOXJ1&quot;</span>,</span>
<span id="cb60-41"><a href="多样本分析.html#cb60-41" tabindex="-1"></a>                      <span class="st">&quot;MYCL&quot;</span>,<span class="st">&quot;FOXN4&quot;</span>,<span class="st">&quot;CCNO&quot;</span>,</span>
<span id="cb60-42"><a href="多样本分析.html#cb60-42" tabindex="-1"></a>                      <span class="st">&quot;PIGR&quot;</span>,<span class="st">&quot;BP1&quot;</span>,<span class="st">&quot;MUC5A&quot;</span>,<span class="st">&quot;VMO1&quot;</span>,<span class="st">&quot;SCGB3A1&quot;</span>,<span class="st">&quot;CYP2A13&quot;</span>,<span class="st">&quot;CYP2B6&quot;</span>,<span class="st">&quot;SCGB1A1&quot;</span>,</span>
<span id="cb60-43"><a href="多样本分析.html#cb60-43" tabindex="-1"></a>                      <span class="st">&quot;BCAM&quot;</span>,<span class="st">&quot;KRT15&quot;</span>,<span class="st">&quot;KRT5&quot;</span>,<span class="st">&quot;TP63&quot;</span>)</span>
<span id="cb60-44"><a href="多样本分析.html#cb60-44" tabindex="-1"></a></span>
<span id="cb60-45"><a href="多样本分析.html#cb60-45" tabindex="-1"></a>myeloids_markers_list1 <span class="ot">=</span><span class="fu">list</span>(</span>
<span id="cb60-46"><a href="多样本分析.html#cb60-46" tabindex="-1"></a>  <span class="at">CM=</span><span class="fu">c</span>(<span class="st">&quot;TTN&quot;</span>,<span class="st">&quot;MYH7&quot;</span>,<span class="st">&quot;MYH6&quot;</span>,<span class="st">&quot;TNNT2&quot;</span>) ,</span>
<span id="cb60-47"><a href="多样本分析.html#cb60-47" tabindex="-1"></a>  <span class="at">EC=</span><span class="fu">c</span>(<span class="st">&quot;VWF&quot;</span>, <span class="st">&quot;IFI27&quot;</span>, <span class="st">&quot;PECAM1&quot;</span>,<span class="st">&quot;MGP&quot;</span>),</span>
<span id="cb60-48"><a href="多样本分析.html#cb60-48" tabindex="-1"></a>  <span class="at">FB=</span><span class="fu">c</span>(<span class="st">&quot;DCN&quot;</span>, <span class="st">&quot;C7&quot;</span> ,<span class="st">&quot;LUM&quot;</span>,<span class="st">&quot;FBLN1&quot;</span>,<span class="st">&quot;COL1A2&quot;</span>),</span>
<span id="cb60-49"><a href="多样本分析.html#cb60-49" tabindex="-1"></a>  <span class="at">MP=</span><span class="fu">c</span>(<span class="st">&quot;CD163&quot;</span>, <span class="st">&quot;CCL4&quot;</span>, <span class="st">&quot;CXCL8&quot;</span>,<span class="st">&quot;PTPRC&quot;</span>),</span>
<span id="cb60-50"><a href="多样本分析.html#cb60-50" tabindex="-1"></a>  <span class="at">SMC=</span><span class="fu">c</span>(<span class="st">&quot;ACTA2&quot;</span>, <span class="st">&quot;CALD1&quot;</span>, <span class="st">&quot;MYH11&quot;</span>),</span>
<span id="cb60-51"><a href="多样本分析.html#cb60-51" tabindex="-1"></a>  <span class="at">Tc=</span><span class="fu">c</span>(<span class="st">&quot;CD3D&quot;</span>,<span class="st">&quot;CD3E&quot;</span>),</span>
<span id="cb60-52"><a href="多样本分析.html#cb60-52" tabindex="-1"></a>  <span class="at">DC1 =</span> <span class="fu">c</span>( <span class="st">&#39;Clec9a&#39;</span>, <span class="st">&#39;Xcr1&#39;</span>,   <span class="st">&#39;Wdfy4&#39;</span>), </span>
<span id="cb60-53"><a href="多样本分析.html#cb60-53" tabindex="-1"></a>  <span class="at">DC2 =</span> <span class="fu">c</span>(<span class="st">&#39;Itgax&#39;</span>, <span class="st">&#39;Sirpa&#39;</span>,   <span class="st">&#39;Cd209a&#39;</span>), </span>
<span id="cb60-54"><a href="多样本分析.html#cb60-54" tabindex="-1"></a>  <span class="at">mregDCs=</span> <span class="fu">c</span>(<span class="st">&#39;Ccr7&#39;</span>, <span class="st">&#39;Cd80&#39;</span>, <span class="st">&#39;Cd200&#39;</span>,   <span class="st">&#39;Cd247&#39;</span>) ,</span>
<span id="cb60-55"><a href="多样本分析.html#cb60-55" tabindex="-1"></a>  <span class="at">hypoxia=</span><span class="fu">c</span>(<span class="st">&#39;Hif1a&#39;</span>, <span class="st">&#39;Slc2a1&#39;</span>, <span class="st">&#39;Vegfa&#39;</span>, <span class="st">&#39;Hmox1&#39;</span>, </span>
<span id="cb60-56"><a href="多样本分析.html#cb60-56" tabindex="-1"></a>            <span class="st">&#39;Bnip3&#39;</span>, <span class="st">&#39;Nos2&#39;</span>, <span class="st">&#39;Mmp2&#39;</span>, <span class="st">&#39;Sod3&#39;</span>, </span>
<span id="cb60-57"><a href="多样本分析.html#cb60-57" tabindex="-1"></a>            <span class="st">&#39;Cited2&#39;</span>, <span class="st">&#39;Ldha&#39;</span>),</span>
<span id="cb60-58"><a href="多样本分析.html#cb60-58" tabindex="-1"></a>  <span class="at">peric=</span><span class="fu">c</span>(<span class="st">&quot;ABCC9&quot;</span>,<span class="st">&quot;PDGFRB&quot;</span>,<span class="st">&quot;RGS5&quot;</span>)</span>
<span id="cb60-59"><a href="多样本分析.html#cb60-59" tabindex="-1"></a>)</span>
<span id="cb60-60"><a href="多样本分析.html#cb60-60" tabindex="-1"></a></span>
<span id="cb60-61"><a href="多样本分析.html#cb60-61" tabindex="-1"></a>myeloids_markers_list2 <span class="ot">=</span> <span class="fu">list</span>(<span class="at">pDC =</span> <span class="fu">c</span>(<span class="st">&quot;CLEC4C&quot;</span>,<span class="st">&quot;IRF7&quot;</span>,<span class="st">&quot;TCF4&quot;</span>,<span class="st">&quot;GZMB&quot;</span>),</span>
<span id="cb60-62"><a href="多样本分析.html#cb60-62" tabindex="-1"></a>                              <span class="at">cDC1 =</span> <span class="fu">c</span>(<span class="st">&quot;XCR1&quot;</span>,<span class="st">&quot;CLNK&quot;</span>,<span class="st">&quot;CLEC9A&quot;</span>),</span>
<span id="cb60-63"><a href="多样本分析.html#cb60-63" tabindex="-1"></a>                              <span class="at">cDC2 =</span> <span class="fu">c</span>(<span class="st">&quot;FCER1A&quot;</span>,<span class="st">&quot;HLA-DPB1&quot;</span>,<span class="st">&quot;HLA-DQB1&quot;</span>,<span class="st">&quot;CD1E&quot;</span>,<span class="st">&quot;CD1C&quot;</span>,<span class="st">&quot;CLEC10A&quot;</span>,<span class="st">&quot;HLA-DQA2&quot;</span>),</span>
<span id="cb60-64"><a href="多样本分析.html#cb60-64" tabindex="-1"></a>                              <span class="at">DC3 =</span> <span class="fu">c</span>(<span class="st">&quot;CCL19&quot;</span>,<span class="st">&quot;LAMP3&quot;</span>,<span class="st">&quot;IDO1&quot;</span>,<span class="st">&quot;IDO2&quot;</span>,<span class="st">&quot;LAD1&quot;</span>,<span class="st">&quot;FSCN1&quot;</span>,<span class="st">&quot;CCR7&quot;</span>,<span class="st">&quot;LY75&quot;</span>,<span class="st">&quot;CCL22&quot;</span>,<span class="st">&quot;CD40&quot;</span>,<span class="st">&quot;BIRC3&quot;</span>,<span class="st">&quot;NFKB2&quot;</span>),</span>
<span id="cb60-65"><a href="多样本分析.html#cb60-65" tabindex="-1"></a>                              <span class="at">Macrophages =</span> <span class="fu">c</span>(<span class="st">&quot;APOC1&quot;</span>,<span class="st">&quot;HLA-DRB5&quot;</span>,<span class="st">&quot;C1QA&quot;</span>,<span class="st">&quot;C1QB&quot;</span>),</span>
<span id="cb60-66"><a href="多样本分析.html#cb60-66" tabindex="-1"></a>                              <span class="at">RTMs =</span> <span class="fu">c</span>(<span class="st">&quot;THBS1&quot;</span>),<span class="co">#Resident tissue macrophages</span></span>
<span id="cb60-67"><a href="多样本分析.html#cb60-67" tabindex="-1"></a>                              <span class="at">Lam =</span> <span class="fu">c</span>(<span class="st">&quot;APOE&quot;</span>),<span class="co">#Lipid associated macrophages</span></span>
<span id="cb60-68"><a href="多样本分析.html#cb60-68" tabindex="-1"></a>                              <span class="at">Monocytes =</span> <span class="fu">c</span>(<span class="st">&quot;LYZ&quot;</span>,<span class="st">&quot;HLA-DRB1&quot;</span>,<span class="st">&quot;TIMP1&quot;</span>,<span class="st">&quot;S100A11&quot;</span>,<span class="st">&quot;CXCL8&quot;</span>,<span class="st">&quot;IL1B&quot;</span>,<span class="st">&quot;PTGS2&quot;</span>,<span class="st">&quot;S100A9&quot;</span>,<span class="st">&quot;S100A8&quot;</span>,<span class="st">&quot;MMP19&quot;</span>),</span>
<span id="cb60-69"><a href="多样本分析.html#cb60-69" tabindex="-1"></a>                              <span class="at">Mono_C =</span> <span class="fu">c</span>(<span class="st">&#39;CD14&#39;</span>),<span class="co">#Mono_CD14</span></span>
<span id="cb60-70"><a href="多样本分析.html#cb60-70" tabindex="-1"></a>                              <span class="at">Mono_F =</span> <span class="fu">c</span>(<span class="st">&#39;FCGR3A&#39;</span>),<span class="co">#Mono_FCGR3A</span></span>
<span id="cb60-71"><a href="多样本分析.html#cb60-71" tabindex="-1"></a>                              <span class="at">Mast =</span> <span class="fu">c</span>(<span class="st">&#39;TPSAB1&#39;</span> , <span class="st">&#39;TPSB2&#39;</span>))</span>
<span id="cb60-72"><a href="多样本分析.html#cb60-72" tabindex="-1"></a></span>
<span id="cb60-73"><a href="多样本分析.html#cb60-73" tabindex="-1"></a></span>
<span id="cb60-74"><a href="多样本分析.html#cb60-74" tabindex="-1"></a>Tcells_markers <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;PTPRC&#39;</span>, <span class="st">&#39;CD3D&#39;</span>, <span class="st">&#39;CD3E&#39;</span>, <span class="st">&#39;CD4&#39;</span>,<span class="st">&#39;CD8A&#39;</span>,</span>
<span id="cb60-75"><a href="多样本分析.html#cb60-75" tabindex="-1"></a>                   <span class="st">&#39;CCR7&#39;</span>, <span class="st">&#39;SELL&#39;</span> , <span class="st">&#39;TCF7&#39;</span>,<span class="st">&#39;CXCR6&#39;</span> , <span class="st">&#39;ITGA1&#39;</span>,</span>
<span id="cb60-76"><a href="多样本分析.html#cb60-76" tabindex="-1"></a>                   <span class="st">&#39;FOXP3&#39;</span>, <span class="st">&#39;IL2RA&#39;</span>,  <span class="st">&#39;CTLA4&#39;</span>,<span class="st">&#39;GZMB&#39;</span>, <span class="st">&#39;GZMK&#39;</span>,<span class="st">&#39;CCL5&#39;</span>,</span>
<span id="cb60-77"><a href="多样本分析.html#cb60-77" tabindex="-1"></a>                   <span class="st">&#39;IFNG&#39;</span>, <span class="st">&#39;CCL4&#39;</span>, <span class="st">&#39;CCL3&#39;</span> ,</span>
<span id="cb60-78"><a href="多样本分析.html#cb60-78" tabindex="-1"></a>                   <span class="st">&#39;PRF1&#39;</span> , <span class="st">&#39;NKG7&#39;</span>) </span>
<span id="cb60-79"><a href="多样本分析.html#cb60-79" tabindex="-1"></a></span>
<span id="cb60-80"><a href="多样本分析.html#cb60-80" tabindex="-1"></a><span class="co"># CD4T</span></span>
<span id="cb60-81"><a href="多样本分析.html#cb60-81" tabindex="-1"></a>CD4_markers_list <span class="ot">=</span><span class="fu">list</span>(</span>
<span id="cb60-82"><a href="多样本分析.html#cb60-82" tabindex="-1"></a>  <span class="at">Tc=</span><span class="fu">c</span>(<span class="st">&quot;CD3D&quot;</span>,<span class="st">&quot;CD3E&quot;</span>),</span>
<span id="cb60-83"><a href="多样本分析.html#cb60-83" tabindex="-1"></a>  <span class="at">CD4=</span><span class="fu">c</span>(<span class="st">&quot;CD4&quot;</span> ),</span>
<span id="cb60-84"><a href="多样本分析.html#cb60-84" tabindex="-1"></a>  <span class="at">Treg=</span><span class="fu">c</span>(<span class="st">&quot;TNFRSF4&quot;</span>,<span class="st">&quot;BATF&quot;</span>,<span class="st">&quot;TNFRSF18&quot;</span>,<span class="st">&quot;FOXP3&quot;</span>,<span class="st">&quot;IL2RA&quot;</span>,<span class="st">&quot;IKZF2&quot;</span>),</span>
<span id="cb60-85"><a href="多样本分析.html#cb60-85" tabindex="-1"></a>  <span class="at">naive=</span><span class="fu">c</span>(<span class="st">&quot;CCR7&quot;</span>,<span class="st">&quot;SELL&quot;</span>,<span class="st">&quot;CD5&quot;</span>),</span>
<span id="cb60-86"><a href="多样本分析.html#cb60-86" tabindex="-1"></a>  <span class="at">Tfh=</span><span class="fu">c</span>(<span class="st">&quot;CXCR5&quot;</span>,<span class="st">&quot;BCL6&quot;</span>,<span class="st">&quot;ICA1&quot;</span>,<span class="st">&quot;TOX&quot;</span>,<span class="st">&quot;TOX2&quot;</span>,<span class="st">&quot;IL6ST&quot;</span>),<span class="co">#滤泡辅助性T细胞</span></span>
<span id="cb60-87"><a href="多样本分析.html#cb60-87" tabindex="-1"></a>  <span class="at">ILC=</span><span class="fu">c</span>(<span class="st">&quot;TNFRSF25&quot;</span>,<span class="st">&quot;KRT81&quot;</span>,<span class="st">&quot;LST1&quot;</span>,<span class="st">&quot;AREG&quot;</span>,<span class="st">&quot;LTB&quot;</span>,<span class="st">&quot;CD69&quot;</span>)</span>
<span id="cb60-88"><a href="多样本分析.html#cb60-88" tabindex="-1"></a>) </span>
<span id="cb60-89"><a href="多样本分析.html#cb60-89" tabindex="-1"></a></span>
<span id="cb60-90"><a href="多样本分析.html#cb60-90" tabindex="-1"></a><span class="co"># CD8T</span></span>
<span id="cb60-91"><a href="多样本分析.html#cb60-91" tabindex="-1"></a>CD8_markers_list1 <span class="ot">=</span><span class="fu">list</span>(</span>
<span id="cb60-92"><a href="多样本分析.html#cb60-92" tabindex="-1"></a>  <span class="at">CD8=</span><span class="fu">c</span>(<span class="st">&quot;CD8A&quot;</span>,<span class="st">&quot;CD8B&quot;</span>),</span>
<span id="cb60-93"><a href="多样本分析.html#cb60-93" tabindex="-1"></a>  <span class="at">TN_TCM=</span><span class="fu">c</span>(<span class="st">&quot;CCR7&quot;</span>,<span class="st">&quot;SELL&quot;</span>,<span class="st">&quot;TCF7&quot;</span>,<span class="st">&quot;LEF1&quot;</span>),</span>
<span id="cb60-94"><a href="多样本分析.html#cb60-94" tabindex="-1"></a>  <span class="at">TEM=</span><span class="fu">c</span>(<span class="st">&quot;GZMK&quot;</span>  ),</span>
<span id="cb60-95"><a href="多样本分析.html#cb60-95" tabindex="-1"></a>  <span class="at">TEFF=</span><span class="fu">c</span>(<span class="st">&quot;TBX21&quot;</span>,<span class="st">&quot;FCGR3A&quot;</span>,<span class="st">&quot;FGFBP2&quot;</span>),</span>
<span id="cb60-96"><a href="多样本分析.html#cb60-96" tabindex="-1"></a>  <span class="at">TRM=</span><span class="fu">c</span>(<span class="st">&quot;XCL1&quot;</span>,<span class="st">&quot;XCL2&quot;</span>,<span class="st">&quot;ITGAE&quot;</span>,<span class="st">&quot;CD69&quot;</span>),</span>
<span id="cb60-97"><a href="多样本分析.html#cb60-97" tabindex="-1"></a>  <span class="at">IEL_T =</span> <span class="fu">c</span>(<span class="st">&quot;TMIGD2&quot;</span>),</span>
<span id="cb60-98"><a href="多样本分析.html#cb60-98" tabindex="-1"></a>  <span class="at">yT1c=</span><span class="fu">c</span>(<span class="st">&quot;GNLY&quot;</span>,<span class="st">&quot;PTGDS&quot;</span>,<span class="st">&quot;GZMB&quot;</span>,<span class="st">&quot;TRDC&quot;</span>),</span>
<span id="cb60-99"><a href="多样本分析.html#cb60-99" tabindex="-1"></a>  <span class="at">yT2c=</span><span class="fu">c</span>(<span class="st">&quot;TMN1&quot;</span>,<span class="st">&quot;HMGB2&quot;</span>,<span class="st">&quot;TYMS&quot;</span>),</span>
<span id="cb60-100"><a href="多样本分析.html#cb60-100" tabindex="-1"></a>  <span class="at">MAIT_T =</span> <span class="fu">c</span>(<span class="st">&quot;SLC4A10&quot;</span>)</span>
<span id="cb60-101"><a href="多样本分析.html#cb60-101" tabindex="-1"></a>) </span>
<span id="cb60-102"><a href="多样本分析.html#cb60-102" tabindex="-1"></a>CD8_markers_list2 <span class="ot">=</span><span class="fu">list</span>(</span>
<span id="cb60-103"><a href="多样本分析.html#cb60-103" tabindex="-1"></a>  <span class="at">CD8T=</span><span class="fu">c</span>(<span class="st">&quot;CD8A&quot;</span>,<span class="st">&quot;CD8B&quot;</span>),</span>
<span id="cb60-104"><a href="多样本分析.html#cb60-104" tabindex="-1"></a>  <span class="at">MAIT=</span><span class="fu">c</span>(<span class="st">&quot;ZBTB16&quot;</span>,<span class="st">&quot;NCR3&quot;</span>,<span class="st">&quot;RORA&quot;</span>),</span>
<span id="cb60-105"><a href="多样本分析.html#cb60-105" tabindex="-1"></a>  <span class="at">ExhaustedCD8T=</span><span class="fu">c</span>(<span class="st">&quot;LAG3&quot;</span>,<span class="st">&quot;TIGIT&quot;</span>,<span class="st">&quot;PDCD1&quot;</span>,<span class="st">&quot;HAVCR2&quot;</span>,<span class="st">&quot;CTLA4&quot;</span>),</span>
<span id="cb60-106"><a href="多样本分析.html#cb60-106" tabindex="-1"></a>  <span class="at">EffMemoryCD8=</span><span class="fu">c</span>(<span class="st">&quot;EOMES&quot;</span>,<span class="st">&quot;ITM2C&quot;</span>),</span>
<span id="cb60-107"><a href="多样本分析.html#cb60-107" tabindex="-1"></a>  <span class="at">Resting_NK=</span><span class="fu">c</span>(<span class="st">&quot;XCL1&quot;</span>,<span class="st">&quot;XCL2&quot;</span>,<span class="st">&quot;KLRC1&quot;</span>),</span>
<span id="cb60-108"><a href="多样本分析.html#cb60-108" tabindex="-1"></a>  <span class="at">Cytotoxic_NK=</span><span class="fu">c</span>(<span class="st">&quot;CX3CR1&quot;</span>,<span class="st">&quot;FGFBP2&quot;</span>,<span class="st">&quot;FCGR3A&quot;</span>,<span class="st">&quot;KLRD1&quot;</span>),</span>
<span id="cb60-109"><a href="多样本分析.html#cb60-109" tabindex="-1"></a>  <span class="at">Pre_exhausted=</span><span class="fu">c</span>(<span class="st">&quot;IFNG&quot;</span>,<span class="st">&quot;PRF1&quot;</span>,<span class="st">&quot;GNLY&quot;</span>,<span class="st">&quot;GZMA&quot;</span>,<span class="st">&quot;NKG7&quot;</span>,<span class="st">&quot;GZMK&quot;</span>)</span>
<span id="cb60-110"><a href="多样本分析.html#cb60-110" tabindex="-1"></a>)</span>
<span id="cb60-111"><a href="多样本分析.html#cb60-111" tabindex="-1"></a></span>
<span id="cb60-112"><a href="多样本分析.html#cb60-112" tabindex="-1"></a>cd4_and_cd8T_markers_list  <span class="ot">=</span><span class="fu">list</span>( </span>
<span id="cb60-113"><a href="多样本分析.html#cb60-113" tabindex="-1"></a>  <span class="at">naive=</span><span class="fu">c</span>(<span class="st">&quot;CCR7&quot;</span>,<span class="st">&quot;SELL&quot;</span>,<span class="st">&quot;TCF7&quot;</span>,<span class="st">&quot;IL7R&quot;</span>,<span class="st">&quot;CD27&quot;</span>,<span class="st">&quot;CD28&quot;</span>,<span class="st">&quot;LEF1&quot;</span>,<span class="st">&quot;S1PR1&quot;</span>),</span>
<span id="cb60-114"><a href="多样本分析.html#cb60-114" tabindex="-1"></a>  <span class="at">CD8Trm=</span><span class="fu">c</span>(<span class="st">&quot;XCL1&quot;</span>,<span class="st">&quot;XCL2&quot;</span>,<span class="st">&quot;MYADM&quot;</span>),</span>
<span id="cb60-115"><a href="多样本分析.html#cb60-115" tabindex="-1"></a>  <span class="at">NKTc=</span><span class="fu">c</span>(<span class="st">&quot;GNLY&quot;</span>,<span class="st">&quot;GZMA&quot;</span>), </span>
<span id="cb60-116"><a href="多样本分析.html#cb60-116" tabindex="-1"></a>  <span class="at">Tfh=</span><span class="fu">c</span>(<span class="st">&quot;CXCR5&quot;</span>,<span class="st">&quot;BCL6&quot;</span>,<span class="st">&quot;ICA1&quot;</span>,<span class="st">&quot;TOX&quot;</span>,<span class="st">&quot;TOX2&quot;</span>,<span class="st">&quot;IL6ST&quot;</span>),</span>
<span id="cb60-117"><a href="多样本分析.html#cb60-117" tabindex="-1"></a>  <span class="at">th17=</span><span class="fu">c</span>(<span class="st">&quot;IL17A&quot;</span>,<span class="st">&quot;KLRB1&quot;</span>,<span class="st">&quot;CCL20&quot;</span>,<span class="st">&quot;ANKRD28&quot;</span>,<span class="st">&quot;IL23R&quot;</span>,<span class="st">&quot;RORC&quot;</span>,<span class="st">&quot;FURIN&quot;</span>,<span class="st">&quot;CCR6&quot;</span>,<span class="st">&quot;CAPG&quot;</span>,<span class="st">&quot;IL22&quot;</span>),</span>
<span id="cb60-118"><a href="多样本分析.html#cb60-118" tabindex="-1"></a>  <span class="at">CD8Tem=</span><span class="fu">c</span>(<span class="st">&quot;CXCR4&quot;</span>,<span class="st">&quot;GZMH&quot;</span>,<span class="st">&quot;CD44&quot;</span>,<span class="st">&quot;GZMK&quot;</span>),</span>
<span id="cb60-119"><a href="多样本分析.html#cb60-119" tabindex="-1"></a>  <span class="at">Treg=</span><span class="fu">c</span>(<span class="st">&quot;FOXP3&quot;</span>,<span class="st">&quot;IL2RA&quot;</span>,<span class="st">&quot;TNFRSF18&quot;</span>,<span class="st">&quot;IKZF2&quot;</span>),</span>
<span id="cb60-120"><a href="多样本分析.html#cb60-120" tabindex="-1"></a>  <span class="at">naive=</span><span class="fu">c</span>(<span class="st">&quot;CCR7&quot;</span>,<span class="st">&quot;SELL&quot;</span>,<span class="st">&quot;TCF7&quot;</span>,<span class="st">&quot;IL7R&quot;</span>,<span class="st">&quot;CD27&quot;</span>,<span class="st">&quot;CD28&quot;</span>),</span>
<span id="cb60-121"><a href="多样本分析.html#cb60-121" tabindex="-1"></a>  <span class="at">CD8Trm=</span><span class="fu">c</span>(<span class="st">&quot;XCL1&quot;</span>,<span class="st">&quot;XCL2&quot;</span>,<span class="st">&quot;MYADM&quot;</span>), </span>
<span id="cb60-122"><a href="多样本分析.html#cb60-122" tabindex="-1"></a>  <span class="at">MAIT=</span><span class="fu">c</span>(<span class="st">&quot;KLRB1&quot;</span>,<span class="st">&quot;ZBTB16&quot;</span>,<span class="st">&quot;NCR3&quot;</span>,<span class="st">&quot;RORA&quot;</span>),</span>
<span id="cb60-123"><a href="多样本分析.html#cb60-123" tabindex="-1"></a>  <span class="at">yT1c=</span><span class="fu">c</span>(<span class="st">&quot;GNLY&quot;</span>,<span class="st">&quot;PTGDS&quot;</span>,<span class="st">&quot;GZMB&quot;</span>,<span class="st">&quot;TRDC&quot;</span>),</span>
<span id="cb60-124"><a href="多样本分析.html#cb60-124" tabindex="-1"></a>  <span class="at">yT2c=</span><span class="fu">c</span>(<span class="st">&quot;TMN1&quot;</span>,<span class="st">&quot;HMGB2&quot;</span>,<span class="st">&quot;TYMS&quot;</span>),</span>
<span id="cb60-125"><a href="多样本分析.html#cb60-125" tabindex="-1"></a>  <span class="at">yt=</span><span class="fu">c</span>(<span class="st">&quot;TRGV9&quot;</span>,<span class="st">&quot;TRDV2&quot;</span>)</span>
<span id="cb60-126"><a href="多样本分析.html#cb60-126" tabindex="-1"></a>) </span>
<span id="cb60-127"><a href="多样本分析.html#cb60-127" tabindex="-1"></a></span>
<span id="cb60-128"><a href="多样本分析.html#cb60-128" tabindex="-1"></a><span class="co"># CD20 (MS4A1)表达于除plasma B 之外的所有B，很关键的区分naive 和plasma的marker</span></span>
<span id="cb60-129"><a href="多样本分析.html#cb60-129" tabindex="-1"></a><span class="co"># SDC1 = CD138 plasma B （接受抗原，可表达抗体） </span></span>
<span id="cb60-130"><a href="多样本分析.html#cb60-130" tabindex="-1"></a>Bcels_markers_list <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb60-131"><a href="多样本分析.html#cb60-131" tabindex="-1"></a>  <span class="at">All =</span> <span class="fu">c</span>(<span class="st">&#39;MS4A1&#39;</span>,<span class="st">&#39;SDC1&#39;</span>,<span class="st">&#39;CD27&#39;</span>,<span class="st">&#39;CD38&#39;</span>,<span class="st">&#39;CD19&#39;</span>, <span class="st">&#39;CD79A&#39;</span>),</span>
<span id="cb60-132"><a href="多样本分析.html#cb60-132" tabindex="-1"></a>  <span class="at">GC_B =</span> <span class="fu">c</span>(<span class="st">&#39;IL4R&#39;</span>,<span class="st">&#39;TCL1A&#39;</span>,<span class="st">&#39;LRMP&#39;</span>,<span class="st">&#39;SUGCT&#39;</span>),</span>
<span id="cb60-133"><a href="多样本分析.html#cb60-133" tabindex="-1"></a>  <span class="at">IGA_plasm_B=</span> <span class="fu">c</span> ( <span class="st">&#39;IGHA1&#39;</span>), </span>
<span id="cb60-134"><a href="多样本分析.html#cb60-134" tabindex="-1"></a>  <span class="at">IGG_plasm_B=</span> <span class="fu">c</span> ( <span class="st">&#39;IGHG1&#39;</span>)</span>
<span id="cb60-135"><a href="多样本分析.html#cb60-135" tabindex="-1"></a>)  </span>
<span id="cb60-136"><a href="多样本分析.html#cb60-136" tabindex="-1"></a></span>
<span id="cb60-137"><a href="多样本分析.html#cb60-137" tabindex="-1"></a>Hepatic_stellate_markers_list <span class="ot">=</span><span class="fu">list</span>(</span>
<span id="cb60-138"><a href="多样本分析.html#cb60-138" tabindex="-1"></a>  <span class="at">qHSC=</span><span class="fu">c</span>(<span class="st">&quot;Lrat&quot;</span>,<span class="st">&quot;Ecm1&quot;</span>,<span class="st">&quot;Angptl6&quot;</span>,<span class="st">&quot;Vipr1&quot;</span> ),</span>
<span id="cb60-139"><a href="多样本分析.html#cb60-139" tabindex="-1"></a>  <span class="at">S1=</span><span class="fu">c</span>(<span class="st">&quot;Ccl2&quot;</span> ,<span class="st">&quot;Cxcl10&quot;</span> ,<span class="st">&quot;Cxcl1&quot;</span> ,<span class="st">&quot;Ccl7&quot;</span> ),</span>
<span id="cb60-140"><a href="多样本分析.html#cb60-140" tabindex="-1"></a>  <span class="at">S2=</span><span class="fu">c</span>(<span class="st">&quot;Acta2&quot;</span> ,<span class="st">&quot;Tpm1&quot;</span> ,<span class="st">&quot;Vim&quot;</span> ,<span class="st">&quot;Tagln&quot;</span>,<span class="st">&quot;Tnc&quot;</span>,<span class="st">&quot;Tpm2&quot;</span>),</span>
<span id="cb60-141"><a href="多样本分析.html#cb60-141" tabindex="-1"></a>  <span class="at">S3=</span><span class="fu">c</span>(<span class="st">&quot;Col1a1&quot;</span>,<span class="st">&quot;Col1a2&quot;</span>,<span class="st">&quot;Col3a1&quot;</span> ,<span class="st">&quot;Lox&quot;</span>,<span class="st">&quot;Lum&quot;</span> )</span>
<span id="cb60-142"><a href="多样本分析.html#cb60-142" tabindex="-1"></a>)</span>
<span id="cb60-143"><a href="多样本分析.html#cb60-143" tabindex="-1"></a></span>
<span id="cb60-144"><a href="多样本分析.html#cb60-144" tabindex="-1"></a><span class="co"># arteries (HEY1, IGFBP3), capillaries (CD36, CA4), veins (ACKR1) and</span></span>
<span id="cb60-145"><a href="多样本分析.html#cb60-145" tabindex="-1"></a><span class="co"># lymphatic ECs (LECs; CCL21, PROX1). </span></span>
<span id="cb60-146"><a href="多样本分析.html#cb60-146" tabindex="-1"></a>stromal_markers <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;TEK&#39;</span>,<span class="st">&quot;PTPRC&quot;</span>,<span class="st">&quot;EPCAM&quot;</span>,<span class="st">&quot;PDPN&quot;</span>,</span>
<span id="cb60-147"><a href="多样本分析.html#cb60-147" tabindex="-1"></a>                    <span class="st">&quot;PECAM1&quot;</span>,<span class="st">&#39;PDGFRB&#39;</span>,<span class="st">&quot;PLVAP&quot;</span>,<span class="st">&#39;PROX1&#39;</span>,<span class="st">&#39;ACKR1&#39;</span>,<span class="st">&#39;CA4&#39;</span>,<span class="st">&#39;HEY1&#39;</span>,</span>
<span id="cb60-148"><a href="多样本分析.html#cb60-148" tabindex="-1"></a>                    <span class="st">&#39;CSPG4&#39;</span>,<span class="st">&#39;GJB2&#39;</span>, <span class="st">&#39;RGS5&#39;</span>,<span class="st">&#39;ITGA7&#39;</span>,</span>
<span id="cb60-149"><a href="多样本分析.html#cb60-149" tabindex="-1"></a>                    <span class="st">&#39;ACTA2&#39;</span>,<span class="st">&#39;RBP1&#39;</span>,<span class="st">&#39;CD36&#39;</span>, </span>
<span id="cb60-150"><a href="多样本分析.html#cb60-150" tabindex="-1"></a>                    <span class="st">&#39;ADGRE5&#39;</span>,<span class="st">&#39;COL11A1&#39;</span>,<span class="st">&#39;FGF7&#39;</span>, <span class="st">&#39;MME&#39;</span>) </span>
<span id="cb60-151"><a href="多样本分析.html#cb60-151" tabindex="-1"></a></span>
<span id="cb60-152"><a href="多样本分析.html#cb60-152" tabindex="-1"></a>last_markers <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;PTPRC&#39;</span>, <span class="st">&#39;CD3D&#39;</span>, <span class="st">&#39;CD3E&#39;</span>, <span class="st">&#39;CD4&#39;</span>,<span class="st">&#39;CD8A&#39;</span>,</span>
<span id="cb60-153"><a href="多样本分析.html#cb60-153" tabindex="-1"></a>                 <span class="st">&#39;CD19&#39;</span>, <span class="st">&#39;CD79A&#39;</span>, <span class="st">&#39;MS4A1&#39;</span> ,</span>
<span id="cb60-154"><a href="多样本分析.html#cb60-154" tabindex="-1"></a>                 <span class="st">&#39;IGHG1&#39;</span>, <span class="st">&#39;MZB1&#39;</span>, <span class="st">&#39;SDC1&#39;</span>,</span>
<span id="cb60-155"><a href="多样本分析.html#cb60-155" tabindex="-1"></a>                 <span class="st">&#39;CD68&#39;</span>, <span class="st">&#39;CD163&#39;</span>, <span class="st">&#39;CD14&#39;</span>, </span>
<span id="cb60-156"><a href="多样本分析.html#cb60-156" tabindex="-1"></a>                 <span class="st">&#39;TPSAB1&#39;</span> , <span class="st">&#39;TPSB2&#39;</span>,  <span class="co"># mast cells,</span></span>
<span id="cb60-157"><a href="多样本分析.html#cb60-157" tabindex="-1"></a>                 <span class="st">&#39;RCVRN&#39;</span>,<span class="st">&#39;FPR1&#39;</span> , <span class="st">&#39;ITGAM&#39;</span> ,</span>
<span id="cb60-158"><a href="多样本分析.html#cb60-158" tabindex="-1"></a>                 <span class="st">&#39;C1QA&#39;</span>,  <span class="st">&#39;C1QB&#39;</span>,  <span class="co"># mac</span></span>
<span id="cb60-159"><a href="多样本分析.html#cb60-159" tabindex="-1"></a>                 <span class="st">&#39;S100A9&#39;</span>, <span class="st">&#39;S100A8&#39;</span>, <span class="st">&#39;MMP19&#39;</span>,<span class="co"># monocyte</span></span>
<span id="cb60-160"><a href="多样本分析.html#cb60-160" tabindex="-1"></a>                 <span class="st">&#39;FCGR3A&#39;</span>,</span>
<span id="cb60-161"><a href="多样本分析.html#cb60-161" tabindex="-1"></a>                 <span class="st">&#39;LAMP3&#39;</span>, <span class="st">&#39;IDO1&#39;</span>,<span class="st">&#39;IDO2&#39;</span>,<span class="do">## DC3 </span></span>
<span id="cb60-162"><a href="多样本分析.html#cb60-162" tabindex="-1"></a>                 <span class="st">&#39;CD1E&#39;</span>,<span class="st">&#39;CD1C&#39;</span>, <span class="co"># DC2</span></span>
<span id="cb60-163"><a href="多样本分析.html#cb60-163" tabindex="-1"></a>                 <span class="st">&#39;KLRB1&#39;</span>,<span class="st">&#39;NCR1&#39;</span>, <span class="co"># NK </span></span>
<span id="cb60-164"><a href="多样本分析.html#cb60-164" tabindex="-1"></a>                 <span class="st">&#39;FGF7&#39;</span>,<span class="st">&#39;MME&#39;</span>, <span class="st">&#39;ACTA2&#39;</span>, <span class="do">## human  fibo </span></span>
<span id="cb60-165"><a href="多样本分析.html#cb60-165" tabindex="-1"></a>                 <span class="st">&#39;GJB2&#39;</span>, <span class="st">&#39;RGS5&#39;</span>,</span>
<span id="cb60-166"><a href="多样本分析.html#cb60-166" tabindex="-1"></a>                 <span class="st">&#39;DCN&#39;</span>, <span class="st">&#39;LUM&#39;</span>,  <span class="st">&#39;GSN&#39;</span> , <span class="do">## mouse PDAC fibo </span></span>
<span id="cb60-167"><a href="多样本分析.html#cb60-167" tabindex="-1"></a>                 <span class="st">&#39;MKI67&#39;</span> , <span class="st">&#39;TOP2A&#39;</span>, </span>
<span id="cb60-168"><a href="多样本分析.html#cb60-168" tabindex="-1"></a>                 <span class="st">&#39;PECAM1&#39;</span>, <span class="st">&#39;VWF&#39;</span>,  <span class="do">## endo </span></span>
<span id="cb60-169"><a href="多样本分析.html#cb60-169" tabindex="-1"></a>                 <span class="st">&quot;PLVAP&quot;</span>,<span class="st">&#39;PROX1&#39;</span>,<span class="st">&#39;ACKR1&#39;</span>,<span class="st">&#39;CA4&#39;</span>,<span class="st">&#39;HEY1&#39;</span>,</span>
<span id="cb60-170"><a href="多样本分析.html#cb60-170" tabindex="-1"></a>                 <span class="st">&#39;EPCAM&#39;</span> , <span class="st">&#39;KRT19&#39;</span>,<span class="st">&#39;KRT7&#39;</span>, <span class="co"># epi </span></span>
<span id="cb60-171"><a href="多样本分析.html#cb60-171" tabindex="-1"></a>                 <span class="st">&#39;FYXD2&#39;</span>, <span class="st">&#39;TM4SF4&#39;</span>, <span class="st">&#39;ANXA4&#39;</span>,<span class="co"># cholangiocytes</span></span>
<span id="cb60-172"><a href="多样本分析.html#cb60-172" tabindex="-1"></a>                 <span class="st">&#39;APOC3&#39;</span>, <span class="st">&#39;FABP1&#39;</span>,  <span class="st">&#39;APOA1&#39;</span>,  <span class="co"># hepatocytes</span></span>
<span id="cb60-173"><a href="多样本分析.html#cb60-173" tabindex="-1"></a>                 <span class="st">&#39;Serpina1c&#39;</span>,</span>
<span id="cb60-174"><a href="多样本分析.html#cb60-174" tabindex="-1"></a>                 <span class="st">&#39;PROM1&#39;</span>, <span class="st">&#39;ALDH1A1&#39;</span> )</span>
<span id="cb60-175"><a href="多样本分析.html#cb60-175" tabindex="-1"></a></span>
<span id="cb60-176"><a href="多样本分析.html#cb60-176" tabindex="-1"></a>markers <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;gastric_cancer_markers&#39;</span>,<span class="st">&#39;lung_epi_markers&#39;</span>,</span>
<span id="cb60-177"><a href="多样本分析.html#cb60-177" tabindex="-1"></a>            <span class="st">&#39;Tcells_markers&#39;</span>,</span>
<span id="cb60-178"><a href="多样本分析.html#cb60-178" tabindex="-1"></a>            <span class="st">&#39;stromal_markers&#39;</span>, </span>
<span id="cb60-179"><a href="多样本分析.html#cb60-179" tabindex="-1"></a>            <span class="st">&#39;last_markers&#39;</span> )</span>
<span id="cb60-180"><a href="多样本分析.html#cb60-180" tabindex="-1"></a>markers_list <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb60-181"><a href="多样本分析.html#cb60-181" tabindex="-1"></a>  <span class="st">&#39;GSE150580_breast_cancer_markers_list&#39;</span> ,</span>
<span id="cb60-182"><a href="多样本分析.html#cb60-182" tabindex="-1"></a>  <span class="st">&#39;SCP1661_meyloids_markers_list&#39;</span> ,</span>
<span id="cb60-183"><a href="多样本分析.html#cb60-183" tabindex="-1"></a>  <span class="st">&#39;myeloids_markers_list1&#39;</span> ,</span>
<span id="cb60-184"><a href="多样本分析.html#cb60-184" tabindex="-1"></a>  <span class="st">&#39;myeloids_markers_list2&#39;</span> ,</span>
<span id="cb60-185"><a href="多样本分析.html#cb60-185" tabindex="-1"></a>  <span class="st">&#39;CD4_markers_list&#39;</span> ,</span>
<span id="cb60-186"><a href="多样本分析.html#cb60-186" tabindex="-1"></a>  <span class="st">&#39;CD8_markers_list1&#39;</span> ,</span>
<span id="cb60-187"><a href="多样本分析.html#cb60-187" tabindex="-1"></a>  <span class="st">&#39;CD8_markers_list2&#39;</span> ,</span>
<span id="cb60-188"><a href="多样本分析.html#cb60-188" tabindex="-1"></a>  <span class="st">&#39;cd4_and_cd8T_markers_list&#39;</span>   ,</span>
<span id="cb60-189"><a href="多样本分析.html#cb60-189" tabindex="-1"></a>  <span class="st">&#39;Bcels_markers_list&#39;</span> ,</span>
<span id="cb60-190"><a href="多样本分析.html#cb60-190" tabindex="-1"></a>  <span class="st">&#39;Hepatic_stellate_markers_list&#39;</span> </span>
<span id="cb60-191"><a href="多样本分析.html#cb60-191" tabindex="-1"></a>)</span></code></pre></div>
<p>设置物种</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="多样本分析.html#cb61-1" tabindex="-1"></a>sp<span class="ot">=</span><span class="st">&#39;human&#39;</span> <span class="co"># human/mouse</span></span></code></pre></div>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="多样本分析.html#cb62-1" tabindex="-1"></a><span class="cf">if</span>(sp <span class="sc">==</span> <span class="st">&#39;human&#39;</span>) {</span>
<span id="cb62-2"><a href="多样本分析.html#cb62-2" tabindex="-1"></a>  <span class="co"># 创建一个列表来存储所有的DotPlot图</span></span>
<span id="cb62-3"><a href="多样本分析.html#cb62-3" tabindex="-1"></a>  plot_list1 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(markers, <span class="cf">function</span>(x) {</span>
<span id="cb62-4"><a href="多样本分析.html#cb62-4" tabindex="-1"></a>    genes_to_check <span class="ot">&lt;-</span> <span class="fu">str_to_upper</span>(<span class="fu">get</span>(x))</span>
<span id="cb62-5"><a href="多样本分析.html#cb62-5" tabindex="-1"></a>    </span>
<span id="cb62-6"><a href="多样本分析.html#cb62-6" tabindex="-1"></a>    plot1 <span class="ot">&lt;-</span> <span class="fu">DotPlot</span>(sce.all, <span class="at">features =</span> genes_to_check) <span class="sc">+</span> </span>
<span id="cb62-7"><a href="多样本分析.html#cb62-7" tabindex="-1"></a>      <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb62-8"><a href="多样本分析.html#cb62-8" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb62-9"><a href="多样本分析.html#cb62-9" tabindex="-1"></a>    </span>
<span id="cb62-10"><a href="多样本分析.html#cb62-10" tabindex="-1"></a>    <span class="co"># 如果需要保存图形，可以取消注释以下行</span></span>
<span id="cb62-11"><a href="多样本分析.html#cb62-11" tabindex="-1"></a>    <span class="co"># h = length(genes_to_check) / 6 + 4</span></span>
<span id="cb62-12"><a href="多样本分析.html#cb62-12" tabindex="-1"></a>    <span class="co"># ggsave(paste(&#39;check_for_&#39;, x, &#39;.pdf&#39;), height = h)</span></span>
<span id="cb62-13"><a href="多样本分析.html#cb62-13" tabindex="-1"></a>    </span>
<span id="cb62-14"><a href="多样本分析.html#cb62-14" tabindex="-1"></a>    <span class="fu">return</span>(plot1)  <span class="co"># 返回图形对象</span></span>
<span id="cb62-15"><a href="多样本分析.html#cb62-15" tabindex="-1"></a>  })</span>
<span id="cb62-16"><a href="多样本分析.html#cb62-16" tabindex="-1"></a>  </span>
<span id="cb62-17"><a href="多样本分析.html#cb62-17" tabindex="-1"></a>  plot_list2 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(markers_list, <span class="cf">function</span>(x) {</span>
<span id="cb62-18"><a href="多样本分析.html#cb62-18" tabindex="-1"></a>    genes_to_check <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">get</span>(x), str_to_upper)</span>
<span id="cb62-19"><a href="多样本分析.html#cb62-19" tabindex="-1"></a>    dup <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">table</span>(<span class="fu">unlist</span>(genes_to_check)))[<span class="fu">table</span>(<span class="fu">unlist</span>(genes_to_check)) <span class="sc">&gt;</span> <span class="dv">1</span>]</span>
<span id="cb62-20"><a href="多样本分析.html#cb62-20" tabindex="-1"></a>    genes_to_check <span class="ot">&lt;-</span> <span class="fu">lapply</span>(genes_to_check, <span class="cf">function</span>(x) x[<span class="sc">!</span>x <span class="sc">%in%</span> dup])</span>
<span id="cb62-21"><a href="多样本分析.html#cb62-21" tabindex="-1"></a>    </span>
<span id="cb62-22"><a href="多样本分析.html#cb62-22" tabindex="-1"></a>    plot2 <span class="ot">&lt;-</span> <span class="fu">DotPlot</span>(sce.all, <span class="at">features =</span> genes_to_check) <span class="sc">+</span> </span>
<span id="cb62-23"><a href="多样本分析.html#cb62-23" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb62-24"><a href="多样本分析.html#cb62-24" tabindex="-1"></a>    </span>
<span id="cb62-25"><a href="多样本分析.html#cb62-25" tabindex="-1"></a>    <span class="co"># 如果需要保存图形，可以取消注释以下行</span></span>
<span id="cb62-26"><a href="多样本分析.html#cb62-26" tabindex="-1"></a>    <span class="co"># w = length(unique(unlist(genes_to_check))) / 5 + 7</span></span>
<span id="cb62-27"><a href="多样本分析.html#cb62-27" tabindex="-1"></a>    <span class="co"># ggsave(paste(&#39;check_for_&#39;, x, &#39;.pdf&#39;), width = w)</span></span>
<span id="cb62-28"><a href="多样本分析.html#cb62-28" tabindex="-1"></a>    </span>
<span id="cb62-29"><a href="多样本分析.html#cb62-29" tabindex="-1"></a>    <span class="fu">return</span>(plot2)  <span class="co"># 返回图形对象</span></span>
<span id="cb62-30"><a href="多样本分析.html#cb62-30" tabindex="-1"></a>  })</span>
<span id="cb62-31"><a href="多样本分析.html#cb62-31" tabindex="-1"></a>  </span>
<span id="cb62-32"><a href="多样本分析.html#cb62-32" tabindex="-1"></a>  last_markers_to_check <span class="ot">&lt;&lt;-</span> <span class="fu">str_to_upper</span>(last_markers) </span>
<span id="cb62-33"><a href="多样本分析.html#cb62-33" tabindex="-1"></a>  </span>
<span id="cb62-34"><a href="多样本分析.html#cb62-34" tabindex="-1"></a>  <span class="co"># 打印所有的图形</span></span>
<span id="cb62-35"><a href="多样本分析.html#cb62-35" tabindex="-1"></a>  <span class="fu">plot_grid</span>(<span class="at">plotlist =</span> <span class="fu">c</span>(plot_list1, plot_list2), <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb62-36"><a href="多样本分析.html#cb62-36" tabindex="-1"></a></span>
<span id="cb62-37"><a href="多样本分析.html#cb62-37" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span>(sp <span class="sc">==</span> <span class="st">&#39;mouse&#39;</span>) {</span>
<span id="cb62-38"><a href="多样本分析.html#cb62-38" tabindex="-1"></a>  <span class="co"># 创建一个列表来存储所有的DotPlot图</span></span>
<span id="cb62-39"><a href="多样本分析.html#cb62-39" tabindex="-1"></a>  plot_list1 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(markers, <span class="cf">function</span>(x) {</span>
<span id="cb62-40"><a href="多样本分析.html#cb62-40" tabindex="-1"></a>    genes_to_check <span class="ot">&lt;-</span> <span class="fu">str_to_title</span>(<span class="fu">get</span>(x))</span>
<span id="cb62-41"><a href="多样本分析.html#cb62-41" tabindex="-1"></a>    </span>
<span id="cb62-42"><a href="多样本分析.html#cb62-42" tabindex="-1"></a>    plot1 <span class="ot">&lt;-</span> <span class="fu">DotPlot</span>(sce.all, <span class="at">features =</span> genes_to_check) <span class="sc">+</span> </span>
<span id="cb62-43"><a href="多样本分析.html#cb62-43" tabindex="-1"></a>      <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb62-44"><a href="多样本分析.html#cb62-44" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb62-45"><a href="多样本分析.html#cb62-45" tabindex="-1"></a>    </span>
<span id="cb62-46"><a href="多样本分析.html#cb62-46" tabindex="-1"></a>    <span class="co"># 如果需要保存图形，可以取消注释以下行</span></span>
<span id="cb62-47"><a href="多样本分析.html#cb62-47" tabindex="-1"></a>    <span class="co"># h = length(genes_to_check) / 6 + 4</span></span>
<span id="cb62-48"><a href="多样本分析.html#cb62-48" tabindex="-1"></a>    <span class="co"># ggsave(paste(&#39;check_for_&#39;, x, &#39;.pdf&#39;), height = h)</span></span>
<span id="cb62-49"><a href="多样本分析.html#cb62-49" tabindex="-1"></a>    </span>
<span id="cb62-50"><a href="多样本分析.html#cb62-50" tabindex="-1"></a>    <span class="fu">return</span>(plot1)  <span class="co"># 返回图形对象</span></span>
<span id="cb62-51"><a href="多样本分析.html#cb62-51" tabindex="-1"></a>  })</span>
<span id="cb62-52"><a href="多样本分析.html#cb62-52" tabindex="-1"></a>  </span>
<span id="cb62-53"><a href="多样本分析.html#cb62-53" tabindex="-1"></a>  plot_list2 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(markers_list, <span class="cf">function</span>(x) {</span>
<span id="cb62-54"><a href="多样本分析.html#cb62-54" tabindex="-1"></a>    genes_to_check <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">get</span>(x), str_to_title)</span>
<span id="cb62-55"><a href="多样本分析.html#cb62-55" tabindex="-1"></a>    dup <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">table</span>(<span class="fu">unlist</span>(genes_to_check)))[<span class="fu">table</span>(<span class="fu">unlist</span>(genes_to_check)) <span class="sc">&gt;</span> <span class="dv">1</span>]</span>
<span id="cb62-56"><a href="多样本分析.html#cb62-56" tabindex="-1"></a>    genes_to_check <span class="ot">&lt;-</span> <span class="fu">lapply</span>(genes_to_check, <span class="cf">function</span>(x) x[<span class="sc">!</span>x <span class="sc">%in%</span> dup])</span>
<span id="cb62-57"><a href="多样本分析.html#cb62-57" tabindex="-1"></a>    </span>
<span id="cb62-58"><a href="多样本分析.html#cb62-58" tabindex="-1"></a>    plot2 <span class="ot">&lt;-</span> <span class="fu">DotPlot</span>(sce.all, <span class="at">features =</span> genes_to_check) <span class="sc">+</span> </span>
<span id="cb62-59"><a href="多样本分析.html#cb62-59" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb62-60"><a href="多样本分析.html#cb62-60" tabindex="-1"></a>    </span>
<span id="cb62-61"><a href="多样本分析.html#cb62-61" tabindex="-1"></a>    <span class="co"># 如果需要保存图形，可以取消注释以下行</span></span>
<span id="cb62-62"><a href="多样本分析.html#cb62-62" tabindex="-1"></a>    <span class="co"># w = length(unique(unlist(genes_to_check))) / 5 + 6</span></span>
<span id="cb62-63"><a href="多样本分析.html#cb62-63" tabindex="-1"></a>    <span class="co"># ggsave(paste(&#39;check_for_&#39;, x, &#39;.pdf&#39;), width = w)</span></span>
<span id="cb62-64"><a href="多样本分析.html#cb62-64" tabindex="-1"></a>    </span>
<span id="cb62-65"><a href="多样本分析.html#cb62-65" tabindex="-1"></a>    <span class="fu">return</span>(plot2)  <span class="co"># 返回图形对象</span></span>
<span id="cb62-66"><a href="多样本分析.html#cb62-66" tabindex="-1"></a>  })</span>
<span id="cb62-67"><a href="多样本分析.html#cb62-67" tabindex="-1"></a>  </span>
<span id="cb62-68"><a href="多样本分析.html#cb62-68" tabindex="-1"></a>  last_markers_to_check <span class="ot">&lt;&lt;-</span> <span class="fu">str_to_title</span>(last_markers) </span>
<span id="cb62-69"><a href="多样本分析.html#cb62-69" tabindex="-1"></a>  </span>
<span id="cb62-70"><a href="多样本分析.html#cb62-70" tabindex="-1"></a>  <span class="co"># 打印所有的图形</span></span>
<span id="cb62-71"><a href="多样本分析.html#cb62-71" tabindex="-1"></a>  <span class="fu">plot_grid</span>(<span class="at">plotlist =</span> <span class="fu">c</span>(plot_list1, plot_list2), <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb62-72"><a href="多样本分析.html#cb62-72" tabindex="-1"></a>  </span>
<span id="cb62-73"><a href="多样本分析.html#cb62-73" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb62-74"><a href="多样本分析.html#cb62-74" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&#39;we only accept human or mouse&#39;</span>)</span>
<span id="cb62-75"><a href="多样本分析.html#cb62-75" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="04-multi_files/figure-html/unnamed-chunk-17-1.png" width="3840" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="多样本分析.html#cb63-1" tabindex="-1"></a><span class="fu">DotPlot</span>(sce.all , <span class="at">features =</span> last_markers_to_check ) <span class="sc">+</span> </span>
<span id="cb63-2"><a href="多样本分析.html#cb63-2" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb63-3"><a href="多样本分析.html#cb63-3" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x=</span><span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">45</span>,<span class="at">hjust =</span> <span class="dv">1</span>))<span class="sc">|</span></span>
<span id="cb63-4"><a href="多样本分析.html#cb63-4" tabindex="-1"></a><span class="fu">DimPlot</span>(sce.all, <span class="at">reduction =</span> <span class="st">&quot;umap&quot;</span>,<span class="at">raster =</span> F,</span>
<span id="cb63-5"><a href="多样本分析.html#cb63-5" tabindex="-1"></a>               <span class="at">label =</span> T,<span class="at">repel =</span> T)</span></code></pre></div>
<p><img src="04-multi_files/figure-html/unnamed-chunk-18-1.png" width="1632" style="display: block; margin: auto;" /></p>
</div>
<div id="亚群命名-1" class="section level2 unnumbered hasAnchor">
<h2>亚群命名<a href="多样本分析.html#亚群命名-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>我们找到合适的marker基因后就可以进一步去可视化（我的理解是拿这些图在文章中展示），
判断单细胞亚群的生物学名字。这里我们直接使用已经定义好的名字。</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="多样本分析.html#cb64-1" tabindex="-1"></a><span class="co"># 这里只是为了展示代码，就拿0.1分辨率的结果来展示</span></span>
<span id="cb64-2"><a href="多样本分析.html#cb64-2" tabindex="-1"></a><span class="fu">colnames</span>(sce.all<span class="sc">@</span>meta.data)</span>
<span id="cb64-3"><a href="多样本分析.html#cb64-3" tabindex="-1"></a><span class="do">##  [1] &quot;orig.ident&quot;       &quot;nCount_RNA&quot;       &quot;nFeature_RNA&quot;     &quot;group&quot;           </span></span>
<span id="cb64-4"><a href="多样本分析.html#cb64-4" tabindex="-1"></a><span class="do">##  [5] &quot;percent_mito&quot;     &quot;percent_ribo&quot;     &quot;percent_hb&quot;       &quot;RNA_snn_res.0.01&quot;</span></span>
<span id="cb64-5"><a href="多样本分析.html#cb64-5" tabindex="-1"></a><span class="do">##  [9] &quot;seurat_clusters&quot;  &quot;RNA_snn_res.0.05&quot; &quot;RNA_snn_res.0.1&quot;  &quot;RNA_snn_res.0.2&quot; </span></span>
<span id="cb64-6"><a href="多样本分析.html#cb64-6" tabindex="-1"></a><span class="do">## [13] &quot;RNA_snn_res.0.3&quot;  &quot;RNA_snn_res.0.5&quot;  &quot;RNA_snn_res.0.8&quot;  &quot;RNA_snn_res.1&quot;</span></span>
<span id="cb64-7"><a href="多样本分析.html#cb64-7" tabindex="-1"></a><span class="fu">DimPlot</span>(sce.all, <span class="at">group.by =</span> <span class="st">&quot;RNA_snn_res.0.1&quot;</span>)</span></code></pre></div>
<p><img src="04-multi_files/figure-html/unnamed-chunk-19-1.png" width="1152" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="多样本分析.html#cb65-1" tabindex="-1"></a>astrocytes <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;AQP4&quot;</span>, <span class="st">&quot;ADGRV1&quot;</span>, <span class="st">&quot;GPC5&quot;</span>, <span class="st">&quot;RYR3&quot;</span>) </span>
<span id="cb65-2"><a href="多样本分析.html#cb65-2" tabindex="-1"></a>endothelial <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;CLDN5&quot;</span>, <span class="st">&quot;ABCB1&quot;</span>, <span class="st">&quot;EBF1&quot;</span>) </span>
<span id="cb65-3"><a href="多样本分析.html#cb65-3" tabindex="-1"></a>excitatory <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;CAMK2A&quot;</span>, <span class="st">&quot;CBLN2&quot;</span>, <span class="st">&quot;LDB2&quot;</span>) </span>
<span id="cb65-4"><a href="多样本分析.html#cb65-4" tabindex="-1"></a>inhibitory <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;GAD1&quot;</span>, <span class="st">&quot;LHFPL3&quot;</span>, <span class="st">&quot;PCDH15&quot;</span>) </span>
<span id="cb65-5"><a href="多样本分析.html#cb65-5" tabindex="-1"></a>microglia <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;C3&quot;</span>, <span class="st">&quot;LRMDA&quot;</span>, <span class="st">&quot;DOCK8&quot;</span>) </span>
<span id="cb65-6"><a href="多样本分析.html#cb65-6" tabindex="-1"></a>oligodendrocytes <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;MBP&quot;</span>, <span class="st">&quot;PLP1&quot;</span>, <span class="st">&quot;ST18&quot;</span>) </span>
<span id="cb65-7"><a href="多样本分析.html#cb65-7" tabindex="-1"></a>OPC<span class="ot">=</span><span class="st">&#39;Tnr,Igsf21,Neu4,Gpr17&#39;</span></span>
<span id="cb65-8"><a href="多样本分析.html#cb65-8" tabindex="-1"></a>Ependymal<span class="ot">=</span><span class="st">&#39;Cfap126,Fam183b,Tmem212,pifo,Tekt1,Dnah12&#39;</span></span>
<span id="cb65-9"><a href="多样本分析.html#cb65-9" tabindex="-1"></a>pericyte<span class="ot">=</span><span class="fu">c</span>(  <span class="st">&#39;DCN&#39;</span>, <span class="st">&#39;LUM&#39;</span>,  <span class="st">&#39;GSN&#39;</span> ,<span class="st">&#39;FGF7&#39;</span>,<span class="st">&#39;MME&#39;</span>, <span class="st">&#39;ACTA2&#39;</span>,<span class="st">&#39;RGS5&#39;</span>)</span>
<span id="cb65-10"><a href="多样本分析.html#cb65-10" tabindex="-1"></a>Neurons<span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;RBFOX1&quot;</span>, <span class="st">&quot;RBFOX3&quot;</span>, <span class="st">&quot;SYT1&quot;</span>)</span>
<span id="cb65-11"><a href="多样本分析.html#cb65-11" tabindex="-1"></a></span>
<span id="cb65-12"><a href="多样本分析.html#cb65-12" tabindex="-1"></a>gene_list <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb65-13"><a href="多样本分析.html#cb65-13" tabindex="-1"></a>  <span class="at">Astro =</span> astrocytes,</span>
<span id="cb65-14"><a href="多样本分析.html#cb65-14" tabindex="-1"></a>  <span class="at">Endo =</span> endothelial,</span>
<span id="cb65-15"><a href="多样本分析.html#cb65-15" tabindex="-1"></a>  <span class="at">Excit =</span> excitatory,</span>
<span id="cb65-16"><a href="多样本分析.html#cb65-16" tabindex="-1"></a>  <span class="at">Inhib =</span> inhibitory,</span>
<span id="cb65-17"><a href="多样本分析.html#cb65-17" tabindex="-1"></a>  <span class="at">Mic =</span> microglia,</span>
<span id="cb65-18"><a href="多样本分析.html#cb65-18" tabindex="-1"></a>  <span class="at">Oligo =</span> oligodendrocytes,</span>
<span id="cb65-19"><a href="多样本分析.html#cb65-19" tabindex="-1"></a>  <span class="at">OPC=</span> <span class="fu">str_to_upper</span>(<span class="fu">trimws</span>(<span class="fu">strsplit</span>(OPC,<span class="st">&#39;,&#39;</span>)[[<span class="dv">1</span>]])),</span>
<span id="cb65-20"><a href="多样本分析.html#cb65-20" tabindex="-1"></a>  <span class="at">Ependymal=</span> <span class="fu">str_to_upper</span>(<span class="fu">trimws</span>(<span class="fu">strsplit</span>(Ependymal,<span class="st">&#39;,&#39;</span>)[[<span class="dv">1</span>]])) ,</span>
<span id="cb65-21"><a href="多样本分析.html#cb65-21" tabindex="-1"></a>  <span class="at">peri =</span> pericyte ,</span>
<span id="cb65-22"><a href="多样本分析.html#cb65-22" tabindex="-1"></a>  <span class="at">Neur =</span> Neurons</span>
<span id="cb65-23"><a href="多样本分析.html#cb65-23" tabindex="-1"></a>)</span>
<span id="cb65-24"><a href="多样本分析.html#cb65-24" tabindex="-1"></a></span>
<span id="cb65-25"><a href="多样本分析.html#cb65-25" tabindex="-1"></a>gene_list <span class="ot">=</span> <span class="fu">lapply</span>(gene_list, <span class="cf">function</span>(x){</span>
<span id="cb65-26"><a href="多样本分析.html#cb65-26" tabindex="-1"></a>  <span class="fu">unique</span>(<span class="fu">c</span>(<span class="fu">str_to_title</span>(x), <span class="fu">str_to_upper</span>(x)))</span>
<span id="cb65-27"><a href="多样本分析.html#cb65-27" tabindex="-1"></a>})</span>
<span id="cb65-28"><a href="多样本分析.html#cb65-28" tabindex="-1"></a></span>
<span id="cb65-29"><a href="多样本分析.html#cb65-29" tabindex="-1"></a>gene_list</span>
<span id="cb65-30"><a href="多样本分析.html#cb65-30" tabindex="-1"></a><span class="do">## $Astro</span></span>
<span id="cb65-31"><a href="多样本分析.html#cb65-31" tabindex="-1"></a><span class="do">## [1] &quot;Aqp4&quot;   &quot;Adgrv1&quot; &quot;Gpc5&quot;   &quot;Ryr3&quot;   &quot;AQP4&quot;   &quot;ADGRV1&quot; &quot;GPC5&quot;   &quot;RYR3&quot;  </span></span>
<span id="cb65-32"><a href="多样本分析.html#cb65-32" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb65-33"><a href="多样本分析.html#cb65-33" tabindex="-1"></a><span class="do">## $Endo</span></span>
<span id="cb65-34"><a href="多样本分析.html#cb65-34" tabindex="-1"></a><span class="do">## [1] &quot;Cldn5&quot; &quot;Abcb1&quot; &quot;Ebf1&quot;  &quot;CLDN5&quot; &quot;ABCB1&quot; &quot;EBF1&quot; </span></span>
<span id="cb65-35"><a href="多样本分析.html#cb65-35" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb65-36"><a href="多样本分析.html#cb65-36" tabindex="-1"></a><span class="do">## $Excit</span></span>
<span id="cb65-37"><a href="多样本分析.html#cb65-37" tabindex="-1"></a><span class="do">## [1] &quot;Camk2a&quot; &quot;Cbln2&quot;  &quot;Ldb2&quot;   &quot;CAMK2A&quot; &quot;CBLN2&quot;  &quot;LDB2&quot;  </span></span>
<span id="cb65-38"><a href="多样本分析.html#cb65-38" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb65-39"><a href="多样本分析.html#cb65-39" tabindex="-1"></a><span class="do">## $Inhib</span></span>
<span id="cb65-40"><a href="多样本分析.html#cb65-40" tabindex="-1"></a><span class="do">## [1] &quot;Gad1&quot;   &quot;Lhfpl3&quot; &quot;Pcdh15&quot; &quot;GAD1&quot;   &quot;LHFPL3&quot; &quot;PCDH15&quot;</span></span>
<span id="cb65-41"><a href="多样本分析.html#cb65-41" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb65-42"><a href="多样本分析.html#cb65-42" tabindex="-1"></a><span class="do">## $Mic</span></span>
<span id="cb65-43"><a href="多样本分析.html#cb65-43" tabindex="-1"></a><span class="do">## [1] &quot;C3&quot;    &quot;Lrmda&quot; &quot;Dock8&quot; &quot;LRMDA&quot; &quot;DOCK8&quot;</span></span>
<span id="cb65-44"><a href="多样本分析.html#cb65-44" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb65-45"><a href="多样本分析.html#cb65-45" tabindex="-1"></a><span class="do">## $Oligo</span></span>
<span id="cb65-46"><a href="多样本分析.html#cb65-46" tabindex="-1"></a><span class="do">## [1] &quot;Mbp&quot;  &quot;Plp1&quot; &quot;St18&quot; &quot;MBP&quot;  &quot;PLP1&quot; &quot;ST18&quot;</span></span>
<span id="cb65-47"><a href="多样本分析.html#cb65-47" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb65-48"><a href="多样本分析.html#cb65-48" tabindex="-1"></a><span class="do">## $OPC</span></span>
<span id="cb65-49"><a href="多样本分析.html#cb65-49" tabindex="-1"></a><span class="do">## [1] &quot;Tnr&quot;    &quot;Igsf21&quot; &quot;Neu4&quot;   &quot;Gpr17&quot;  &quot;TNR&quot;    &quot;IGSF21&quot; &quot;NEU4&quot;   &quot;GPR17&quot; </span></span>
<span id="cb65-50"><a href="多样本分析.html#cb65-50" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb65-51"><a href="多样本分析.html#cb65-51" tabindex="-1"></a><span class="do">## $Ependymal</span></span>
<span id="cb65-52"><a href="多样本分析.html#cb65-52" tabindex="-1"></a><span class="do">##  [1] &quot;Cfap126&quot; &quot;Fam183b&quot; &quot;Tmem212&quot; &quot;Pifo&quot;    &quot;Tekt1&quot;   &quot;Dnah12&quot;  &quot;CFAP126&quot;</span></span>
<span id="cb65-53"><a href="多样本分析.html#cb65-53" tabindex="-1"></a><span class="do">##  [8] &quot;FAM183B&quot; &quot;TMEM212&quot; &quot;PIFO&quot;    &quot;TEKT1&quot;   &quot;DNAH12&quot; </span></span>
<span id="cb65-54"><a href="多样本分析.html#cb65-54" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb65-55"><a href="多样本分析.html#cb65-55" tabindex="-1"></a><span class="do">## $peri</span></span>
<span id="cb65-56"><a href="多样本分析.html#cb65-56" tabindex="-1"></a><span class="do">##  [1] &quot;Dcn&quot;   &quot;Lum&quot;   &quot;Gsn&quot;   &quot;Fgf7&quot;  &quot;Mme&quot;   &quot;Acta2&quot; &quot;Rgs5&quot;  &quot;DCN&quot;   &quot;LUM&quot;  </span></span>
<span id="cb65-57"><a href="多样本分析.html#cb65-57" tabindex="-1"></a><span class="do">## [10] &quot;GSN&quot;   &quot;FGF7&quot;  &quot;MME&quot;   &quot;ACTA2&quot; &quot;RGS5&quot; </span></span>
<span id="cb65-58"><a href="多样本分析.html#cb65-58" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb65-59"><a href="多样本分析.html#cb65-59" tabindex="-1"></a><span class="do">## $Neur</span></span>
<span id="cb65-60"><a href="多样本分析.html#cb65-60" tabindex="-1"></a><span class="do">## [1] &quot;Rbfox1&quot; &quot;Rbfox3&quot; &quot;Syt1&quot;   &quot;RBFOX1&quot; &quot;RBFOX3&quot; &quot;SYT1&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="多样本分析.html#cb66-1" tabindex="-1"></a> p1<span class="ot">=</span><span class="fu">DotPlot</span>(sce.all, <span class="at">assay =</span> <span class="st">&quot;RNA&quot;</span>, <span class="at">features =</span> gene_list, </span>
<span id="cb66-2"><a href="多样本分析.html#cb66-2" tabindex="-1"></a>            <span class="at">group.by =</span> <span class="st">&#39;RNA_snn_res.0.1&#39;</span>) <span class="sc">+</span> </span>
<span id="cb66-3"><a href="多样本分析.html#cb66-3" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, </span>
<span id="cb66-4"><a href="多样本分析.html#cb66-4" tabindex="-1"></a>                                     <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="fl">0.5</span>));p1</span></code></pre></div>
<p><img src="04-multi_files/figure-html/unnamed-chunk-21-1.png" width="1152" style="display: block; margin: auto;" /></p>
<p>根据最终的可视化图，我们就可以手动的给亚群命名了。</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="多样本分析.html#cb67-1" tabindex="-1"></a>sce.all</span>
<span id="cb67-2"><a href="多样本分析.html#cb67-2" tabindex="-1"></a><span class="do">## An object of class Seurat </span></span>
<span id="cb67-3"><a href="多样本分析.html#cb67-3" tabindex="-1"></a><span class="do">## 28985 features across 20269 samples within 1 assay </span></span>
<span id="cb67-4"><a href="多样本分析.html#cb67-4" tabindex="-1"></a><span class="do">## Active assay: RNA (28985 features, 2000 variable features)</span></span>
<span id="cb67-5"><a href="多样本分析.html#cb67-5" tabindex="-1"></a><span class="do">##  3 layers present: counts, data, scale.data</span></span>
<span id="cb67-6"><a href="多样本分析.html#cb67-6" tabindex="-1"></a><span class="do">##  3 dimensional reductions calculated: pca, harmony, umap</span></span>
<span id="cb67-7"><a href="多样本分析.html#cb67-7" tabindex="-1"></a><span class="fu">dim</span>(sce.all)</span>
<span id="cb67-8"><a href="多样本分析.html#cb67-8" tabindex="-1"></a><span class="do">## [1] 28985 20269</span></span>
<span id="cb67-9"><a href="多样本分析.html#cb67-9" tabindex="-1"></a></span>
<span id="cb67-10"><a href="多样本分析.html#cb67-10" tabindex="-1"></a>sel.clust <span class="ot">=</span> <span class="st">&quot;RNA_snn_res.0.1&quot;</span></span>
<span id="cb67-11"><a href="多样本分析.html#cb67-11" tabindex="-1"></a>sce.all <span class="ot">&lt;-</span> <span class="fu">SetIdent</span>(sce.all, <span class="at">value =</span> sel.clust)</span>
<span id="cb67-12"><a href="多样本分析.html#cb67-12" tabindex="-1"></a></span>
<span id="cb67-13"><a href="多样本分析.html#cb67-13" tabindex="-1"></a>res_len <span class="ot">&lt;-</span> <span class="fu">table</span>(sce.all<span class="sc">@</span>active.ident) <span class="sc">%&gt;%</span> <span class="fu">length</span>();res_len</span>
<span id="cb67-14"><a href="多样本分析.html#cb67-14" tabindex="-1"></a><span class="do">## [1] 11</span></span>
<span id="cb67-15"><a href="多样本分析.html#cb67-15" tabindex="-1"></a>celltype<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">ClusterID=</span>(<span class="dv">0</span><span class="sc">:</span>(res_len<span class="dv">-1</span>)),</span>
<span id="cb67-16"><a href="多样本分析.html#cb67-16" tabindex="-1"></a>                    <span class="at">celltype=</span> (<span class="dv">0</span><span class="sc">:</span>(res_len<span class="dv">-1</span>)))</span></code></pre></div>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="多样本分析.html#cb68-1" tabindex="-1"></a><span class="co"># 自定义细胞亚群        </span></span>
<span id="cb68-2"><a href="多样本分析.html#cb68-2" tabindex="-1"></a>celltype[celltype<span class="sc">$</span>ClusterID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2</span>),<span class="dv">2</span>]<span class="ot">=</span><span class="st">&#39;astrocytes&#39;</span></span>
<span id="cb68-3"><a href="多样本分析.html#cb68-3" tabindex="-1"></a>celltype[celltype<span class="sc">$</span>ClusterID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">4</span>),<span class="dv">2</span>]<span class="ot">=</span><span class="st">&#39;endothelial&#39;</span> </span>
<span id="cb68-4"><a href="多样本分析.html#cb68-4" tabindex="-1"></a>celltype[celltype<span class="sc">$</span>ClusterID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>),<span class="dv">2</span>]<span class="ot">=</span><span class="st">&#39;microglia&#39;</span>  </span>
<span id="cb68-5"><a href="多样本分析.html#cb68-5" tabindex="-1"></a>celltype[celltype<span class="sc">$</span>ClusterID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>),<span class="dv">2</span>]<span class="ot">=</span><span class="st">&#39;oligodendrocytes&#39;</span></span>
<span id="cb68-6"><a href="多样本分析.html#cb68-6" tabindex="-1"></a>celltype[celltype<span class="sc">$</span>ClusterID <span class="sc">%in%</span> <span class="fu">c</span>( <span class="dv">7</span> ),<span class="dv">2</span>]<span class="ot">=</span><span class="st">&#39;OPC&#39;</span></span>
<span id="cb68-7"><a href="多样本分析.html#cb68-7" tabindex="-1"></a>celltype[celltype<span class="sc">$</span>ClusterID <span class="sc">%in%</span> <span class="fu">c</span>( <span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">8</span>,<span class="dv">10</span> ),<span class="dv">2</span>]<span class="ot">=</span><span class="st">&#39;Neurons&#39;</span> </span>
<span id="cb68-8"><a href="多样本分析.html#cb68-8" tabindex="-1"></a>celltype[celltype<span class="sc">$</span>ClusterID <span class="sc">%in%</span> <span class="fu">c</span>( <span class="dv">9</span> ),<span class="dv">2</span>]<span class="ot">=</span><span class="st">&#39;Ependymal&#39;</span></span>
<span id="cb68-9"><a href="多样本分析.html#cb68-9" tabindex="-1"></a></span>
<span id="cb68-10"><a href="多样本分析.html#cb68-10" tabindex="-1"></a><span class="fu">head</span>(celltype)</span>
<span id="cb68-11"><a href="多样本分析.html#cb68-11" tabindex="-1"></a><span class="do">##   ClusterID         celltype</span></span>
<span id="cb68-12"><a href="多样本分析.html#cb68-12" tabindex="-1"></a><span class="do">## 1         0 oligodendrocytes</span></span>
<span id="cb68-13"><a href="多样本分析.html#cb68-13" tabindex="-1"></a><span class="do">## 2         1          Neurons</span></span>
<span id="cb68-14"><a href="多样本分析.html#cb68-14" tabindex="-1"></a><span class="do">## 3         2       astrocytes</span></span>
<span id="cb68-15"><a href="多样本分析.html#cb68-15" tabindex="-1"></a><span class="do">## 4         3        microglia</span></span>
<span id="cb68-16"><a href="多样本分析.html#cb68-16" tabindex="-1"></a><span class="do">## 5         4      endothelial</span></span>
<span id="cb68-17"><a href="多样本分析.html#cb68-17" tabindex="-1"></a><span class="do">## 6         5          Neurons</span></span>
<span id="cb68-18"><a href="多样本分析.html#cb68-18" tabindex="-1"></a><span class="fu">table</span>(celltype<span class="sc">$</span>celltype)</span>
<span id="cb68-19"><a href="多样本分析.html#cb68-19" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb68-20"><a href="多样本分析.html#cb68-20" tabindex="-1"></a><span class="do">##       astrocytes      endothelial        Ependymal        microglia </span></span>
<span id="cb68-21"><a href="多样本分析.html#cb68-21" tabindex="-1"></a><span class="do">##                1                1                1                1 </span></span>
<span id="cb68-22"><a href="多样本分析.html#cb68-22" tabindex="-1"></a><span class="do">##          Neurons oligodendrocytes              OPC </span></span>
<span id="cb68-23"><a href="多样本分析.html#cb68-23" tabindex="-1"></a><span class="do">##                5                1                1</span></span>
<span id="cb68-24"><a href="多样本分析.html#cb68-24" tabindex="-1"></a></span>
<span id="cb68-25"><a href="多样本分析.html#cb68-25" tabindex="-1"></a>sce.all<span class="sc">@</span>meta.data<span class="sc">$</span>celltype <span class="ot">=</span> <span class="st">&quot;NA&quot;</span></span>
<span id="cb68-26"><a href="多样本分析.html#cb68-26" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(celltype)){</span>
<span id="cb68-27"><a href="多样本分析.html#cb68-27" tabindex="-1"></a>    sce.all<span class="sc">@</span>meta.data[<span class="fu">which</span>(sce.all<span class="sc">@</span>meta.data[[sel.clust]] <span class="sc">==</span> celltype<span class="sc">$</span>ClusterID[i]),<span class="st">&#39;celltype&#39;</span>] <span class="ot">&lt;-</span> celltype<span class="sc">$</span>celltype[i]}</span>
<span id="cb68-28"><a href="多样本分析.html#cb68-28" tabindex="-1"></a></span>
<span id="cb68-29"><a href="多样本分析.html#cb68-29" tabindex="-1"></a><span class="fu">Idents</span>(sce.all)<span class="ot">=</span>sce.all<span class="sc">$</span>celltype</span>
<span id="cb68-30"><a href="多样本分析.html#cb68-30" tabindex="-1"></a><span class="fu">table</span>(sce.all<span class="sc">@</span>active.ident)</span>
<span id="cb68-31"><a href="多样本分析.html#cb68-31" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb68-32"><a href="多样本分析.html#cb68-32" tabindex="-1"></a><span class="do">## oligodendrocytes          Neurons       astrocytes              OPC </span></span>
<span id="cb68-33"><a href="多样本分析.html#cb68-33" tabindex="-1"></a><span class="do">##             6832             6971             3145              735 </span></span>
<span id="cb68-34"><a href="多样本分析.html#cb68-34" tabindex="-1"></a><span class="do">##        microglia      endothelial        Ependymal </span></span>
<span id="cb68-35"><a href="多样本分析.html#cb68-35" tabindex="-1"></a><span class="do">##             1295             1154              137</span></span></code></pre></div>
<p>最后我们就可以可视化我们的命名效果了。</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="多样本分析.html#cb69-1" tabindex="-1"></a><span class="fu">DimPlot</span>(sce.all, <span class="at">reduction =</span> <span class="st">&quot;umap&quot;</span>,<span class="at">raster =</span> F,</span>
<span id="cb69-2"><a href="多样本分析.html#cb69-2" tabindex="-1"></a>        <span class="at">label =</span> T,<span class="at">repel =</span> T)  <span class="sc">+</span></span>
<span id="cb69-3"><a href="多样本分析.html#cb69-3" tabindex="-1"></a>  <span class="fu">theme_dr</span>(<span class="at">xlength =</span> <span class="fl">0.22</span>, <span class="at">ylength =</span> <span class="fl">0.22</span>, <span class="at">arrow =</span> grid<span class="sc">::</span><span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.15</span>, <span class="st">&quot;inches&quot;</span>), <span class="at">type =</span> <span class="st">&quot;closed&quot;</span>))<span class="sc">+</span></span>
<span id="cb69-4"><a href="多样本分析.html#cb69-4" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="04-multi_files/figure-html/unnamed-chunk-24-1.png" width="1152" style="display: block; margin: auto;" /></p>
<p>保存Seurat对象以便后续分析</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="多样本分析.html#cb70-1" tabindex="-1"></a><span class="fu">saveRDS</span>(sce.all, <span class="at">file =</span> <span class="st">&quot;./sce.all_final.rds&quot;</span>)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="单样本分析.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/smileszh/scRNA-Seq/edit/master/04-multi.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "none"
}
});
});
</script>

</body>

</html>
